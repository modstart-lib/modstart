var flashObj,flashContainer,wordImage={},g=$G;function addUploadButtonListener(){g("saveFile").addEventListener("change",function(){var e;1===this.files.length?($(".image-tip").html("正在转存，请稍后..."),e=this.files[0],uploader.addFile(e),uploader.upload()):alert("请选择1个文件")})}function addOkListener(){dialog.onok=function(){if(imageUrls.length){var e=editor.getOpt("imageUrlPrefix"),t=domUtils.getElementsByTagName(editor.document,"img");editor.fireEvent("saveScene");for(var i,a=0;i=t[a++];){var n=i.getAttribute("word_img");if(n)for(var o,r=0;o=imageUrls[r++];)if(-1!=n.indexOf(o.name.replace(" ",""))){i.src=e+o.url,i.setAttribute("_src",e+o.url),i.setAttribute("title",o.title),domUtils.removeAttributes(i,["word_img","style","width","height"]),editor.fireEvent("selectionchange");break}}editor.fireEvent("saveScene")}},dialog.oncancel=function(){}}function showLocalPath(e){var t,i=editor.selection.getRange().getClosedNode(),a=editor.execCommand("wordimage");1==a.length||i&&"IMG"==i.tagName?g(e).value=a[0]:(i=(t=a[0]).lastIndexOf("/")||0,a=t.lastIndexOf("\\")||0,t=t.substring(0,t.lastIndexOf(a<i?"/":"\\")+1),g(e).value=t)}function createCopyButton(e,t){t=g(t).value;t.startsWith("file:////")&&(t=t.substring(8)),g(e).setAttribute("data-clipboard-text",t),new Clipboard("[data-clipboard-text]").on("success",function(e){g("copyButton").innerHTML="复制成功"})}wordImage.init=function(e,t){showLocalPath("fileUrl"),createCopyButton("copyButton","fileUrl"),addUploadButtonListener(),addOkListener()};