!function(){var n=[],l=!1;function c(e,t){for(var i,o,l=$G(e).children,a=0;o=l[a++];)if("focus"==o.className){i=o.getAttribute(t);break}return i}function a(e){return e?e=utils.trim(e).replace(/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"player.youku.com/embed/$1").replace(/v\.qq\.com\/x\/cover\/[\w]+\/([\w]+)\.html/i,"v.qq.com/iframe/player.html?vid=$1&tiny=0&auto=0").replace(/v\.qq\.com\/x\/page\/([\w]+)\.html/i,"v.qq.com/iframe/player.html?vid=$1&tiny=0&auto=0").replace(/www\.bilibili\.com\/video\/([a-zA-Z0-9]+)\/?.*$/i,"player.bilibili.com/player.html?bvid=$1"):""}function r(e){e&&(e=a(e),e=utils.unhtmlForUrl(e),$G("preview").innerHTML='<div class="previewMsg"><span>'+lang.urlError+'</span></div><iframe class="previewVideo"  src="'+e+'" width="420" height="280" frameborder=0 allowfullscreen></iframe>')}window.onload=function(){try{window.parent.callback.videoWidgetSelectVideo&&($G("videoSelect").style.display="inline-block",$G("videoSelect").addEventListener("click",function(){window.parent.callback.videoWidgetSelectVideo(function(e){$G("videoUrl").value=e[0],r(e[0])})}))}catch(e){}$focus($G("videoUrl")),function(){for(var l=$G("tabHeads").children,e=0;e<l.length;e++)domUtils.on(l[e],"click",function(e){for(var t,i=e.target||e.srcElement,o=0;o<l.length;o++)t=l[o].getAttribute("data-content-id"),l[o]==i?(domUtils.addClass(l[o],"focus"),domUtils.addClass($G(t),"focus")):(domUtils.removeClasses(l[o],"focus"),domUtils.removeClasses($G(t),"focus"))})}(),function(e){for(var t,i=0;t=e[i++];){var o,l=$G(t),a={none:lang.default,left:lang.floatLeft,right:lang.floatRight,center:lang.block};for(o in a){var r=document.createElement("div");r.setAttribute("name",o),"none"==o&&(r.className="focus"),r.style.cssText="background:url(images/"+o+"_focus.jpg);",r.setAttribute("title",a[o]),l.appendChild(r)}!function(e){for(var t,i=$G(e).children,o=0;t=i[o++];)domUtils.on(t,"click",function(){for(var e,t=0;e=i[t++];)e.className="",e.removeAttribute&&e.removeAttribute("class");this.className="focus"})}(t)}}(["videoFloat","upload_alignment"]),function(e){browser.ie?e.onpropertychange=function(){r(this.value)}:e.addEventListener("input",function(){r(this.value)},!1)}($G("videoUrl")),dialog.onok=function(){var e,t,i,o;switch($G("preview").innerHTML="",c("tabHeads","tabSrc")){case"video":return e=$G("videoWidth"),t=$G("videoHeight"),i=$G("videoUrl").value,o=c("videoFloat","name"),!!i&&(!!function(e){for(var t,i=0;t=e[i++];){var o=t.value;if(!/(0|^[1-9]\d*$)/.test(o)&&o)return alert(lang.numError),t.value="",t.focus(),!1}return!0}([e,t])&&void editor.execCommand("insertvideo",{url:a(i),width:e.value,height:t.value,align:o},l?"upload":null));case"videoSearch":return function(e){for(var t,i=domUtils.getElementsByTagName($G(e),"img"),o=[],l=0;t=i[l++];)t.getAttribute("selected")&&o.push({url:t.getAttribute("ue_video_url"),width:420,height:280,align:"none"});editor.execCommand("insertvideo",o)}("searchList");case"upload":return function(){var e,t=[],i=editor.getOpt("videoUrlPrefix"),o=parseInt($G("upload_width").value,10)||420,l=parseInt($G("upload_height").value,10)||280,a=c("upload_alignment","name")||"none";for(e in n){var r=n[e];t.push({url:i+r.url,width:o,height:l,align:a})}t.push({url:$("#videoUploadUrl").val(),width:o,height:l,align:a}),editor.execCommand("insertvideo",t,"upload")}()}},dialog.oncancel=function(){$G("preview").innerHTML=""},function(){var e,t,i,o=editor.selection.getRange().getClosedNode();o&&o.className&&(i="edui-faked-video"==o.className,t=-1!=o.className.indexOf("edui-upload-video"),(i||t)&&($G("videoUrl").value=e=o.getAttribute("_url"),$G("videoWidth").value=o.width,$G("videoHeight").value=o.height,i=domUtils.getComputedStyle(o,"float"),function(e){for(var t,i=$G("videoFloat").children,o=0;t=i[o++];)t.getAttribute("name")==e?"focus"!=t.className&&(t.className="focus"):"focus"==t.className&&(t.className="")}("center"===domUtils.getComputedStyle(o.parentNode,"text-align")?"center":i)),t&&(l=!0)),r(e)}(),$("#videoDialogSelector").on("click",function(){parent.__selectorDialog=new parent.MS.selectorDialog({server:parent.__selectorDialogServer+"/video",callback:function(e){0<e.length&&($("#videoUploadUrl").val(e[0].fullPath),$("#videoPreview").show().html('<source src="'+e[0].fullPath+'" type="video/mp4"/>'))}}).show()}),$("#videoUploadUrl").on("change",function(){$("#videoPreview").show().html('<source src="'+this.value+'" type="video/mp4"/>')})}}();