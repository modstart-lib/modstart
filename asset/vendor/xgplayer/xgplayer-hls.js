!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.array.join.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.from.js"),require("core-js/modules/es.string.iterator.js"),require("xgplayer"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/web.url.js"),require("core-js/modules/web.url-search-params.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.function.name.js"),require("core-js/modules/es.json.stringify.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.promise.finally.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.typed-array.uint8-array.js"),require("core-js/modules/esnext.typed-array.at.js"),require("core-js/modules/es.typed-array.copy-within.js"),require("core-js/modules/es.typed-array.every.js"),require("core-js/modules/es.typed-array.fill.js"),require("core-js/modules/es.typed-array.filter.js"),require("core-js/modules/es.typed-array.find.js"),require("core-js/modules/es.typed-array.find-index.js"),require("core-js/modules/esnext.typed-array.find-last.js"),require("core-js/modules/esnext.typed-array.find-last-index.js"),require("core-js/modules/es.typed-array.for-each.js"),require("core-js/modules/es.typed-array.includes.js"),require("core-js/modules/es.typed-array.index-of.js"),require("core-js/modules/es.typed-array.iterator.js"),require("core-js/modules/es.typed-array.join.js"),require("core-js/modules/es.typed-array.last-index-of.js"),require("core-js/modules/es.typed-array.map.js"),require("core-js/modules/es.typed-array.reduce.js"),require("core-js/modules/es.typed-array.reduce-right.js"),require("core-js/modules/es.typed-array.reverse.js"),require("core-js/modules/es.typed-array.set.js"),require("core-js/modules/es.typed-array.slice.js"),require("core-js/modules/es.typed-array.some.js"),require("core-js/modules/es.typed-array.sort.js"),require("core-js/modules/es.typed-array.subarray.js"),require("core-js/modules/es.typed-array.to-locale-string.js"),require("core-js/modules/es.typed-array.to-string.js"),require("core-js/modules/es.string.replace.js"),require("core-js/modules/es.number.is-nan.js"),require("core-js/modules/es.number.constructor.js"),require("core-js/modules/es.object.get-prototype-of.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.string.trim.js"),require("core-js/modules/es.set.js"),require("core-js/modules/es.number.is-finite.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.regexp.test.js"),require("core-js/modules/es.regexp.flags.js"),require("core-js/modules/es.string.pad-start.js"),require("core-js/modules/es.array-buffer.constructor.js"),require("core-js/modules/es.typed-array.int8-array.js"),require("core-js/modules/es.typed-array.uint8-clamped-array.js"),require("core-js/modules/es.typed-array.int16-array.js"),require("core-js/modules/es.typed-array.uint16-array.js"),require("core-js/modules/es.typed-array.int32-array.js"),require("core-js/modules/es.typed-array.uint32-array.js"),require("core-js/modules/es.typed-array.float32-array.js"),require("core-js/modules/es.typed-array.float64-array.js"),require("core-js/modules/es.regexp.constructor.js"),require("core-js/modules/es.regexp.sticky.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.string.match.js"),require("core-js/modules/es.array.find-index.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es.object.assign.js","core-js/modules/es.array.concat.js","core-js/modules/es.array.slice.js","core-js/modules/es.array.join.js","core-js/modules/es.array.map.js","core-js/modules/es.array.from.js","core-js/modules/es.string.iterator.js","xgplayer","core-js/modules/es.object.to-string.js","core-js/modules/web.dom-collections.for-each.js","core-js/modules/es.object.keys.js","core-js/modules/es.promise.js","core-js/modules/es.array.iterator.js","core-js/modules/web.dom-collections.iterator.js","core-js/modules/web.url.js","core-js/modules/web.url-search-params.js","core-js/modules/es.array.splice.js","core-js/modules/es.regexp.exec.js","core-js/modules/es.function.name.js","core-js/modules/es.json.stringify.js","core-js/modules/es.array.includes.js","core-js/modules/es.promise.finally.js","core-js/modules/es.array.filter.js","core-js/modules/es.typed-array.uint8-array.js","core-js/modules/esnext.typed-array.at.js","core-js/modules/es.typed-array.copy-within.js","core-js/modules/es.typed-array.every.js","core-js/modules/es.typed-array.fill.js","core-js/modules/es.typed-array.filter.js","core-js/modules/es.typed-array.find.js","core-js/modules/es.typed-array.find-index.js","core-js/modules/esnext.typed-array.find-last.js","core-js/modules/esnext.typed-array.find-last-index.js","core-js/modules/es.typed-array.for-each.js","core-js/modules/es.typed-array.includes.js","core-js/modules/es.typed-array.index-of.js","core-js/modules/es.typed-array.iterator.js","core-js/modules/es.typed-array.join.js","core-js/modules/es.typed-array.last-index-of.js","core-js/modules/es.typed-array.map.js","core-js/modules/es.typed-array.reduce.js","core-js/modules/es.typed-array.reduce-right.js","core-js/modules/es.typed-array.reverse.js","core-js/modules/es.typed-array.set.js","core-js/modules/es.typed-array.slice.js","core-js/modules/es.typed-array.some.js","core-js/modules/es.typed-array.sort.js","core-js/modules/es.typed-array.subarray.js","core-js/modules/es.typed-array.to-locale-string.js","core-js/modules/es.typed-array.to-string.js","core-js/modules/es.string.replace.js","core-js/modules/es.number.is-nan.js","core-js/modules/es.number.constructor.js","core-js/modules/es.object.get-prototype-of.js","core-js/modules/es.symbol.js","core-js/modules/es.string.trim.js","core-js/modules/es.set.js","core-js/modules/es.number.is-finite.js","core-js/modules/es.array.find.js","core-js/modules/es.string.includes.js","core-js/modules/es.regexp.to-string.js","core-js/modules/es.regexp.test.js","core-js/modules/es.regexp.flags.js","core-js/modules/es.string.pad-start.js","core-js/modules/es.array-buffer.constructor.js","core-js/modules/es.typed-array.int8-array.js","core-js/modules/es.typed-array.uint8-clamped-array.js","core-js/modules/es.typed-array.int16-array.js","core-js/modules/es.typed-array.uint16-array.js","core-js/modules/es.typed-array.int32-array.js","core-js/modules/es.typed-array.uint32-array.js","core-js/modules/es.typed-array.float32-array.js","core-js/modules/es.typed-array.float64-array.js","core-js/modules/es.regexp.constructor.js","core-js/modules/es.regexp.sticky.js","core-js/modules/es.string.split.js","core-js/modules/es.string.match.js","core-js/modules/es.array.find-index.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).HlsPlayer=t(0,0,0,0,0,0,0,e.Player)}(this,function(e,t,r,n,i,s,a,o){"use strict";function u(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach(function(e){k(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function A(){A=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,c=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function o(e,t,r,n){var i,s,a,o,t=t&&t.prototype instanceof h?t:h,t=Object.create(t.prototype),n=new b(n||[]);return c(t,"_invoke",{value:(i=e,s=r,a=n,o="suspendedStart",function(e,t){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===e)throw t;return{value:void 0,done:!0}}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){var n=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=l(i,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;i=i.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}(r,a);if(n){if(n===d)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";n=l(i,s,a);if("normal"===n.type){if(o=a.done?"completed":"suspendedYield",n.arg===d)continue;return{value:n.arg,done:a.done}}"throw"===n.type&&(o="completed",a.method="throw",a.arg=n.arg)}})}),t}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=o;var d={};function h(){}function f(){}function p(){}var v={};s(v,n,function(){return this});t=Object.getPrototypeOf,t=t&&t(t(S([])));t&&t!==e&&u.call(t,n)&&(v=t);var m=p.prototype=h.prototype=Object.create(v);function y(e){["next","throw","return"].forEach(function(t){s(e,t,function(e){return this._invoke(t,e)})})}function _(a,o){var t;c(this,"_invoke",{value:function(r,n){function e(){return new o(function(e,t){!function t(e,r,n,i){e=l(a[e],a,r);if("throw"!==e.type){var s=e.arg;return(r=s.value)&&"object"==typeof r&&u.call(r,"__await")?o.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):o.resolve(r).then(function(e){s.value=e,n(s)},function(e){return t("throw",e,n,i)})}i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function g(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(g,this),this.reset(!0)}function S(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return e.next=e}}return{next:E}}function E(){return{value:void 0,done:!0}}return c(m,"constructor",{value:f.prototype=p,configurable:!0}),c(p,"constructor",{value:f,configurable:!0}),f.displayName=s(p,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e},a.awrap=function(e){return{__await:e}},y(_.prototype),s(_.prototype,r,function(){return this}),a.AsyncIterator=_,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var s=new _(o(e,t,r,n),i);return a.isGeneratorFunction(t)?s:s.next().then(function(e){return e.done?e.value:s.next()})},y(m),s(m,i,"Generator"),s(m,n,function(){return this}),s(m,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return s.type="throw",s.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],s=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=u.call(i,"catchLoc"),o=u.call(i,"finallyLoc");if(a&&o){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var s=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n,i=r.completion;return"throw"===i.type&&(n=i.arg,k(r)),n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},a}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,r,n,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return r(e),0}o.done?t(u):Promise.resolve(u).then(n,i)}function C(o){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=o.apply(e,a);function i(e){c(n,t,r,i,s,"next",e)}function s(e){c(n,t,r,i,s,"throw",e)}i(void 0)})}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,O(n.key),n)}}function g(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function k(e,t,r){return(t=O(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p(e,t,r){return(p=f()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);n=new(Function.bind.apply(e,n));return r&&h(n,r.prototype),n}).apply(null,arguments)}function v(e){var r="function"==typeof Map?new Map:void 0;return(v=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return p(e,arguments,d(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),h(t,e)})(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(r){var n=f();return function(){var e,t=d(r);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}(this,n?(e=d(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function x(){return(x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){t=Object.getOwnPropertyDescriptor(n,t);return t.get?t.get.call(arguments.length<3?e:r):t.value}}).apply(this,arguments)}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,s,a,o=[],u=!0,c=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=s.call(r)).done)&&(o.push(n.value),o.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return o}}(e,t)||D(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}()||D(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){if(e){if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O(e){e=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);e=t.call(e,"string");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"==typeof e?e:String(e)}function R(){var r,n,e=new Promise(function(e,t){r=e,n=t});return e.used=!1,e.resolve=function(){return e.used=!0,r.apply(void 0,arguments)},e.reject=function(){return e.used=!0,n.apply(void 0,arguments)},e}function j(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}var I=(g(Q,null,[{key:"start",value:function(e){return!e||!e.length||1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0)}},{key:"end",value:function(e){return!e||!e.length||1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1)}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(e){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var s,a=r.length;a&&t?(a=(s=r[a-1])[1],e.start(n)-a<=t?a<(a=e.end(n))&&(s[1]=a):r.push([e.start(n),e.end(n)])):r.push([e.start(n),e.end(n)])}return r}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce(function(e,t){return e+(t[1]-t[0])},0):0}},{key:"info",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(!e||!e.length)return{start:0,end:0,buffers:[]};for(var n=0,i=0,s=0,a=0,o=0,u=0,c=0,l=Q.buffers(e,r),d=0,h=l.length;d<h;d++){var f=l[d];if(t+r>=f[0]&&t<=f[1])n=f[0],i=f[1],s=d;else{if(t+r<f[0]){a=f[0],o=f[1];break}t+r>f[1]&&(u=f[0],c=f[1])}}return{start:n,end:i,index:s,buffers:l,nextStart:a,nextEnd:o,prevStart:u,prevEnd:c,currentTime:t,behind:t-n,remaining:i?i-t:0,length:Q.totalLength&&Q.totalLength(l)}}}]),Q),P="manifest",B="network",U="network_timeout",M="demux",N="remux",F="media",V="other",z={FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"},q=(k(bt={},P,{HLS:1100,DASH:1200}),k(bt,B,2100),k(bt,U,2101),k(bt,"network_forbidden",2103),k(bt,"network_notfound",2104),k(bt,"network_range_not_satisfiable",2116),k(bt,M,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),k(bt,N,{FMP4:4100,MP4:4200}),k(bt,F,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,EME_HIJACK:5301}),k(bt,"drm",{LICENSE:7100,CUSTOM_LICENSE:7200}),k(bt,V,8e3),k(bt,"runtime",{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),bt),G=function(){b(a,v(Error));var s=E(a);function a(e,t,r,n,i){return _(this,a),(i=s.call(this,i||(null==r?void 0:r.message))).errorType=e===U?B:e,i.originError=r,i.ext=n,i.errorCode=q[e][t]||q[e],i.errorMessage=i.message,i.errorCode||(i.errorType=V,i.errorCode=q[i.errorType]),i}return g(a,null,[{key:"create",value:function(e,t,r,n,i){return e instanceof a?e:(e instanceof Error&&(r=e,e=""),new a(e=e||V,t,r,n,i))}},{key:"network",value:function(e){var t;return new a(null!=e&&e.isTimeout?U:B,null,e instanceof Error?e:null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),a}(),H="undefined"!=typeof window,K={DEBUG:1,LOG:2,WARN:3,ERROR:4},Y=["Boolean","Number","String","Undefined","Null","Date","Object"],W=(g(X,[{key:"debug",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logCache.apply(this,[K.DEBUG].concat(r)),X.disabled||(e=console).debug.apply(e,[this._prefix,J()].concat(r))}},{key:"log",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logCache.apply(this,[K.LOG].concat(r)),X.disabled||(e=console).log.apply(e,[this._prefix,J()].concat(r))}},{key:"warn",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logCache.apply(this,[K.WARN].concat(r)),X.disabled||(e=console).warn.apply(e,[this._prefix,J()].concat(r))}},{key:"error",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logCache.apply(this,[K.ERROR].concat(r)),X.disabled||(e=console).error.apply(e,[this._prefix,J()].concat(r))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var s=n.map(function(e){return function e(t,r,n){n=n||1,r=r||2;var i={};if(!t||"object"!==y(t))return t;var s=Object.prototype.toString.call(t).slice(8,-1);if(!Y.includes(s))return s;if(!(r<n)){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n===r?i[a]=Z(t[a]):"object"===y(t[a])?i[a]=e(t[a],r,n+1):i[a]=t[a]);return i}}(e)}),t=this._prefix+J()+JSON.stringify(s)}catch(e){return}e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize&&(t=this.logTextArray.shift(),this.logSize-=t.length)}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var e;X.disabled||(console.group(this._prefix),(e=console).table.apply(e,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){X.disabled=!1}},{key:"disable",value:function(){X.disabled=!0}}]),X);function X(e,t){_(this,X),this.name=e||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(null==t?void 0:t.logCacheLevel)||3,this.logMaxSize=(null==t?void 0:t.logMaxSize)||204800,this.logSize=0,this.logTextArray=[]}function Q(){_(this,Q)}function J(){return(new Date).toLocaleString()}function Z(e){if("object"!==y(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}k(W,"disabled",!0);var $,ee,te,re=function(){try{return H?window.MediaSource:null}catch(e){}}(),ne="updateDuration",ie=(g(se,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"isFull",value:function(e){return e?this._mseFullFlag[e]:this._mseFullFlag[se.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,r=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var n=0;if(Object.keys(this._sourceBuffer).forEach(function(e){try{n=Math.max(t.bufferEnd(e)||0,n)}catch(e){}}),e<n)return Promise.resolve()}return this._enqueueBlockingOp(function(){t.isEnded?t._logger.debug("[debug mse] setDuration ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))},ne,{isReduceDuration:r})}},{key:"open",value:function(){var r,n=this;return this._openPromise.used&&!this.isOpened&&this.mediaSource&&((r=this.mediaSource).addEventListener("sourceopen",function e(){var t=j()-n._st;n._logger.debug("MSE OPEN",t),r.removeEventListener("sourceopen",e),n._openPromise.resolve({costtime:t})}),this._openPromise=R()),this._openPromise}},{key:"bindMedia",value:(te=C(A().mark(function e(r){var n,t,i=this;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource||this.media)return e.next=3,this.unbindMedia();e.next=3;break;case 3:if(r&&re){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=r,n=this.mediaSource=new re,this._st=j(),t=function e(){var t=j()-i._st;i._logger.debug("MSE OPEN"),n.removeEventListener("sourceopen",e),URL.revokeObjectURL(r.src),i._openPromise.resolve({costtime:t})},n.addEventListener("sourceopen",t),this._url=URL.createObjectURL(n),r.src=this._url,e.abrupt("return",this._openPromise);case 13:case"end":return e.stop()}},e,this)})),function(e){return te.apply(this,arguments)})},{key:"unbindMedia",value:(ee=C(A().mark(function e(){var t,r,n,i=this;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach(function(e){e=i._queue[e];e&&e.forEach(function(e){var t;return null===(e=e.promise)||void 0===e||null===(t=e.resolve)||void 0===t?void 0:t.call(e)})}),r=!!this.media&&1<=this.media.readyState,n="open"===t.readyState,r&&n)try{t.endOfStream()}catch(e){}Object.keys(this._sourceBuffer).forEach(function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(e){}})}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(e){}this.media=null}this.mediaSource=null,this._openPromise=R(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(e){throw new G(F,z.MSE_ADD_SB,e)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this,n=this._sourceBuffer[e];return this.mediaSource&&n&&n.mimeType!==t?"function"!=typeof n.changeType?Promise.reject():this._enqueueOp(e,function(){n.changeType(t),n.mimeType=t,r._onSBUpdateEnd(e)},"changeType",{mimeType:t}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(t,r,n){var i=this;return r&&r.byteLength&&this._sourceBuffer[t]?this._enqueueOp(t,function(){var e;i.mediaSource&&!i.media.error&&(i._logger.debug("MSE APPEND START",n),i._opst=j(),null===(e=i._sourceBuffer[t])||void 0===e||e.appendBuffer(r))},"appendBuffer",n):Promise.resolve()}},{key:"remove",value:function(t,r,n,i){var s=this,e=!1;return this._mseFullFlag[t]&&(e=!0),this._enqueueOp(t,function(){var e;s.mediaSource&&!s.media.error&&(e=s._sourceBuffer[t],n<=r||!e?s._onSBUpdateEnd(t):(s._opst=j(),s._logger.debug("MSE REMOVE START",t,r,n,i),e.remove(r,n)))},"removeBuffer",i,e)}},{key:"clearBuffer",value:function(t,r){var n,i=this;return Object.keys(this._sourceBuffer).forEach(function(e){n=i.remove(e,t,r)}),n||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var r,n=this;return Object.keys(this._sourceBuffer).forEach(function(e){var t=n._sourceBuffer[e];r=n.remove(e,0,I.end(I.get(t)))}),r}},{key:"clearOpQueues",value:function(e,t){this._logger.debug("MSE clearOpQueue START");var r,n=this._queue[e];t&&n?this._queue[e]=[]:!n||!n[e]||n.length<5||(r=[],n.forEach(function(e){e.context&&e.context.isinit&&r.push(e)}),this._queue[e]=n.slice(0,2),0<r.length&&(e=this._queue[e]).push.apply(e,r))}},{key:"endOfStream",value:function(t){var r=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp(function(){var e=r.mediaSource;e&&"open"===e.readyState&&(r._logger.debug("MSE endOfStream START"),t?e.endOfStream(t):e.endOfStream())},"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null==r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return I.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return I.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return I.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,n,i){var s=this;if(!this.mediaSource)return Promise.resolve();var a=this._queue[e]=this._queue[e]||[],n={exec:t,promise:R(),opName:r,context:n};return i?(a.splice(0,0,n),this._mseFullFlag[e]=!1,this._startQueue(e)):a.push(n),this.isOpened||this.isEnded?1===a.length&&this._startQueue(e):this._openPromise.then(function(){1===a.length&&s._startQueue(e)}),n.promise}},{key:"_enqueueBlockingOp",value:($=C(A().mark(function e(t,n,i){var r,s,a=this;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((r=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return s=[],r.forEach(function(e){var t=a._queue[e],r=R();s.push(r),t.push({exec:function(){r.resolve()},promise:r,opName:n,context:i}),1===t.length&&a._startQueue(e)}),e.abrupt("return",Promise.all(s).then(function(){try{return t()}finally{r.forEach(function(e){var t=a._queue[e],r=a._sourceBuffer[e];null==t||t.shift(),r&&r.updating||a._startQueue(e)})}}));case 8:case"end":return e.stop()}},e,this)})),function(e,t,r){return $.apply(this,arguments)})},{key:"_startQueue",value:function(t){var r=this._queue[t];if(r){var n=r[0];if(n&&!this._mseFullFlag[t])try{n.exec()}catch(e){e&&e.message&&0<=e.message.indexOf("SourceBuffer is full")?(this._mseFullFlag[t]=!0,this._logger.error("[MSE error],  context,",n.context," ,name,",n.opName,",err,SourceBuffer is full"),n.promise.reject(new G(F,z.MSE_FULL,e))):(this._logger.error(e),n.promise.reject(new G(F,z.MSE_OTHER,e)),r.shift(),this._startQueue(t))}}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this._enqueueOp(e,function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)},"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)},"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!re)return!1;try{return re.isTypeSupported(t)}catch(e){return this._logger.error(t,e),!1}}}]),se);function se(e,t){var n=this;_(this,se),k(this,"media",null),k(this,"mediaSource",null),k(this,"_openPromise",R()),k(this,"_queue",Object.create(null)),k(this,"_sourceBuffer",Object.create(null)),k(this,"_mseFullFlag",{}),k(this,"_st",0),k(this,"_opst",0),k(this,"_logger",null),k(this,"_config",null),k(this,"_url",null),k(this,"_onSBUpdateEnd",function(e){var t,r=n._queue[e];r&&((null==(t=r[0])?void 0:t.opName)!==ne&&r.shift(),t&&(r=j()-n._opst,n._logger.debug("UpdateEnd",t.opName,r,t.context),t.promise.resolve({name:t.opName,context:t.context,costtime:r}),n._startQueue(e)))}),k(this,"_onSBUpdateError",function(e,t){var r=n._queue[e];!r||(r=r[0])&&(n._logger.error("UpdateError",e,r.opName,r.context),r.promise.reject(new G(F,z.MSE_APPEND_BUFFER,t)))}),this._config=Object.assign(se.getDefaultConfig(),t),e&&this.bindMedia(e),this._logger=new W("MSE"),this._config.openLog&&W.enable()}k(ie,"VIDEO","video"),k(ie,"AUDIO","audio");var ae="fetch",oe="xhr",ue="arraybuffer",ce="text",le=function(){b(s,v(Error));var i=E(s);function s(e,t,r,n){return _(this,s),k(S(n=i.call(this,n)),"retryCount",0),k(S(n),"isTimeout",!1),k(S(n),"loaderType",ae),k(S(n),"startTime",0),k(S(n),"endTime",0),k(S(n),"options",{}),n.url=e,n.request=t,n.response=r,n}return g(s)}(),de=Object.prototype.toString;function he(e){if("[object Object]"===de.call(e)){e=Object.getPrototypeOf(e);return null===e||e===Object.prototype}}function fe(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function pe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ve(e,t){if(e){if(!t)return e;var n,r,i=Object.keys(t).map(function(r){if(null!=(n=t[r]))return Array.isArray(n)?r+="[]":n=[n],n.map(function(e){var t=e;return"[object Date]"===de.call(t)?e=e.toISOString():null!==e&&"object"===y(e)&&(e=JSON.stringify(e)),"".concat(pe(r),"=").concat(pe(e))}).join("&")}).filter(Boolean).join("&");return i&&(-1!==(r=e.indexOf("#"))&&(e=e.slice(0,r)),e+=(-1===e.indexOf("?")?"?":"&")+i),e}}function me(e,t,r,n,i,s,a,o,u,c,l){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),{data:e,done:t,options:{range:u,vid:c,index:o,contentLength:n=Number.isNaN(n)?0:n,age:i,startTime:s,firstByteTime:a,endTime:Date.now(),priOptions:l},response:r}}function ye(e,t){return Math.round(8*e*1e3/t/1024)}var _e,ge,ke={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},be={exports:{}};function Se(){}function Ee(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function xe(e,t,r,n,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");i=new Ee(r,n||e,i),t=ge?ge+t:t;return e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],i]:e._events[t].push(i):(e._events[t]=i,e._eventsCount++),e}function Te(e,t){0==--e._eventsCount?e._events=new Se:delete e._events[t]}function we(){this._events=new Se,this._eventsCount=0}bt=be,_e=Object.prototype.hasOwnProperty,ge="~",Object.create&&(Se.prototype=Object.create(null),(new Se).__proto__||(ge=!1)),we.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)_e.call(e,t)&&r.push(ge?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},we.prototype.listeners=function(e){var e=ge?ge+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,i=new Array(n);r<n;r++)i[r]=t[r].fn;return i},we.prototype.listenerCount=function(e){e=ge?ge+e:e,e=this._events[e];return e?e.fn?1:e.length:0},we.prototype.emit=function(e,t,r,n,i,s){var a=ge?ge+e:e;if(!this._events[a])return!1;var o,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,i),!0;case 6:return u.fn.call(u.context,t,r,n,i,s),!0}for(h=1,o=new Array(c-1);h<c;h++)o[h-1]=arguments[h];u.fn.apply(u.context,o)}else for(var l,d=u.length,h=0;h<d;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,r);break;case 4:u[h].fn.call(u[h].context,t,r,n);break;default:if(!o)for(l=1,o=new Array(c-1);l<c;l++)o[l-1]=arguments[l];u[h].fn.apply(u[h].context,o)}return!0},we.prototype.on=function(e,t,r){return xe(this,e,t,r,!1)},we.prototype.once=function(e,t,r){return xe(this,e,t,r,!0)},we.prototype.removeListener=function(e,t,r,n){e=ge?ge+e:e;if(!this._events[e])return this;if(!t)return Te(this,e),this;var i=this._events[e];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||Te(this,e);else{for(var s=0,a=[],o=i.length;s<o;s++)(i[s].fn!==t||n&&!i[s].once||r&&i[s].context!==r)&&a.push(i[s]);a.length?this._events[e]=1===a.length?a[0]:a:Te(this,e)}return this},we.prototype.removeAllListeners=function(e){return e?(e=ge?ge+e:e,this._events[e]&&Te(this,e)):(this._events=new Se,this._eventsCount=0),this},we.prototype.off=we.prototype.removeListener,we.prototype.addListener=we.prototype.on,we.prefixed=ge,bt.exports=we.EventEmitter=we;var De,Ae=be.exports,Ce=function(){b(r,Ae);var e,t=E(r);function r(){var e;return _(this,r),k(S(e=t.call(this)),"_abortController",null),k(S(e),"_timeoutTimer",null),k(S(e),"_reader",null),k(S(e),"_response",null),k(S(e),"_aborted",!1),k(S(e),"_index",-1),k(S(e),"_range",null),k(S(e),"_receivedLength",0),k(S(e),"_running",!1),k(S(e),"_logger",null),k(S(e),"_vid",""),k(S(e),"_onProcessMinLen",0),k(S(e),"_onCancel",null),k(S(e),"_priOptions",null),e}return g(r,[{key:"load",value:function(e){var u=this,c=e.url,t=e.vid,r=e.timeout,l=e.responseType,d=e.onProgress,h=e.index,n=e.onTimeout,i=e.onCancel,f=e.range,p=e.transformResponse,s=e.request,a=e.params,o=e.logger,v=e.method,m=e.headers,y=e.body,_=e.mode,g=e.credentials,k=e.cache,b=e.redirect,S=e.referrer,E=e.referrerPolicy,x=e.onProcessMinLen,e=e.priOptions;this._logger=o,this._aborted=!1,this._onProcessMinLen=x,this._onCancel=i,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=h,this._range=f||[0,0],this._vid=t||c,this._priOptions=e||{};var T={method:v,headers:m,body:y,mode:_,credentials:g,cache:k,redirect:b,referrer:S,referrerPolicy:E,signal:null===(E=this._abortController)||void 0===E?void 0:E.signal},w=!1;clearTimeout(this._timeoutTimer);c=ve(c,a),a=fe(f);a&&(m=s?s.headers:T.headers=T.headers||(Headers?new Headers:{}),Headers&&m instanceof Headers?m.append("Range",a):m.Range=a),r&&(this._timeoutTimer=setTimeout(function(){var e;w=!0,u.cancel(),n&&((e=new le(c,T,null,"timeout")).isTimeout=!0,n(e,{index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions}))},r));var D=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",f),new Promise(function(a,o){var t;fetch(s||c,s?void 0:T).then((t=C(A().mark(function e(t){var r,n,i,s;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(u._timeoutTimer),u._response=t,u._aborted||!u._running)return e.abrupt("return");e.next=4;break;case 4:if((t=p?p(t,c)||t:t).ok){e.next=7;break}throw new le(c,T,t,"bad network response");case 7:if(r=Date.now(),l===ce)return e.next=11,t.text();e.next=15;break;case 11:n=e.sent,u._running=!1,e.next=37;break;case 15:if("json"===l)return e.next=18,t.json();e.next=22;break;case 18:n=e.sent,u._running=!1,e.next=37;break;case 22:if(d)return u.resolve=a,u.reject=o,u._loadChunk(t,d,D,r),e.abrupt("return");e.next=29;break;case 29:return e.next=31,t.arrayBuffer();case 31:n=e.sent,n=new Uint8Array(n),u._running=!1,i=Date.now()-D,s=ye(n.byteLength,i),u.emit(ke.REAL_TIME_SPEED,{speed:s,len:n.byteLength,time:i,vid:u._vid,index:u._index,range:u._range,priOptions:u._priOptions});case 37:u._logger.debug("[fetch load end], index,",h,",range,",f),a(me(n,!0,t,t.headers.get("Content-Length"),t.headers.get("age"),D,r,h,f,u._vid,u._priOptions));case 39:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})).catch(function(e){clearTimeout(u._timeoutTimer),u._running=!1,u._aborted&&!w||((e=e instanceof le?e:new le(c,T,null,null===e||void 0===e?void 0:e.message)).startTime=D,e.endTime=Date.now(),e.isTimeout=w,e.options={index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions},o(e))})})}},{key:"cancel",value:(e=C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._aborted)return e.abrupt("return");e.next=2;break;case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,this._reader)return e.next=9,this._reader.cancel();e.next=9;break;case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(e){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return e.apply(this,arguments)})},{key:"_loadChunk",value:function(a,o,u,c){var l=this;if(!a.body||!a.body.getReader){this._running=!1;var e=new le(a.url,"",a,"onProgress of bad response.body.getReader");return e.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(e)}0<this._onProcessMinLen&&(this._cache=new Uint8Array(2097152),this._writeIdx=0);var d,h,f,t,p=this._reader=a.body.getReader(),v=(t=C(A().mark(function e(){var t,r,n,i,s;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h=Date.now(),e.prev=1,e.next=4,p.read();case 4:d=e.sent,f=Date.now(),e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(1),f=Date.now(),l._aborted||(l._running=!1,e.t0.options={index:l._index,range:l._range,vid:l._vid,priOptions:l._priOptions},l.reject(e.t0)),e.abrupt("return");case 13:if(t=0<(null===(s=l._range)||void 0===s?void 0:s.length)?l._range[0]:0,r=t+l._receivedLength,l._aborted)return l._running=!1,o(void 0,!1,{range:[r,r],vid:l._vid,index:l._index,startTime:h,endTime:f,st:u,firstByteTime:c,priOptions:l._priOptions},a),e.abrupt("return");e.next=19;break;case 19:s=d.value?d.value.byteLength:0,l._receivedLength+=s,l._logger.debug("【fetchLoader,onProgress call】,task,",l._range,", start,",r,", end,",t+l._receivedLength,", done,",d.done),0<l._onProcessMinLen?l._writeIdx+s>=l._onProcessMinLen||d.done?((n=new Uint8Array(l._writeIdx+s)).set(l._cache.slice(0,l._writeIdx),0),0<s&&n.set(d.value,l._writeIdx),l._writeIdx=0,l._logger.debug("【fetchLoader,onProgress enough】,done,",d.done,",len,",n.byteLength,", writeIdx,",l._writeIdx)):0<s&&l._writeIdx+s<2097152?(l._cache.set(d.value,l._writeIdx),l._writeIdx+=s,l._logger.debug("【fetchLoader,onProgress cache】,len,",s,", writeIdx,",l._writeIdx)):0<s&&(i=new Uint8Array(l._writeIdx+s+2048),l._logger.debug("【fetchLoader,onProgress extra start】,size,",l._writeIdx+s+2048,", datalen,",s,", writeIdx,",l._writeIdx),i.set(l._cache.slice(0,l._writeIdx),0),0<s&&i.set(d.value,l._writeIdx),l._writeIdx+=s,delete l._cache,l._cache=i,l._logger.debug("【fetchLoader,onProgress extra end】,len,",s,", writeIdx,",l._writeIdx)):n=d.value,(n&&0<n.byteLength||d.done)&&o(n,d.done,{range:[l._range[0]+l._receivedLength-(n?n.byteLength:0),l._range[0]+l._receivedLength],vid:l._vid,index:l._index,startTime:h,endTime:f,st:u,firstByteTime:c,priOptions:l._priOptions},a),d.done?(i=Date.now()-u,s=ye(l._receivedLength,i),l.emit(ke.REAL_TIME_SPEED,{speed:s,len:l._receivedLength,time:i,vid:l._vid,index:l._index,range:l._range,priOptions:l._priOptions}),l._running=!1,l._logger.debug("[fetchLoader onProgress end],task,",l._range,",done,",d.done),l.resolve(me(d,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),u,c,l._index,l._range,l._vid,l._priOptions))):v();case 25:case"end":return e.stop()}},e,null,[[1,8]])})),function(){return t.apply(this,arguments)});v()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),r}(),Le=function(){b(r,Ae);var t=E(r);function r(){var e;return _(this,r),k(S(e=t.call(this)),"_xhr",null),k(S(e),"_aborted",!1),k(S(e),"_timeoutTimer",null),k(S(e),"_range",null),k(S(e),"_receivedLength",0),k(S(e),"_url",null),k(S(e),"_onProgress",null),k(S(e),"_index",-1),k(S(e),"_headers",null),k(S(e),"_currentChunkSizeKB",384),k(S(e),"_timeout",null),k(S(e),"_xhr",null),k(S(e),"_withCredentials",null),k(S(e),"_startTime",-1),k(S(e),"_loadCompleteResolve",null),k(S(e),"_loadCompleteReject",null),k(S(e),"_runing",!1),k(S(e),"_logger",!1),k(S(e),"_vid",""),k(S(e),"_responseType",void 0),k(S(e),"_credentials",void 0),k(S(e),"_method",void 0),k(S(e),"_transformResponse",void 0),k(S(e),"_firstRtt",void 0),k(S(e),"_onCancel",null),k(S(e),"_priOptions",null),e}return g(r,[{key:"load",value:function(e){var r=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=ve(e.url,e.params);var t=Date.now();return new Promise(function(e,t){r._loadCompleteResolve=e,r._loadCompleteReject=t,r._startLoad()}).catch(function(e){if(clearTimeout(r._timeoutTimer),r._runing=!1,!r._aborted)throw(e=e instanceof le?e:new le(r._url,r._request)).startTime=t,e.endTime=Date.now(),e.options={index:r._index,vid:r._vid,priOptions:r._priOptions},e})}},{key:"_startLoad",value:function(){var e,t,r,n=null;this._responseType===ue&&this._range&&1<this._range.length&&(this._onProgress?(this._firstRtt=-1,e=1024*this._currentChunkSizeKB,t=this._range[0]+this._receivedLength,r=this._range[1],e<this._range[1]-t&&(r=t+e),this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",n=[t,r])):(n=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",n))),this._internalOpen(n)}},{key:"_internalOpen",value:function(t){var i=this;try{this._startTime=Date.now();var r=this._xhr=new XMLHttpRequest;r.open(this._method||"GET",this._url,!0),r.responseType=this._responseType,this._timeout&&(r.timeout=this._timeout),r.withCredentials=this._withCredentials,r.onload=this._onLoad.bind(this),r.onreadystatechange=this._onReadyStatechange.bind(this),r.onerror=function(e){var t,r;i._running=!1;var n=new le(i._url,i._request,null==e||null===(t=e.currentTarget)||void 0===t?void 0:t.response,"xhr.onerror.status:"+(null==e||null===(r=e.currentTarget)||void 0===r?void 0:r.status)+",statusText,"+(null==e||null===(n=e.currentTarget)||void 0===n?void 0:n.statusText));n.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(n)},r.ontimeout=function(e){i.cancel();var t=new le(i._url,i._request,{status:408},"timeout");i._onTimeout&&(t.isTimeout=!0,i._onTimeout(t,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})),t.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(t)};var n=this._headers||{},e=fe(t);e&&(n.Range=e),n&&Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",t),r.send(this._body)}catch(e){e.options={index:this._index,range:t,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(e)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||299<t){var r=new le(this._url,null,m(m({},e.target.response),{},{status:t}),"bad response,status:"+t);return r.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(r)}var n,i,s,a=null,o=!1,u=0<(null===(i=this._range)||void 0===i?void 0:i.length)?this._range[0]:0;this._responseType===ue?(r=new Uint8Array(e.target.response),s=u+this._receivedLength,r&&0<r.byteLength&&(this._receivedLength+=r.byteLength,n=Date.now()-this._startTime,i=ye(this._receivedLength,n),this.emit(ke.REAL_TIME_SPEED,{speed:i,len:this._receivedLength,time:n,vid:this._vid,index:this._index,range:[s,u+this._receivedLength],priOptions:this._priOptions})),o=!(1<(null===(n=this._range)||void 0===n?void 0:n.length)&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",s,"end ",u+this._receivedLength,",dataLen,",(a=r)?r.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",o)):(o=!0,a=e.target.response);t={ok:200<=t&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(t=this._transformResponse(t,this._url)||t),this._onProgress&&this._onProgress(a,o,{index:this._index,vid:this._vid,range:[s,u+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},t),o?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(me(this._onProgress?null:a,o,t,t.headers["content-length"],t.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,x(d(r.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=D(e))){t&&(e=t);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==t.return||t.return()}finally{if(a)throw i}}}}(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(e){n.e(e)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),r}(),Oe=["retry","retryDelay","onRetryError","transformError"],Re=(g(je,[{key:"exec",value:function(){var e,n=this,t=this._config,i=t.retry,s=t.retryDelay,a=t.onRetryError,o=t.transformError,u=function(e,t){if(null==e)return{};var r,n=function(e,t){if(null==e)return{};for(var r,n={},i=Object.keys(e),s=0;s<i.length;s++)r=i[s],0<=t.indexOf(r)||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),s=0;s<i.length;s++)r=i[s],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r]);return n}(t,Oe),c=(e=C(A().mark(function e(){var t,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._loader.load(u);case 3:r=e.sent,n.promise.resolve(r),e.next=27;break;case 7:if(e.prev=7,e.t0=e.catch(0),n._loader.running=!1,n._logger.debug("[task request catch err]",e.t0),n._canceled)return e.abrupt("return");e.next=13;break;case 13:if(e.t0.loaderType=n._loaderType,e.t0.retryCount=n._retryCount,t=e.t0,o&&(t=o(t)||t),a&&0<n._retryCount&&a(t,n._retryCount,{index:u.index,vid:u.vid,range:u.range,priOptions:u.priOptions}),n._retryCount++,r=!0,(r=n._retryCheckFunc?n._retryCheckFunc(e.t0):r)&&n._retryCount<=i)return clearTimeout(n._retryTimer),n._logger.debug("[task request setTimeout],retry",n._retryCount,",retry range,",u.range),n._retryTimer=setTimeout(c,s),e.abrupt("return");e.next=26;break;case 26:n.promise.reject(t);case 27:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return e.apply(this,arguments)});return c(),this.promise}},{key:"cancel",value:(De=C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}},e,this)})),function(){return De.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),je);function je(e,t){_(this,je),this.promise=R(),this.alive=!!t.onProgress,t.logger||(t.logger=new W("Loader")),this._loaderType=e,this._loader=new(e===ae&&window.fetch?Ce:Le),this._config=t,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=t.retryCheckFunc,this._logger=t.logger}function Ie(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=t.filter(Boolean)).length<2)return t[0];var n=new Uint8Array(t.reduce(function(e,t){return e+t.byteLength},0)),i=0;return t.forEach(function(e){n.set(e,i),i+=e.byteLength}),n}var Pe=function(){b(n,Ae);var e,r=E(n);function n(e){var t;return _(this,n),k(S(t=r.call(this,e)),"type",ae),k(S(t),"_queue",[]),k(S(t),"_alive",[]),k(S(t),"_currentTask",null),k(S(t),"_finnalUrl",""),k(S(t),"_config",void 0),t._config=m({loaderType:ae,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ce,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e),t._config.loaderType!==oe&&Ce.isSupported()||(t.type=oe),t.log=e.logger,t}return g(n,[{key:"isFetch",value:function(){return this.type===ae}},{key:"load",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?r=e:r.url=e||r.url||this._config.url,(r=Object.assign({},this._config,r)).params&&(r.params=Object.assign({},r.params)),r.headers&&he(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&he(r.body)&&(r.body=Object.assign({},r.body)),(r=r.transformRequest?r.transformRequest(r)||r:r).logger=this.log;r=new Re(this.type,r);return r.loader.on(ke.REAL_TIME_SPEED,function(e){t.emit(ke.REAL_TIME_SPEED,e)}),this._queue.push(r),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),r.promise}},{key:"cancel",value:(e=C(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map(function(e){return e.cancel()}).concat(this._alive.map(function(e){return e.cancel()})),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,function(e){var t=0<arguments.length&&void 0!==e?e:0;return new Promise(function(e){return setTimeout(e,t)})}();case 8:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_processTask",value:function(){var e,t=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),(e=this._currentTask.exec().catch(function(e){}))&&"function"==typeof e.finally&&e.finally(function(){var e;null!==(e=t._currentTask)&&void 0!==e&&e.alive&&0<(null===(e=t._alive)||void 0===e?void 0:e.length)&&(t._alive=t._alive.filter(function(e){return e&&e!==t._currentTask})),t._processTask()}))}}],[{key:"isFetchSupport",value:function(){return Ce.isSupported()}}]),n}(),Be=(g(gt,[{key:"do",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3,r=2<arguments.length?arguments[2]:void 0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;if(e){var i=e.currentTime,s=0;if(this._prevCurrentTime===i){var a=I.info(I.get(e),i);if(!a.buffers.length)return;r&&a.nextStart||a.nextStart&&a.nextStart-i<t?s=a.nextStart+.1:a.end&&a.end-i>n&&!e.seeking&&(s=i+.1)}this._prevCurrentTime=i,s&&i!==s&&(e.currentTime=s)}}}]),gt),Ue=(g(_t,[{key:"throw",value:function(e){var t,r,n,i=this;null!=e&&this._seiSet.size&&(t=e-.2,r=e+.2,n=[],this._seiSet.forEach(function(e){e.time>=t&&e.time<=r&&n.push(e)}),n.forEach(function(e){i._seiSet.delete(e),i.emitter.emit(ke.SEI_IN_TIME,e)}))}},{key:"reset",value:function(){this._seiSet.clear()}}]),_t),Me=(g(yt,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){e&&t&&(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}},{key:"getAvgSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce(function(e,t){return e+t})/this._speeds.length:this._chunkSpeeds.reduce(function(e,t){return e+t})/this._chunkSpeeds.length:0}},{key:"getLatestSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),yt),Ne=(g(mt,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setFpsFromScriptData",value:function(e){var e=e.data,t=null==e||null===(t=e.onMetaData)||void 0===t?void 0:t.framerate;t&&0<t&&t<100&&(this.fps=t)}},{key:"setVideoMeta",value:function(e){var t;this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&0<(t=e.fpsNum/e.fpsDen)&&t<100&&(this.fps=t)}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t,r=this;(!this.fps||100<=this.fps)&&e.length&&(t=e.reduce(function(e,t){return e+t.duration},0)/e.length,this.fps=Math.round(this._timescale/t)),e.forEach(function(e){-1===r._startGopId&&(r._startGopId=e.gopId),e.gopId===r._startGopId&&r.gop++,r._bitsAccumulateDuration+=e.duration/(r._timescale/1e3),r._bitsAccumulateSize+=e.units.reduce(function(e,t){return e+t.length},0),1e3<=r._bitsAccumulateDuration&&(r.bitrate=8*r._bitsAccumulateSize,r._bitsAccumulateDuration=0,r._bitsAccumulateSize=0)})}}]),mt),Fe=(g(vt,[{key:"getStats",value:function(){var e,t,r,n=(null===(s=this._core)||void 0===s?void 0:s.media)||{},i=n.currentTime,s=void 0===i?0:i,i=n.decodeFps,n=void 0===i?0:i;return m(m({},this._stats.getStats()),{},{downloadSpeed:(null===(i=this._core)||void 0===i||null===(e=i.speedInfo)||void 0===e?void 0:e.call(i).speed)||0,avgSpeed:(null===(i=this._core)||void 0===i||null===(t=i.speedInfo)||void 0===t?void 0:t.call(i).avgSpeed)||0,currentTime:s,bufferEnd:(null===(s=this._core)||void 0===s||null===(r=s.bufferInfo())||void 0===r?void 0:r.remaining)||0,decodeFps:n})}},{key:"_bindEvents",value:function(){var t=this;this._core.on(ke.DEMUXED_TRACK,function(e){e=e.videoTrack;return t._stats.updateBitrate(e.samples)}),this._core.on(ke.FLV_SCRIPT_DATA,function(e){t._stats.setFpsFromScriptData(e)}),this._core.on(ke.METADATA_PARSED,function(e){"video"===e.type?t._stats.setVideoMeta(e.track):t._stats.setAudioMeta(e.track)}),this._core.on(ke.TTFB,function(e){t._stats.setDomain(e.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new Ne(this._timescale)}}]),vt),Ve="video",ze="audio",qe="metadata",Ge="avc",He="hevc",Ke="aac",Ye="LARGE_AV_SHIFT",We="LARGE_VIDEO_GAP",Xe="LARGE_VIDEO_GAP_BETWEEN_CHUNK",Qe="LARGE_AUDIO_GAP",Je="AUDIO_FILLED",Ze="AUDIO_DROPPED",$e=(g(pt,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),pt),et=(g(ft,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===Ke)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),ft),tt=(g(ht,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),ht),rt=g(function e(t,r,n,i){_(this,e),k(this,"duration",1024),k(this,"flag",{dependsOn:2,isNonSyncSample:0}),k(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)}),nt=g(function e(t,r){_(this,e),k(this,"time",0),this.data=t,this.originPts=this.pts=r}),it=function(){b(t,nt);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t)}(),st=function(){b(t,nt);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t)}(),at=(g(dt,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),dt),ot=(g(lt,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){var t;this._bitsAvailable>e||(e-=this._bitsAvailable,e-=8*(t=Math.floor(e/8)),this._bytesAvailable-=t,this._loadWord()),this._word<<=e,this._bitsAvailable-=e}},{key:"readBits",value:function(e){if(32<e)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,0<this._bitsAvailable?this._word<<=t:0<this._bytesAvailable&&this._loadWord(),0<(t=e-t)&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){for(var e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)t=0===(r=0!==r?(t+this.readEG()+256)%256:r)?t:r}}]),lt),ut=(g(ct,[{key:"warn",value:function(){var e;if(!ct.disabled){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).warn.apply(e,[this._prefix].concat(r))}}}],[{key:"enable",value:function(){ct.disabled=!1}},{key:"disable",value:function(){ct.disabled=!0}}]),ct);function ct(e){_(this,ct),this.name=e||"",this._prefix="[".concat(this.name,"]")}function lt(e){if(_(this,lt),k(this,"_bytesAvailable",void 0),k(this,"_bitsAvailable",0),k(this,"_word",0),!e)throw new Error("ExpGolomb data params is required");this._data=e,this._bytesAvailable=e.byteLength,this._bytesAvailable&&this._loadWord()}function dt(){_(this,dt),k(this,"id",3),k(this,"type",qe),k(this,"timescale",0),k(this,"flvScriptSamples",[]),k(this,"seiSamples",[])}function ht(e,t,r){_(this,ht),k(this,"flag",{}),k(this,"keyframe",!1),k(this,"gopId",0),k(this,"duration",0),k(this,"size",0),k(this,"units",[]),k(this,"chromaFormat",420),this.originPts=this.pts=e,this.originDts=this.dts=t,r&&(this.units=r)}function ft(){_(this,ft),k(this,"id",2),k(this,"type",ze),k(this,"codecType",Ke),k(this,"pid",-1),k(this,"codec",""),k(this,"sequenceNumber",0),k(this,"sampleDuration",0),k(this,"timescale",0),k(this,"formatTimescale",0),k(this,"baseMediaDecodeTime",0),k(this,"duration",0),k(this,"warnings",[]),k(this,"samples",[]),k(this,"baseDts",0),k(this,"sampleSize",16),k(this,"sampleRate",0),k(this,"channelCount",0),k(this,"objectType",0),k(this,"sampleRateIndex",0),k(this,"config",[]),k(this,"present",!1),k(this,"isVideoEncryption",!1),k(this,"isAudioEncryption",!1),k(this,"kid",null),k(this,"ext",void 0)}function pt(){_(this,pt),k(this,"id",1),k(this,"type",Ve),k(this,"codecType",Ge),k(this,"pid",-1),k(this,"hvcC",void 0),k(this,"codec",""),k(this,"timescale",0),k(this,"formatTimescale",0),k(this,"sequenceNumber",0),k(this,"baseMediaDecodeTime",0),k(this,"baseDts",0),k(this,"duration",0),k(this,"warnings",[]),k(this,"samples",[]),k(this,"pps",[]),k(this,"sps",[]),k(this,"vps",[]),k(this,"fpsNum",0),k(this,"fpsDen",0),k(this,"sarRatio",[]),k(this,"width",0),k(this,"height",0),k(this,"nalUnitSize",4),k(this,"present",!1),k(this,"isVideoEncryption",!1),k(this,"isAudioEncryption",!1),k(this,"isVideo",!0),k(this,"kid",null),k(this,"pssh",null),k(this,"ext",void 0)}function vt(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;_(this,vt),k(this,"_core",null),k(this,"_samples",[]),this._core=e,this._timescale=t,this._stats=new Ne(t),this._bindEvents()}function mt(e){_(this,mt),k(this,"encodeType",""),k(this,"audioCodec",""),k(this,"videoCodec",""),k(this,"domain",""),k(this,"fps",0),k(this,"bitrate",0),k(this,"width",0),k(this,"height",0),k(this,"samplerate",0),k(this,"channelCount",0),k(this,"gop",0),k(this,"_bitsAccumulateSize",0),k(this,"_bitsAccumulateDuration",0),k(this,"_startGopId",-1),this._timescale=e}function yt(){_(this,yt),k(this,"_chunkSpeeds",[]),k(this,"_speeds",[])}function _t(e){var t=this;_(this,_t),k(this,"_seiSet",new Set),(this.emitter=e).on(ke.SEI,function(e){e&&t._seiSet.add(e)})}function gt(){_(this,gt),k(this,"_prevCurrentTime",0)}k(ut,"disabled",!0);var kt=(g(Tt,null,[{key:"decode",value:function(e){for(var t=[],r=e,n=0,i=e.length;n<i;)if(r[n]<128)t.push(String.fromCharCode(r[n])),++n;else{if(!(r[n]<192))if(r[n]<224){if(Tt._checkContinuation(r,n,1)){var s=(31&r[n])<<6|63&r[n+1];if(128<=s){t.push(String.fromCharCode(65535&s)),n+=2;continue}}}else if(r[n]<240){if(Tt._checkContinuation(r,n,2)){var a=(15&r[n])<<12|(63&r[n+1])<<6|63&r[n+2];if(2048<=a&&55296!=(63488&a)){t.push(String.fromCharCode(65535&a)),n+=3;continue}}}else if(r[n]<248&&Tt._checkContinuation(r,n,3)){a=(7&r[n])<<18|(63&r[n+1])<<12|(63&r[n+2])<<6|63&r[n+3];if(65536<a&&a<1114112){a-=65536,t.push(String.fromCharCode(a>>>10|55296)),t.push(String.fromCharCode(1023&a|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")}},{key:"_checkContinuation",value:function(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}}]),Tt),bt="undefined"!=typeof window,be=bt&&navigator.userAgent.toLocaleLowerCase(),St=bt&&/^((?!chrome|android).)*safari/.test(be),Et=bt&&be.includes("firefox"),xt=bt&&be.includes("android");function Tt(){_(this,Tt)}function wt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var t=t.filter(Boolean),n=new Uint8Array(t.reduce(function(e,t){return e+t.byteLength},0)),i=0;return t.forEach(function(e){n.set(e,i),i+=e.byteLength}),n}var Dt=Math.pow(2,32);function At(e,t){t=1<arguments.length&&void 0!==t?t:0;return(e[t]<<8)+(e[t+1]||0)}function Ct(e,t){t=1<arguments.length&&void 0!==t?t:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function Lt(e,t){t=1<arguments.length&&void 0!==t?t:0;return Ct(e,t)*Dt+Ct(e,t+4)}function Ot(e){for(var t,r="avc1.",n=0;n<3;n++)r+=t=(t=e[n].toString(16)).length<2?"0".concat(t):t;return r}function Rt(e){if(Array.isArray(e))return e.map(function(e){return parseInt(e,16)});for(var t,r=[],n=0;n<e.length;n++)n%2&&(t=e[n-1]+e[n],r.push(parseInt(t,16)));return r}var jt=(g(Mt,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!==e[r]&&void 0!==e[r]&&1!==e[r];)r++;if((n=++r+2)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}for(r!==n-2&&i.push(e.subarray(r,n-2));1!==e[++n]&&n<t;);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],s=0;s+t<n;)if(r=Ct(e,s),3===t&&(r>>>=8),s+=t,r){if(n<s+r)break;i.push(e.subarray(s,s+r)),s+=r}return i}}},{key:"parseSEI",value:function(e,t){for(var r=e.length,n=t?2:1,i=0,s=0,a="";255===e[n];)i+=255,n++;for(i+=e[n++];255===e[n];)s+=255,n++;if(s+=e[n++],5===i&&n+16<r)for(var o=0;o<16;o++)a+=e[n].toString(16),n++;return{payload:e.subarray(n),type:i,size:s,uuid:a}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;for(var i=t-r.length,s=new Uint8Array(i),a=0,n=0;n<i;a++,n++)a===r[0]&&(a++,r.shift()),s[n]=e[a];return s}}]),Mt),It=(g(Ut,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(e){if(!(e.length<7)){for(var t,r=1+(3&e[4]),n=[],i=[],s=6,a=31&e[5],o=0;o<a;o++){var u,c=e[s]<<8|e[s+1];s+=2,c&&(u=e.subarray(s,s+c),s+=c,n.push(u),t=t||Ut.parseSPS(jt.removeEPB(u)))}var l,d=e[s];s++;for(var h=0;h<d;h++)l=e[s]<<8|e[s+1],s+=2,l&&(i.push(e.subarray(s,s+l)),s+=l);return{sps:t,spsArr:n,ppsArr:i,nalUnitSize:r}}}},{key:"parseSPS",value:function(e){var t=new ot(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var s=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var a=t.readUEG();if(a<=3&&(s=[0,420,422,444][a]),3===a&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var o=3!==a?8:12,u=0;u<o;u++)t.readBool()&&(u<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(0===c)t.readUEG();else if(1===c){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var l=t.readUEG(),d=0;d<l;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var v,m,y,_,g,k=0,b=0,a=0,c=0;if(t.readBool()&&(k=t.readUEG(),b=t.readUEG(),a=t.readUEG(),c=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()&&(g=t.readBits(32),y=t.readBits(32),_=t.readBool(),g=(m=y)/(y=2*g))}return{codec:Ot(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:s,width:Math.ceil(16*(h+1)-2*(k+b)),height:(2-p)*(f+1)*16-(p?2:4)*(a+c),sarRatio:v,fpsNum:m,fpsDen:y,fps:g,fixedFrame:_}}}]),Ut),Pt=(g(Bt,null,[{key:"getRateIndexByRate",value:function(e){return Bt.FREQ.indexOf(e)}},{key:"parseADTS",value:function(e,t){for(var r=e.length,n=0;n+2<r&&(255!==e[n]||240!=(246&e[n+1]));)n++;if(!(r<=n)){var i=n,s=[],a=(60&e[n+2])>>>2,o=Bt.FREQ[a];if(!o)throw new Error("Invalid sampling index: ".concat(a));for(var u,c,l=1+((192&e[n+2])>>>6),d=(1&e[n+2])<<2|(192&e[n+3])>>>6,h=Bt._getConfig(a,d,l),f=h.config,h=h.codec,p=0,v=Bt.getFrameDuration(o);n+7<r;)if(255===e[n]&&240==(246&e[n+1])){if(r-n<(c=(3&e[n+3])<<11|e[n+4]<<3|(224&e[n+5])>>5))break;u=2*(1&~e[n+1]),s.push({pts:t+p*v,data:e.subarray(n+7+u,n+c)}),p++,n+=c}else n++;return{skip:i,remaining:r<=n?void 0:e.subarray(n),frames:s,samplingFrequencyIndex:a,sampleRate:o,objectType:l,channelCount:d,codec:h,config:f,originCodec:"mp4a.40.".concat(l)}}}},{key:"parseAudioSpecificConfig",value:function(e){if(e.length){var t=e[0]>>>3,r=(7&e[0])<<1|e[1]>>>7,n=(120&e[1])>>>3,i=Bt.FREQ[r];if(i){e=Bt._getConfig(r,n,t);return{samplingFrequencyIndex:r,sampleRate:i,objectType:t,channelCount:n,config:e.config,codec:e.codec,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(e){return 1024*(1<arguments.length&&void 0!==arguments[1]?arguments[1]:9e4)/e}},{key:"_getConfig",value:function(e,t,r){var n,i,s=[];return Et?i=6<=e?(n=5,e-3):(n=2,e):xt?(n=2,i=e):(n=2===r||5===r?r:5,6<=(i=e)?i=e-3:1===t&&(n=2,i=e)),s[0]=n<<3,s[0]|=(14&e)>>1,s[1]=(1&e)<<7,s[1]|=t<<3,5===n&&(s[1]|=(14&i)>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),{config:s,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){return"mp4a.40.2"===e?1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):void 0:1===t?new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):2===t||3===t?new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]):void 0}}]),Bt);function Bt(){_(this,Bt)}function Ut(){_(this,Ut)}function Mt(){_(this,Mt)}k(Pt,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var Nt=(g(Kt,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!(e.length<23)){for(var r,n,i,t=t||{},s=1+(3&e[21]),a=[],o=[],u=[],c=23,l=e[22],d=0;d<l;d++){r=63&e[c],n=e[c+1]<<8|e[c+2],c+=3;for(var h=0;h<n;h++)if(i=e[c]<<8|e[c+1],c+=2,i){switch(r){case 32:var f=e.subarray(c,c+i),p=p||Kt.parseVPS(jt.removeEPB(f),t);u.push(f);break;case 33:var f=e.subarray(c,c+i),v=v||Kt.parseSPS(jt.removeEPB(f),t);a.push(f);break;case 34:o.push(e.subarray(c,c+i))}c+=i}}return{hvcC:t,sps:v,spsArr:a,ppsArr:o,vpsArr:u,nalUnitSize:s}}}},{key:"parseVPS",value:function(e,t){t=t||{};var r=new ot(e);r.readUByte(),r.readUByte(),r.readBits(12);e=r.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,e+1),r.readBits(17),Kt._parseProfileTierLevel(r,e,t),t}},{key:"parseSPS",value:function(e){var t=(t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})||{},r=new ot(e);r.readUByte(),r.readUByte(),r.readBits(4);var n=r.readBits(3);t.numTemporalLayers=Math.max(n+1,t.numTemporalLayers||0),t.temporalIdNested=r.readBits(1),Kt._parseProfileTierLevel(r,n,t),r.readUEG();var i=t.chromaFormatIdc=r.readUEG(),s=420;i<=3&&(s=[0,420,422,444][i]);var a=0;3===i&&(a=r.readBits(1));var o,u,c,l,d=r.readUEG(),e=r.readUEG(),n=r.readBits(1);return 1===n&&(o=r.readUEG(),u=r.readUEG(),c=r.readUEG(),l=r.readUEG()),t.bitDepthLumaMinus8=r.readUEG(),t.bitDepthChromaMinus8=r.readUEG(),1===n&&(d-=(1!==i&&2!==i||0!==a?1:2)*(u+o),e-=(1===i&&0===a?2:1)*(l+c)),{codec:"hev1.1.6.L93.B0",width:d,height:e,chromaFormat:s,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var s=[],a=[],o=0;o<t;o++)s[o]=e.readBits(1),a[o]=e.readBits(1);0<t&&e.readBits(2*(8-t));for(var u=0;u<t;u++)0!==s[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==a[u]&&e.readBits(8)}}]),Kt),Ft=(g(Ht,[{key:"fix",value:function(){var t,r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],e=Math.round(1e3*e),s=this.videoTrack,a=this.audioTrack;!n&&i||(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),n&&!i&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(a,s),!i&&e&&(this._audioNextPts=this._videoNextDts=e),!this._baseDtsInited||!this._videoTimestampBreak&&this.videoTrack.exist()||!this._audioTimestampBreak&&this.audioTrack.exist()||this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._keyFrameInNextChunk=!1,this._fixVideo(s),this.metadataTrack.exist()&&(t=this.metadataTrack.timescale,this.metadataTrack.seiSamples.forEach(function(e){e.pts=e.originPts-r._baseDts,e.time=Math.max(0,e.pts)/t}),this.metadataTrack.flvScriptSamples.forEach(function(e){e.pts=e.originPts-r._baseDts,e.time=Math.max(0,e.pts)/t})),s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/1e3)}},{key:"_fixVideo",value:function(e){var t,r=this,n=e.samples;if(n.length){n.forEach(function(e){e.dts-=r._baseDts,e.pts-=r._baseDts,e.keyframe&&(r._keyFrameInNextChunk=!0)}),t=e.fpsNum&&e.fpsDen?e.timescale*(e.fpsDen/e.fpsNum):1<e.length?(c=e.samples[0],u=e.samples[n.length-1],Math.floor((u.dts-c.dts)/(n.length-1))):this._lastVideoDuration||40;var i=n.pop();if(this._videoLastSample&&n.unshift(this._videoLastSample),this._videoLastSample=i,n.length){void 0===this._videoNextDts&&(s=n[0],this._videoNextDts=s.dts);var s,a=n.length,o=0,u=n[0],c=this._videoNextDts-u.dts;200<Math.abs(c)&&(5e3<Math.abs(u.dts-this._lastVideoExceptionChunkFirstDtsDot)&&(this._lastVideoExceptionChunkFirstDtsDot=u.dts,e.warnings.push({type:Xe,nextDts:this._videoNextDts,firstSampleDts:u.dts,nextSampleDts:null===(s=n[1])||void 0===s?void 0:s.dts,sampleDuration:c})),5<=this._videoTimestampBreak?(this._videoNextDts=u.dts,this._videoTimestampBreak=0):(u.dts+=c,u.pts+=c,this.audioTrack.exist()||(this._videoTimestampBreak=1)));for(var l=0;l<a;l++){var d=n[l].dts,h=n[l+1];(1e3<(o=l<a-1?h.dts-d:i?i.dts-d:t)||o<0)&&(this._videoTimestampBreak++,5e3<Math.abs(d-this._lastVideoExceptionLargeGapDot)&&(this._lastVideoExceptionLargeGapDot=d,e.warnings.push({type:We,time:d/e.timescale,dts:d,originDts:n[l].originDts,nextDts:this._videoNextDts,sampleDuration:o,refSampleDuration:t})),o=t),n[l].duration=o,this._videoNextDts+=o,this._lastVideoDuration=o}}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach(function(e){e.dts=e.pts-=t._baseDts}),this._doFixAudioInternal(e,r,1e3))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,s=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=s=n[0].dts),this._baseDts=Math.min(i,s);n=s-i;return Number.isFinite(n)&&500<Math.abs(n)&&t.warnings.push({type:Ye,videoBaseDts:s,audioBasePts:i,baseDts:this._baseDts,delta:n}),this._baseDtsInited=!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){this._calculateBaseDts(this.audioTrack,this.videoTrack)&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=e.codecType===Ke?Pt.getFrameDuration(e.timescale,r):this._getG711Duration(e));var n=e.sampleDuration,i=e.codecType===Ke?1024:n*e.timescale/1e3;void 0===this._audioNextPts&&(r=t[0],this._audioNextPts=r.pts);for(var s=0;s<t.length;s++){var a=this._audioNextPts,o=t[s],u=o.pts-a;if(0===s&&5<=this._audioTimestampBreak&&this._keyFrameInNextChunk&&(a=this._audioNextPts=o.dts,this._audioTimestampBreak=u=0),!this._audioTimestampBreak&&3*n<=u&&u<=1e3&&!St){var c=this._getSilentFrame(e)||t[0].data.subarray(),l=Math.floor(u/n);5e3<Math.abs(o.pts-this._lastAudioExceptionGapDot)&&(this._lastAudioExceptionGapDot=o.pts,e.warnings.push({type:Je,pts:o.pts,originPts:o.originPts,count:l,nextPts:a,refSampleDuration:n}));for(var d=0;d<l;d++){var h=new rt(Math.floor(this._audioNextPts+n)-Math.floor(this._audioNextPts),c,i);h.originPts=Math.floor(this._baseDts+a),t.splice(s,0,h),this._audioNextPts+=n,s++}s--}else u<=-3*n&&-1e3<=u?(5e3<Math.abs(o.pts-this._lastAudioExceptionOverlapDot)&&(this._lastAudioExceptionOverlapDot=o.pts,e.warnings.push({type:Ze,pts:o.pts,originPts:o.originPts,nextPts:a,refSampleDuration:n})),t.splice(s,1),s--):(1e3<Math.abs(u)&&(this._audioTimestampBreak++,5e3<Math.abs(o.pts-this._lastAudioExceptionLargeGapDot)&&(this._lastAudioExceptionLargeGapDot=o.pts,e.warnings.push({type:Qe,time:o.pts/1e3,pts:o.pts,originPts:o.originPts,nextPts:a,sampleDuration:u,refSampleDuration:n}))),o.dts=o.pts=a,o.duration=i,this._audioNextPts+=n)}}},{key:"_getG711Duration",value:function(e){var t=e.sampleSize,r=e.channelCount,n=e.sampleRate,e=e.samples[0];if(e)return 2*e.data.byteLength/r/(t/8)/n*1e3}},{key:"_getSilentFrame",value:function(e){return e.codecType===Ke?Pt.getSilentFrame(e.codec,e.channelCount):new Uint8Array(8*e.sampleDuration*e.channelCount)}}]),Ht),Vt=(g(Gt,null,[{key:"parse",value:function(e){if(!(e.length<3)){var t={},r=Gt._parseValue(new DataView(e.buffer,e.byteOffset,e.byteLength)),e=Gt._parseValue(new DataView(e.buffer,e.byteOffset+r.size,e.byteLength-r.size));return t[r.data]=e.data,t}}},{key:"_parseValue",value:function(e){var t=e.byteLength,r=1,n=!1;switch(e.getUint8(0)){case 0:s=e.getFloat64(1),r+=8;break;case 1:s=!!e.getUint8(1),r+=1;break;case 2:var i=Gt._parseString(new DataView(e.buffer,e.byteOffset+r,e.byteLength-r)),s=i.data;r+=i.size;break;case 3:s={};var a=0;for(9==(16777215&e.getUint32(t-4))&&(a=3);r<t-4;){var o=Gt._parseObject(new DataView(e.buffer,e.byteOffset+r,e.byteLength-r-a)),u=o.size,c=o.data;if(o.isEnd)break;s[c.name]=c.value,r+=u}r<=t-3&&9==(16777215&e.getUint32(r-1))&&(r+=3);break;case 8:s={},r+=4;var l=0;for(9==(16777215&e.getUint32(t-4))&&(l=3);r<t-8;){var d=Gt._parseObject(new DataView(e.buffer,e.byteOffset+r,e.byteLength-r-l)),h=d.size,f=d.data;if(d.isEnd)break;s[f.name]=f.value,r+=h}r<=t-3&&9==(16777215&e.getUint32(r-1))&&(r+=3);break;case 9:r=1,n=!(s=void 0);break;case 10:s=[];var p=e.getUint32(1);r+=4;for(var v=0;v<p;v++){var m=Gt._parseValue(new DataView(e.buffer,e.byteOffset+r,e.byteLength-r)),y=m.data,m=m.size;s.push(y),r+=m}break;case 11:var _=e.getFloat64(r)+6e4*e.getInt16(r+8);s=new Date(_),r+=10;break;case 12:_=e.getUint32(1);r+=4,s="",0<_&&(s=kt.decode(new Uint8Array(e.buffer,e.byteOffset+r,_))),r+=_;break;default:r=t}return{data:s,size:r,isEnd:n}}},{key:"_parseString",value:function(e){var t=e.getUint16(0),r="";return{data:r=0<t?kt.decode(new Uint8Array(e.buffer,e.byteOffset+2,t)):r,size:2+t}}},{key:"_parseObject",value:function(e){if(!(e.byteLength<3)){var t=Gt._parseString(e),e=Gt._parseValue(new DataView(e.buffer,e.byteOffset+t.size,e.byteLength-t.size));return{data:{name:t.data,value:e.data},size:t.size+e.size,isEnd:e.isEnd}}}}]),Gt),zt=new ut("FlvDemuxer");function qt(e,t,r){_(this,qt),k(this,"_headerParsed",!1),k(this,"_remainingData",null),k(this,"_gopId",0),k(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=e||new $e,this.audioTrack=t||new et,this.metadataTrack=r||new at,this._fixer=new Ft(this.videoTrack,this.audioTrack,this.metadataTrack)}function Gt(){_(this,Gt)}function Ht(e,t,r){_(this,Ht),this.videoTrack=e,this.audioTrack=t,this.metadataTrack=r,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}function Kt(){_(this,Kt)}k((g(qt,[{key:"demux",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=this.audioTrack,n=this.videoTrack,i=this.metadataTrack;if(!t&&(!(2<arguments.length&&void 0!==arguments[2])||arguments[2])||(this._remainingData=null,this._headerParsed=!1),t?(n.reset(),r.reset(),i.reset()):(n.samples=[],r.samples=[],i.seiSamples=[],i.flvScriptSamples=[],n.warnings=[],r.warnings=[],this._remainingData&&(e=wt(this._remainingData,e),this._remainingData=null)),!e.length)return{videoTrack:n,audioTrack:r,metadataTrack:i};var s=0;if(!this._headerParsed){if(!qt.probe(e))throw new Error("Invalid flv file");r.present=(4&e[4])>>>2!=0,n.present=0!=(1&e[4]),this._headerParsed=!0,s=Ct(e,5)+4}for(var a,o,u,c,l=e.length;s+15<l&&(a=e[s],!(s+15+(o=e[s+1]<<16|e[s+2]<<8|e[s+3])>l));)c=(e[s+7]<<24>>>0)+(e[s+4]<<16)+(e[s+5]<<8)+e[s+6],u=e.subarray(s+=11,s+o),8===a?this._parseAudio(u,c):9===a?this._parseVideo(u,c):18===a?this._parseScript(u,c):zt.warn("Invalid tag type: ".concat(a)),(c=Ct(e,s+=o))!==11+o&&zt.warn("Invalid PrevTagSize ".concat(c," (").concat(11+o,")")),s+=4;return s<l&&(this._remainingData=e.subarray(s)),r.formatTimescale=n.formatTimescale=n.timescale=i.timescale=1e3,r.timescale=r.sampleRate||0,!r.exist()&&r.hasSample()&&r.reset(),!n.exist()&&n.hasSample()&&n.reset(),{videoTrack:n,audioTrack:r,metadataTrack:i}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseAudio",value:function(e,t){if(e.length){var r,n,i,s=(240&e[0])>>>4,a=this.audioTrack;if(10!=s&&7!=s&&8!=s)return zt.warn("Unsupported sound format: ".concat(s)),void a.reset();10!=s&&(r=(12&e[0])>>2,n=(2&e[0])>>1,i=1&e[0],a.sampleRate=qt.AUDIO_RATE[r],a.sampleSize=n?16:8,a.channelCount=1+i),10==s?this._parseAac(e,t):this._parseG711(e,t,s)}}},{key:"_parseG711",value:function(e,t,r){var n=this.audioTrack;n.codecType=7===r?"g7110a":"g7110m",n.sampleRate=8e3,n.codec=n.codecType,n.samples.push(new rt(t,e.subarray(1)))}},{key:"_parseAac",value:function(e,t){var r,n=this.audioTrack;n.codecType=Ke,0===e[1]?(r=Pt.parseAudioSpecificConfig(e.subarray(2)))?(n.codec=r.codec,n.channelCount=r.channelCount,n.sampleRate=r.sampleRate,n.config=r.config,n.objectType=r.objectType,n.sampleRateIndex=r.samplingFrequencyIndex):(n.reset(),zt.warn("Cannot parse AudioSpecificConfig",e)):1===e[1]?null!=t&&n.samples.push(new rt(t,e.subarray(2))):zt.warn("Unknown AACPacketType: ".concat(e[1]))}},{key:"_parseVideo",value:function(e,r){var n=this;if(!(e.length<6)){var t=(240&e[0])>>>4,i=15&e[0],s=this.videoTrack;if(7!=i&&12!=i)return s.reset(),void zt.warn("Unsupported codecId: ".concat(i));var a=12==i;s.codecType=a?He:Ge;var o,u,c,l,d,h,f,p=e[1],v=(e[2]<<16|e[3]<<8|e[4])<<8>>8;0===p?(d=e.subarray(5),(o=a?Nt.parseHEVCDecoderConfigurationRecord(d):It.parseAVCDecoderConfigurationRecord(d))?(u=o.hvcC,c=o.sps,l=o.ppsArr,i=o.spsArr,d=o.vpsArr,h=o.nalUnitSize,u&&(s.hvcC=s.hvcC||u),c&&(s.codec=c.codec,s.width=c.width,s.height=c.height,s.sarRatio=c.sarRatio,s.fpsNum=c.fpsNum,s.fpsDen=c.fpsDen),i.length&&(s.sps=i),l.length&&(s.pps=l),d&&d.length&&(s.vps=d),h&&(s.nalUnitSize=h)):zt.warn("Cannot parse ".concat(a?"HEVC":"AVC","DecoderConfigurationRecord"),e)):1===p?(h=jt.parseAvcC(e.subarray(5),s.nalUnitSize),(h=this._checkAddMetaNalToUnits(a,h,s))&&h.length?(f=new tt(r+v,r,h),1==t&&f.setToKeyframe(),s.samples.push(f),h.forEach(function(e){var t=a?e[0]>>>1&63:31&e[0];switch(t){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&5!=t||a&&5==t)break;f.setToKeyframe();break;case 6:case 39:case 40:if(!a&&6!=t||a&&6==t)break;n.metadataTrack.seiSamples.push(new st(jt.parseSEI(jt.removeEPB(e),a),r+v))}}),f.keyframe&&this._gopId++,f.gopId=this._gopId):zt.warn("Cannot parse NALUs",e)):2===p||zt.warn("Unknown AVCPacketType: ".concat(p))}}},{key:"_checkAddMetaNalToUnits",value:function(e,t,r){return!e||!this._needAddMetaBeforeKeyFrameNal||t.map(function(e){return e[0]>>>1&63}).includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(r.pps[0]),t.unshift(r.sps[0]),t.unshift(r.vps[0]),t.filter(Boolean))}},{key:"_parseScript",value:function(e,t){this.metadataTrack.flvScriptSamples.push(new it(Vt.parse(e),t))}}],[{key:"probe",value:function(e){return 70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]&&9<=Ct(e,5)}}]),qt),"AUDIO_RATE",[5500,11e3,22e3,44e3]);var Yt=(g($t,[{key:"fix",value:function(){var e,t,r,n,i=this,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,a=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],s=Math.round(9e4*s),u=this.videoTrack,c=this.audioTrack,l=u.samples,d=c.samples;(l.length||d.length)&&(t=l[0],r=d[0],e=0,l.length&&d.length&&(e=t.dts-r.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),a&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=s),o||(this._videoNextDts=0<e?s+e:s,this._audioNextPts=0<e?s:s-e,t=t?t.dts-this._baseDts-this._videoNextDts:0,r=r?r.pts-this._baseDts-this._audioNextPts:0,9e4<Math.abs(t||r)&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=s)),this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(c),this._fixVideo(u),this.metadataTrack.exist()&&(n=this.metadataTrack.timescale,this.metadataTrack.seiSamples.forEach(function(e){e.pts=e.originPts-i._baseDts,e.time=Math.max(0,e.pts)/n})),u.samples.length&&(u.baseMediaDecodeTime=u.samples[0].dts),c.samples.length&&(c.baseMediaDecodeTime=c.samples[0].pts*c.timescale/9e4))}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){r.forEach(function(e){e.dts-=t._baseDts,e.pts-=t._baseDts}),void 0===this._videoNextDts&&(n=r[0],this._videoNextDts=n.dts);var n,i,s=r.length,a=0,o=r[0],u=r[1],c=this._videoNextDts-o.dts;45e3<Math.abs(c)&&(e.warnings.push({type:Xe,nextDts:this._videoNextDts/90,firstSampleDts:o.dts/90,nextSampleDts:((null===(n=r[1])||void 0===n?void 0:n.dts)||0)/90,sampleDuration:c/90}),o.dts+=c,o.pts+=c,u&&9e4<Math.abs(u.dts-o.dts)&&(this._videoTimestampBreak=!0,r.forEach(function(e,t){0!==t&&(e.dts+=c,e.pts+=c)}))),i=e.fpsNum&&e.fpsDen?e.timescale*(e.fpsDen/e.fpsNum):(u=e.samples[0],o=e.samples[s-1],1===s?9e3:Math.floor((o.dts-u.dts)/(s-1)));for(var l=0;l<s;l++){var d,h=r[l].dts,f=r[l+1];(9e4<(a=l<s-1?f.dts-h:r[l-1]?Math.min(h-r[l-1].dts,i):i)||a<0)&&(this._videoTimestampBreak=!0,a=this._audioTimestampBreak?i:Math.max(a,2700),d=this._audioNextPts||0,f&&f.dts>d&&(a=i),e.warnings.push({type:We,time:h/e.timescale,dts:h,originDts:r[l].originDts,nextDts:this._videoNextDts,sampleDuration:a,refSampleDuration:i})),r[l].duration=a,this._videoNextDts+=a}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach(function(e){e.pts-=t._baseDts,e.dts=e.pts}),this._doFixAudioInternal(e,r,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,s=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=s=n[0].dts),this._baseDts=Math.min(i,s);n=s-i;return Number.isFinite(n)&&45e3<Math.abs(n)&&t.warnings.push({type:Ye,videoBaseDts:s,audioBasePts:i,baseDts:this._baseDts,delta:n}),this._baseDtsInited=!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak&&this._calculateBaseDts(this.audioTrack,this.videoTrack)&&(this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1)}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=Pt.getFrameDuration(e.timescale,r));var n=e.sampleDuration;void 0===this._audioNextPts&&(r=t[0],this._audioNextPts=r.pts);for(var i=0;i<t.length;i++){var s=this._audioNextPts,a=t[i],o=a.pts-s;if(!this._audioTimestampBreak&&3*n<=o&&o<=9e4&&!St){var u=Pt.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),c=Math.floor(o/n);45e4<Math.abs(a.pts-this._lastAudioExceptionGapDot)&&(this._lastAudioExceptionGapDot=a.pts),e.warnings.push({type:Je,pts:a.pts,originPts:a.originPts,count:c,nextPts:s,refSampleDuration:n});for(var l=0;l<c;l++){var d=new rt(Math.floor(s),u);d.originPts=Math.floor(this._baseDts+s),t.splice(i,0,d),this._audioNextPts+=n,i++}i--}else o<=-3*n&&-9e4<=o?(45e4<Math.abs(a.pts-this._lastAudioExceptionOverlapDot)&&(this._lastAudioExceptionOverlapDot=a.pts,e.warnings.push({type:Ze,pts:a.pts,originPts:a.originPts,nextPts:s,refSampleDuration:n})),t.splice(i,1),i--):(9e4<=Math.abs(o)&&(this._audioTimestampBreak=!0,45e4<Math.abs(a.pts-this._lastAudioExceptionLargeGapDot)&&(this._lastAudioExceptionLargeGapDot=a.pts,e.warnings.push({type:Qe,time:a.pts/1e3,pts:a.pts,originPts:a.originPts,nextPts:s,sampleDuration:o,refSampleDuration:n}))),a.dts=a.pts=s,this._audioNextPts+=n)}}}]),$t),Wt=new ut("TsDemuxer"),Xt=(g(Zt,[{key:"demux",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=this.audioTrack,i=this.videoTrack,s=this.metadataTrack;t&&(this._pmtId=-1,i.reset(),n.reset(),s.reset()),!r||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(i.samples=[],n.samples=[],s.seiSamples=[],i.warnings=[],n.warnings=[],this._remainingPacketData&&(e=wt(this._remainingPacketData,e),this._remainingPacketData=null));var a=e.length,t=a%188;t&&(this._remainingPacketData=e.subarray(a-t),a-=t);for(var o=i.pid,u=n.pid,c=0;c<a;c+=188){if(71!==e[c])throw new Error("TS packet did not start with 0x47");var l=!!(64&e[c+1]),d=((31&e[c+1])<<8)+e[c+2],h=void 0;if(1<(48&e[c+3])>>4){if((h=c+5+e[c+4])===c+188)continue}else h=c+4;switch(d){case 0:l&&(h+=e[h]+1),this._pmtId=(31&e[h+10])<<8|e[h+11];break;case this._pmtId:l&&(h+=e[h]+1);var f=h+3+((15&e[h+1])<<8|e[h+2])-4;for(h+=12+((15&e[h+10])<<8|e[h+11]);h<f;){var p=(31&e[h+1])<<8|e[h+2];switch(e[h]){case 15:n.pid=u=p;break;case 27:if(-1!==o)break;i.codecType=Ge,i.pid=o=p;break;case 36:if(-1!==o)break;i.codecType=He,i.pid=o=p;break;default:Wt.warn("Unsupported stream. type: ".concat(e[h],", pid: ").concat(p))}h+=5+((15&e[h+3])<<8|e[h+4])}break;case o:l&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(h,c+188));break;case u:l&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(h,c+188));break;case 17:case 8191:break;default:Wt.warn("Unknown pid: ".concat(d))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=i.formatTimescale=i.timescale=s.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:i,audioTrack:n,metadataTrack:s}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseVideoData",value:function(){var e,t;this._videoPesData.length&&((e=Zt._parsePES(wt.apply(void 0,w(this._videoPesData))))?((t=jt.parseAnnexB(e.data))?this._createVideoSample(t,e.pts,e.dts):Wt.warn("Cannot parse avc units",e),this._videoPesData=[]):Wt.warn("Cannot parse video pes",this._videoPesData))}},{key:"_createVideoSample",value:function(e,n,t){var i,s,a,o=this;e.length&&(i=this.videoTrack,s=i.codecType===He,a=new tt(n,t),e.forEach(function(e){var t,r=s?e[0]>>>1&63:31&e[0];switch(r){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!s&&5!=r||s&&5==r)break;a.setToKeyframe(),o._gopId++;break;case 6:case 39:case 40:if(!s&&6!=r||s&&6==r)break;return void o.metadataTrack.seiSamples.push(new st(jt.parseSEI(jt.removeEPB(e),s),n));case 32:if(!s)break;i.vps.length||(t=Nt.parseVPS(jt.removeEPB(e),i.hvcC),i.hvcC=i.hvcC||t,i.vps=[e]);break;case 7:case 33:if(!s&&7!=r||s&&7==r)break;i.sps.length||(t=jt.removeEPB(e),t=s?Nt.parseSPS(t,i.hvcC):It.parseSPS(t),i.sps=[e],i.hvcC=i.hvcC||t.hvcC,i.codec=t.codec,i.width=t.width,i.height=t.height,i.sarRatio=t.sarRatio,i.fpsNum=t.fpsNum,i.fpsDen=t.fpsDen);break;case 8:case 34:if(!s&&8!=r||s&&8==r)break;i.pps.length||(i.pps=[e])}a.units.push(e)}),a.gopId=this._gopId,this._pushVideoSample(i,a))}},{key:"_pushVideoSample",value:function(e,t){var r;t.units.length&&(null===t.pts||void 0===t.pts?(Wt.warn("Video sample no pts",t),(r=e.samples[e.samples.length-1])?(t.pts=r.pts,t.dts=r.dts):Wt.warn("Drop video sample",t)):e.samples.push(t))}},{key:"_parseAudioData",value:function(){var e;this._audioPesData.length&&((e=Zt._parsePES(wt.apply(void 0,w(this._audioPesData))))?(this._parseAacData(e),this._audioPesData=[]):Wt.warn("Cannot parse audio pes",this._audioPesData))}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,r=e.pts;if(null==r){if(Wt.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;r=t.samples[t.samples.length-1].pts+Pt.getFrameDuration(t.sampleRate)}r=Pt.parseADTS(e.data,r);r?(t.codec=r.codec,t.channelCount=r.channelCount,t.sampleRate=r.sampleRate,t.objectType=r.objectType,t.sampleRateIndex=r.samplingFrequencyIndex,t.config=r.config,(t=t.samples).push.apply(t,w(r.frames.map(function(e){return new rt(e.pts,e.data)}))),r.skip&&Wt.warn("Skip aac adts ".concat(r.skip," bits")),r.remaining&&Wt.warn("Remaining aac adts ".concat(r.remaining," bits"))):Wt.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return!!e.length&&71===e[0]&&71===e[188]&&71===e[376]}},{key:"_parsePES",value:function(e){var t=e[8];if(!(null==t||e.length<t+9)&&1==(e[0]<<16|e[1]<<8|e[2])){var r=(e[4]<<8)+e[5];if(!(r&&r>e.length-6)){var n,i,r=e[7];return 192&r&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&r?54e5<n-(i=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)&&(n=i):i=n),{data:e.subarray(9+t),pts:n,dts:i}}}}}]),Zt),Qt=(g(Jt,null,[{key:"findBox",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=[];if(!e)return n;for(var i,s=0,a=0;7<e.length;){if(s=Ct(e),i=String.fromCharCode.apply(null,e.subarray(4,8)),a=8,1===s?(s=Lt(e,8),a+=8):s=s||e.length,!t[0]||i===t[0]){var o=e.subarray(0,s);if(!(t.length<2))return Jt.findBox(o.subarray(a),t.slice(1),r+a);n.push({start:r,size:s,headerSize:a,type:i,data:o})}r+=s,e=e.subarray(s)}return n}},{key:"tfhd",value:function(e){return nr(e,!0,function(e,t){e.trackId=Ct(t);var r=4,n=1&e.flags,i=2&e.flags,s=8&e.flags,a=16&e.flags,o=32&e.flags;n&&(e.baseDataOffset=Ct(t,r+=4),r+=4),i&&(e.sampleDescriptionIndex=Ct(t,r),r+=4),s&&(e.defaultSampleDuration=Ct(t,r),r+=4),a&&(e.defaultSampleSize=Ct(t,r),r+=4),o&&(e.defaultSampleFlags=Ct(t,r))})}},{key:"sidx",value:function(e){return nr(e,!0,function(e,t){var r=0;e.reference_ID=Ct(t,r),e.timescale=Ct(t,r+=4),r+=4,0===e.version?(e.earliest_presentation_time=Ct(t,r),e.first_offset=Ct(t,r+=4),r+=4):(e.earliest_presentation_time=Lt(t,r),e.first_offset=Lt(t,r+=8),r+=8),r+=2,e.references=[];var n=At(t,r);r+=2;for(var i=0;i<n;i++){var s={};e.references.push(s);var a=Ct(t,r);r+=4,s.reference_type=a>>31&1,s.referenced_size=2147483647&a,s.subsegment_duration=Ct(t,r),a=Ct(t,r+=4),r+=4,s.starts_with_SAP=a>>31&1,s.SAP_type=a>>28&7,s.SAP_delta_time=268435455&a}})}},{key:"moov",value:function(e){return nr(e,!1,function(e,t,r){e.mvhd=Jt.mvhd(Jt.findBox(t,["mvhd"],r)[0]),e.trak=Jt.findBox(t,["trak"],r).map(function(e){return Jt.trak(e)}),e.pssh=Jt.pssh(Jt.findBox(t,["pssh"],r)[0])})}},{key:"mvhd",value:function(e){return nr(e,!0,function(e,t){var r=0;1===e.version?(e.timescale=Ct(t,16),e.duration=Lt(t,20),r+=28):(e.timescale=Ct(t,8),e.duration=Ct(t,12),r+=16),e.nextTrackId=Ct(t,r+76)})}},{key:"trak",value:function(e){return nr(e,!1,function(e,t,r){e.tkhd=Jt.tkhd(Jt.findBox(t,["tkhd"],r)[0]),e.mdia=Jt.mdia(Jt.findBox(t,["mdia"],r)[0])})}},{key:"tkhd",value:function(e){return nr(e,!0,function(e,t){var r=0;1===e.version?(e.trackId=Ct(t,16),e.duration=Lt(t,24),r+=32):(e.trackId=Ct(t,8),e.duration=Ct(t,16),r+=20),e.width=Ct(t,r+52),e.height=Ct(t,r+56)})}},{key:"mdia",value:function(e){return nr(e,!1,function(e,t,r){e.mdhd=Jt.mdhd(Jt.findBox(t,["mdhd"],r)[0]),e.hdlr=Jt.hdlr(Jt.findBox(t,["hdlr"],r)[0]),e.minf=Jt.minf(Jt.findBox(t,["minf"],r)[0])})}},{key:"mdhd",value:function(e){return nr(e,!0,function(e,t){var r=0;1===e.version?(e.timescale=Ct(t,16),e.duration=Lt(t,20),r+=28):(e.timescale=Ct(t,8),e.duration=Ct(t,12),r+=16);r=At(t,r);e.language=String.fromCharCode(96+(r>>10&31),96+(r>>5&31),96+(31&r))})}},{key:"hdlr",value:function(e){return nr(e,!0,function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))})}},{key:"minf",value:function(e){return nr(e,!1,function(e,t,r){e.vmhd=Jt.vmhd(Jt.findBox(t,["vmhd"],r)[0]),e.smhd=Jt.smhd(Jt.findBox(t,["smhd"],r)[0]),e.stbl=Jt.stbl(Jt.findBox(t,["stbl"],r)[0])})}},{key:"vmhd",value:function(e){return nr(e,!0,function(e,t){e.graphicsmode=At(t),e.opcolor=[At(t,2),At(t,4),At(t,6)]})}},{key:"smhd",value:function(e){return nr(e,!0,function(e,t){e.balance=At(t)})}},{key:"stbl",value:function(e){return nr(e,!1,function(e,t,r){var n,i;e.stsd=Jt.stsd(Jt.findBox(t,["stsd"],r)[0]),e.stts=Jt.stts(Jt.findBox(t,["stts"],r)[0]),e.ctts=Jt.ctts(Jt.findBox(t,["ctts"],r)[0]),e.stsc=Jt.stsc(Jt.findBox(t,["stsc"],r)[0]),e.stsz=Jt.stsz(Jt.findBox(t,["stsz"],r)[0]),e.stco=Jt.stco(Jt.findBox(t,["stco"],r)[0]),e.stco||(e.co64=Jt.co64(Jt.findBox(t,["co64"],r)[0]),e.stco=e.co64);var s=null===(n=e.stsd.entries[0])||void 0===n||null===(i=n.sinf)||void 0===i||null===(s=i.schi)||void 0===s?void 0:s.tenc.default_IV_size;e.stss=Jt.stss(Jt.findBox(t,["stss"],r)[0]),e.senc=Jt.senc(Jt.findBox(t,["senc"],r)[0],s)})}},{key:"senc",value:function(e){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8;return nr(e,!0,function(e,t){var r=0,n=Ct(t,r);r+=4,e.samples=[];for(var i=0;i<n;i++){for(var s={InitializationVector:[]},a=0;a<l;a++)s.InitializationVector[a]=t[r+a];if(r+=l,2&e.flags){s.subsamples=[];var o=At(t,r);r+=2;for(var u=0;u<o;u++){var c={};c.BytesOfClearData=At(t,r),r+=2,c.BytesOfProtectedData=Ct(t,r),r+=4,s.subsamples.push(c)}}e.samples.push(s)}})}},{key:"pssh",value:function(e){return nr(e,!0,function(e,t){for(var r=[],n=[],i=0,s=0;s<16;s++)n.push(ir(t[i+s]));if(i+=16,0<e.version){var a=Ct(t,i);i+=4;for(var o=0;o<(""+a).length;o++)for(var u=0;u<16;u++){var c=t[i];i+=1,r.push(ir(c))}}var l=Ct(t,i);e.data_size=l,i+=4,e.kid=r,e.system_id=n,e.buffer=t})}},{key:"stsd",value:function(e){return nr(e,!0,function(e,t,r){e.entryCount=Ct(t),e.entries=Jt.findBox(t.subarray(4),[],r+4).map(function(e){switch(e.type){case"avc1":case"avc2":case"avc3":case"avc4":return Jt.avc1(e);case"hvc1":case"hev1":return Jt.hvc1(e);case"mp4a":return Jt.mp4a(e);case"alaw":case"ulaw":return Jt.alaw(e);case"enca":return nr(e,!1,function(e,t,r){e.channelCount=At(t,16),e.samplesize=At(t,18),e.sampleRate=Ct(t,24)/65536,t=t.subarray(28),e.sinf=Jt.sinf(Jt.findBox(t,["sinf"],r)[0]),e.esds=Jt.esds(Jt.findBox(t,["esds"],r)[0])});case"encv":return nr(e,!1,function(e,t,r){e.width=At(t,24),e.height=At(t,26),e.horizresolution=Ct(t,28),e.vertresolution=Ct(t,32),t=t.subarray(78),e.sinf=Jt.sinf(Jt.findBox(t,["sinf"],r)[0]),e.avcC=Jt.avcC(Jt.findBox(t,["avcC"],r)[0]),e.hvcC=Jt.hvcC(Jt.findBox(t,["hvcC"],r)[0]),e.pasp=Jt.pasp(Jt.findBox(t,["pasp"],r)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(e){return nr(e,!1,function(e,t){var r=6;e.default_IsEncrypted=t[r],e.default_IV_size=t[r+=1],r+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(ir(t[r])),r+=1})}},{key:"schi",value:function(e){return nr(e,!1,function(e,t,r){e.tenc=Jt.tenc(Jt.findBox(t,["tenc"],r)[0])})}},{key:"sinf",value:function(e){return nr(e,!1,function(e,t,r){e.schi=Jt.schi(Jt.findBox(t,["schi"],r)[0]),e.frma=Jt.frma(Jt.findBox(t,["frma"],r)[0])})}},{key:"frma",value:function(e){return nr(e,!1,function(e,t){e.data_format="";for(var r=0;r<4;r++)e.data_format+=String.fromCharCode(t[r])})}},{key:"avc1",value:function(e){return nr(e,!1,function(e,t,r){tr(e,t);t=t.subarray(78);e.avcC=Jt.avcC(Jt.findBox(t,["avcC"],r+=78)[0]),e.pasp=Jt.pasp(Jt.findBox(t,["pasp"],r)[0])})}},{key:"avcC",value:function(e){return nr(e,!1,function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=Ot([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=At(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var s=0;s<e.ppsLength;s++){var a=At(t,r);r+=2,e.pps.push(t.subarray(r,r+=a)),r+=a}})}},{key:"hvc1",value:function(e){return nr(e,!1,function(e,t,r){tr(e,t);t=t.subarray(78);e.hvcC=Jt.hvcC(Jt.findBox(t,["hvcC"],r+=78)[0]),e.pasp=Jt.pasp(Jt.findBox(t,["pasp"],r)[0])})}},{key:"hvcC",value:function(h){return nr(h,!1,function(e,t){e.data=h.data,e.codec="hev1.1.6.L93.B0",e.configurationVersion=t[0];var r=t[1];e.generalProfileSpace=r>>6,e.generalTierFlag=(32&r)>>5,e.generalProfileIdc=31&r,e.generalProfileCompatibility=Ct(t,2),e.generalConstraintIndicatorFlags=t.subarray(6,12),e.generalLevelIdc=t[12],e.avgFrameRate=At(t,19),e.numOfArrays=t[22],e.vps=[],e.sps=[],e.pps=[];for(var n,i,s,a=23,o=0;o<e.numOfArrays;o++){n=63&t[a],i=At(t,a+1),a+=3;for(var u,c,l=[],d=0;d<i;d++)s=At(t,a),a+=2,l.push(t.subarray(a,a+s)),a+=s;32==n?(u=e.vps).push.apply(u,l):33==n?(c=e.sps).push.apply(c,l):34==n&&(c=e.pps).push.apply(c,l)}})}},{key:"pasp",value:function(e){return nr(e,!1,function(e,t){e.hSpacing=Ct(t),e.vSpacing=Ct(t,4)})}},{key:"mp4a",value:function(e){return nr(e,!1,function(e,t,r){rr(e,t);e.esds=Jt.esds(Jt.findBox(t.subarray(28),["esds"],r+28)[0])})}},{key:"esds",value:function(e){return nr(e,!0,function(e,t){e.codec="mp4a.";for(var r,n=0,i=0,s=0;t.length;){for(r=t[n=0],i=t[n+1],n+=2;128&i;)s=(127&i)<<7,i=t[n],n+=1;if(s+=127&i,3===r)t=t.subarray(n+3);else{if(4!==r){if(5!==r)return"."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)),0;var a=e.config=t.subarray(n,n+s),o=(248&a[0])>>3;return 31===o&&2<=a.length&&(o=32+((7&a[0])<<3)+((224&a[1])>>5)),e.objectType=o,e.codec+=o.toString(16),"."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)),0}e.codec+=(t[n].toString(16)+".").padStart(3,"0"),t=t.subarray(n+13)}}})}},{key:"alaw",value:function(e){return nr(e,!1,function(e,t){rr(e,t)})}},{key:"stts",value:function(e){return nr(e,!0,function(e,t){for(var r=Ct(t),n=[],i=4,s=0;s<r;s++)n.push({count:Ct(t,i),delta:Ct(t,i+4)}),i+=8;e.entryCount=r,e.entries=n})}},{key:"ctts",value:function(e){return nr(e,!0,function(e,t){var r=Ct(t),n=[],i=4;if(1===e.version)for(var s=0;s<r;s++)n.push({count:Ct(t,i),offset:Ct(t,i+4)}),i+=8;else for(var a=0;a<r;a++)n.push({count:Ct(t,i),offset:-(1+~Ct(t,i+4))}),i+=8;e.entryCount=r,e.entries=n})}},{key:"stsc",value:function(e){return nr(e,!0,function(e,t){for(var r=Ct(t),n=[],i=4,s=0;s<r;s++)n.push({firstChunk:Ct(t,i),samplesPerChunk:Ct(t,i+4),sampleDescriptionIndex:Ct(t,i+8)}),i+=12;e.entryCount=r,e.entries=n})}},{key:"stsz",value:function(e){return nr(e,!0,function(e,t){var r=Ct(t),n=Ct(t,4),i=[];if(!r)for(var s=8,a=0;a<n;a++)i.push(Ct(t,s)),s+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i})}},{key:"stco",value:function(e){return nr(e,!0,function(e,t){for(var r=Ct(t),n=[],i=4,s=0;s<r;s++)n.push(Ct(t,i)),i+=4;e.entryCount=r,e.entries=n})}},{key:"co64",value:function(e){return nr(e,!0,function(e,t){for(var r=Ct(t),n=[],i=4,s=0;s<r;s++)n.push(Lt(t,i)),i+=8;e.entryCount=r,e.entries=n})}},{key:"stss",value:function(e){return nr(e,!0,function(e,t){for(var r=Ct(t),n=[],i=4,s=0;s<r;s++)n.push(Ct(t,i)),i+=4;e.entryCount=r,e.entries=n})}},{key:"moof",value:function(e){return nr(e,!1,function(e,t,r){e.mfhd=Jt.mfhd(Jt.findBox(t,["mfhd"],r)[0]),e.traf=Jt.findBox(t,["traf"],r).map(function(e){return Jt.traf(e)})})}},{key:"mfhd",value:function(e){return nr(e,!0,function(e,t){e.sequenceNumber=Ct(t)})}},{key:"traf",value:function(e){return nr(e,!1,function(e,t,r){e.tfhd=Jt.tfhd(Jt.findBox(t,["tfhd"],r)[0]),e.tfdt=Jt.tfdt(Jt.findBox(t,["tfdt"],r)[0]),e.trun=Jt.trun(Jt.findBox(t,["trun"],r)[0])})}},{key:"trun",value:function(e){return nr(e,!0,function(e,t){var r=e.version,n=e.flags,i=t.length,s=e.sampleCount=Ct(t),a=4;if(a<i&&1&n&&(e.dataOffset=-(1+~Ct(t,a)),a+=4),a<i&&4&n&&(e.firstSampleFlags=Ct(t,a),a+=4),e.samples=[],a<i)for(var o,u=0;u<s;u++)o={},256&n&&(o.duration=Ct(t,a),a+=4),512&n&&(o.size=Ct(t,a),a+=4),1024&n&&(o.flags=Ct(t,a),a+=4),2048&n&&(o.cts=r?-(1+~Ct(t,a+4)):Ct(t,a),a+=4),e.samples.push(o)})}},{key:"tfdt",value:function(e){return nr(e,!0,function(e,t){1===e.version?e.baseMediaDecodeTime=Lt(t):e.baseMediaDecodeTime=Ct(t)})}},{key:"probe",value:function(e){return!!Jt.findBox(e,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,r){var n,i=e.trak;if(i&&i.length){var s,a,o=i.find(function(e){var t;return"vide"===(null===(e=e.mdia)||void 0===e||null===(t=e.hdlr)||void 0===t?void 0:t.handlerType)}),u=i.find(function(e){var t;return"soun"===(null===(e=e.mdia)||void 0===e||null===(t=e.hdlr)||void 0===t?void 0:t.handlerType)});if(o&&t){var c,l,d,h=t;null!=(null===(i=o.tkhd)||void 0===i?void 0:i.trackId)&&(h.id=o.tkhd.trackId),h.tkhdDuration=o.tkhd.duration,h.mvhdDurtion=e.mvhd.duration,h.mvhdTimecale=e.mvhd.timescale,h.timescale=h.formatTimescale=o.mdia.mdhd.timescale,h.duration=o.mdia.mdhd.duration||h.mvhdDurtion/h.mvhdTimecale*h.timescale;var f,p,v,m,y,_=o.mdia.minf.stbl.stsd.entries[0];if(h.width=_.width,h.height=_.height,_.pasp&&(h.sarRatio=[_.pasp.hSpacing,_.pasp.vSpacing]),_.hvcC)h.codecType=He,h.codec=_.hvcC.codec,h.vps=_.hvcC.vps,h.sps=_.hvcC.sps,h.pps=_.hvcC.pps,h.hvcC=_.hvcC.data;else{if(!_.avcC)throw new Error("unknown video stsd entry");h.codec=_.avcC.codec,h.sps=_.avcC.sps,h.pps=_.avcC.pps}h.present=!0,h.ext={},h.ext.stss=null===(i=o.mdia)||void 0===i||null===(c=i.minf)||void 0===c||null===(l=c.stbl)||void 0===l?void 0:l.stss,h.ext.ctts=null===(l=o.mdia)||void 0===l||null===(d=l.minf)||void 0===d||null===(f=d.stbl)||void 0===f?void 0:f.ctts,_&&"encv"===_.type&&(h.isVideoEncryption=!0,_.default_KID=null===(f=_.sinf)||void 0===f||null===(p=f.schi)||void 0===p?void 0:p.tenc.default_KID,_.default_IsEncrypted=null===(p=_.sinf)||void 0===p||null===(v=p.schi)||void 0===v?void 0:v.tenc.default_IsEncrypted,_.default_IV_size=null===(v=_.sinf)||void 0===v||null===(m=v.schi)||void 0===m?void 0:m.tenc.default_IV_size,h.videoSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,_.data_format=null===(o=_.sinf)||void 0===o||null===(y=o.frma)||void 0===y?void 0:y.data_format,h.useEME=e.useEME,h.kidValue=e.kidValue,h.pssh=e.pssh,h.encv=_)}if(u&&r){var g,k,b,S=r;null!=(null===(_=u.tkhd)||void 0===_?void 0:_.trackId)&&(S.id=u.tkhd.trackId),S.tkhdDuration=u.tkhd.duration,S.mvhdDurtion=e.mvhd.duration,S.mvhdTimecale=e.mvhd.timescale,S.timescale=S.formatTimescale=u.mdia.mdhd.timescale,S.duration=u.mdia.mdhd.duration||S.mvhdDurtion/S.mvhdTimecale*S.timescale;var E,x,T,w,D,A=u.mdia.minf.stbl.stsd.entries[0];switch(S.sampleSize=A.sampleSize,S.sampleRate=A.sampleRate,S.channelCount=A.channelCount,S.present=!0,A.type){case"alaw":S.codecType=S.codec="g7110a",S.sampleRate=8e3;break;case"ulaw":S.codecType=S.codec="g7110m",S.sampleRate=8e3;break;default:S.sampleDuration=Pt.getFrameDuration(S.sampleRate,S.timescale),S.sampleRateIndex=Pt.getRateIndexByRate(S.sampleRate),S.objectType=(null===(n=A.esds)||void 0===n?void 0:n.objectType)||2,A.esds&&(S.config=Array.from(A.esds.config)),S.codec=(null===(n=A.esds)||void 0===n?void 0:n.codec)||"mp4a.40.2"}S.sampleDuration=Pt.getFrameDuration(S.sampleRate,S.timescale),S.objectType=(null===(_=A.esds)||void 0===_?void 0:_.objectType)||2,A.esds&&(A.esds.config?S.config=Array.from(A.esds.config):console.warn("esds config is null")),S.codec=(null===(_=A.esds)||void 0===_?void 0:_.codec)||"mp4a.40.2",S.sampleRateIndex=Pt.getRateIndexByRate(S.sampleRate),S.ext={},S.ext.stss=null===(_=u.mdia)||void 0===_||null===(g=_.minf)||void 0===g||null===(k=g.stbl)||void 0===k?void 0:k.stss,S.ext.ctts=null===(k=u.mdia)||void 0===k||null===(b=k.minf)||void 0===b||null===(E=b.stbl)||void 0===E?void 0:E.ctts,S.present=!0,A&&"enca"===A.type&&(S.isAudioEncryption=!0,A.data_format=null===(E=A.sinf)||void 0===E||null===(x=E.frma)||void 0===x?void 0:x.data_format,A.default_KID=null===(x=A.sinf)||void 0===x||null===(T=x.schi)||void 0===T?void 0:T.tenc.default_KID,A.default_IsEncrypted=null===(T=A.sinf)||void 0===T||null===(w=T.schi)||void 0===w?void 0:w.tenc.default_IsEncrypted,A.default_IV_size=null===(w=A.sinf)||void 0===w||null===(D=w.schi)||void 0===D?void 0:D.tenc.default_IV_size,S.audioSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,S.useEME=e.useEME,S.kidValue=e.kidValue,S.enca=A)}return r&&(r.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!r&&r.isAudioEncryption),(null!=t&&t.encv||null!=r&&r.enca)&&(s=null==t||null===(s=t.encv)||void 0===s?void 0:s.default_KID,a=null==r||null===(a=r.enca)||void 0===a?void 0:a.default_KID,a=s||a?(s||a).join(""):null,t&&(t.kid=a),r&&(r.kid=a)),t&&(t.flags=3841),r&&(r.flags=1793),{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var n=null==t||null===(n=t.samples)||void 0===n?void 0:n.length;return n?1024*n/t.timescale*e.timescale/r:1024}},{key:"moofToSamples",value:function(e,l,d){var h={};return e.mfhd&&(l&&(l.sequenceNumber=e.mfhd.sequenceNumber),d&&(d.sequenceNumber=e.mfhd.sequenceNumber)),e.traf.forEach(function(e){var t=e.tfhd,r=e.tfdt,n=e.trun;if(t&&n){r&&(l&&l.id===t.trackId&&(l.baseMediaDecodeTime=r.baseMediaDecodeTime),d&&d.id===t.trackId&&(d.baseMediaDecodeTime=r.baseMediaDecodeTime));var i=t.defaultSampleSize||0,s=t.defaultSampleDuration||Jt.evaluateDefaultDuration(l,d,n.samples.length||n.sampleCount),a=n.dataOffset||0,o=0,u=-1;if(!n.samples.length&&n.sampleCount){h[t.trackId]=[];for(var c=0;c<n.sampleCount;c++)h[t.trackId].push({offset:a,dts:o,duration:s,size:i}),o+=s,a+=i}else h[t.trackId]=n.samples.map(function(e,t){return(e={offset:a,dts:o,pts:o+(e.cts||0),duration:e.duration||s,size:e.size||i,gopId:u,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(u++,e.gopId=u),o+=e.duration,a+=e.size,e})}}),h}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find(function(e){var t;return"vide"===(null===(e=e.mdia)||void 0===e||null===(t=e.hdlr)||void 0===t?void 0:t.handlerType)}),n=t.find(function(e){var t;return"soun"===(null===(e=e.mdia)||void 0===e||null===(t=e.hdlr)||void 0===t?void 0:t.handlerType)});if(r||n){if(r){var i=null===(s=r.mdia)||void 0===s||null===(a=s.minf)||void 0===a?void 0:a.stbl;if(!i)return;var e=i.stts,t=i.stsc,r=i.stsz,s=i.stco,a=i.stss,i=i.ctts;if(!(e&&t&&r&&s&&a))return;s=er(e,t,r,s,i,a)}if(n){var o=null===(i=n.mdia)||void 0===i||null===(u=i.minf)||void 0===u?void 0:u.stbl;if(!o)return;var i=null===(a=n.mdia.mdhd)||void 0===a?void 0:a.timescale,u=o.stts,n=o.stsc,a=o.stsz,o=o.stco;if(!(i&&u&&n&&a&&o))return;o=er(u,n,a,o)}return{videoSamples:s,audioSamples:o}}}}}]),Jt);function Jt(){_(this,Jt)}function Zt(e,t,r){_(this,Zt),k(this,"_pmtId",-1),k(this,"_remainingPacketData",null),k(this,"_videoPesData",[]),k(this,"_audioPesData",[]),k(this,"_gopId",0),this.videoTrack=e||new $e,this.audioTrack=t||new et,this.metadataTrack=r||new at,this._fixer=new Yt(this.videoTrack,this.audioTrack,this.metadataTrack)}function $t(e,t,r){_(this,$t),this.videoTrack=e,this.audioTrack=t,this.metadataTrack=r,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}function er(e,t,i,r,n,s){var a,o,u,c=[],n=null==n?void 0:n.entries,l=t.entries,d=r.entries,h=i.entrySizes,f=null==s?void 0:s.entries;f&&(a={},f.forEach(function(e){a[e-1]=!0})),n&&(o=[],n.forEach(function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)o.push(r)}));var p=-1,v=0,m=0,y=0,_=0,g=0,k=l[0].samplesPerChunk,b=l[1]?l[1].firstChunk-1:1/0;return e.entries.forEach(function(e){for(var t=e.count,r=e.delta,n=0;n<t;n++)u={dts:v,duration:r,size:h[m]||i.sampleSize,offset:d[y]+g,index:m},f&&(u.keyframe=a[m],u.keyframe&&p++,u.gopId=p),o&&m<o.length&&(u.pts=u.dts+o[m]),c.push(u),v+=r,++m<k?g+=u.size:(g=0,b<=++y&&(b=l[++_+1]?l[_+1].firstChunk-1:1/0),k+=l[_].samplesPerChunk)}),c}function tr(e,t){return e.dataReferenceIndex=At(t,6),e.width=At(t,24),e.height=At(t,26),e.horizresolution=Ct(t,28),e.vertresolution=Ct(t,32),e.frameCount=At(t,40),e.depth=At(t,74),78}function rr(e,t){return e.dataReferenceIndex=At(t,6),e.channelCount=At(t,16),e.sampleSize=At(t,18),e.sampleRate=Ct(t,24)/65536,28}function nr(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=function(e,t){t=1<arguments.length&&void 0!==t?t:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var ir=function(){for(var t=[],e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.forEach(function(e){t.push(function(e,t,r){for(var n=String(r),t=t>>0,i=Math.ceil(t/n.length),s=[],e=String(e);i--;)s.push(n);return s.join("").substring(0,t-e.length)+e}(Number(e).toString(16),2,0))}),t[0]},sr=(g(ar,[{key:"demux",value:function(s,r){var a=this.videoTrack,n=this.audioTrack,e=a.exist(),t=n.exist();if(a.samples=[],n.samples=[],r){if(!t){var i=Qt.findBox(r,["moov"])[0];if(!i)throw new Error("cannot found moov box");Qt.moovToTrack(Qt.moov(i),null,n)}var o,u,c=Qt.findBox(r,["moof"])[0];c&&(i=Qt.moofToSamples(Qt.moof(c),null,n)[n.id],o=n.baseMediaDecodeTime,i&&(u=c.start,i.map(function(e){e.offset+=u;var t=r.subarray(e.offset,e.offset+e.size);n.samples.push(new rt(e.dts+o,t,e.duration))})))}if(s){if(!e&&!t){var l=Qt.findBox(s,["moov"])[0];if(!l)throw new Error("cannot found moov box");Qt.moovToTrack(Qt.moov(l),a,n)}var d,h,f,p,v,l=Qt.findBox(s,["moof"])[0];l&&(h=Qt.moofToSamples(Qt.moof(l),a,n),f=a.baseMediaDecodeTime,p=n.baseMediaDecodeTime,v=l.start,Object.keys(h).forEach(function(e){a.id==e?h[e].map(function(e){e.offset+=v;var t=new tt((e.pts||e.dts)+f,e.dts+f);t.duration=e.duration,t.gopId=e.gopId,e.keyframe&&t.setToKeyframe();for(var r=s.subarray(e.offset,e.offset+e.size),n=0,i=(t.data=r).length-1;n<i;)d=Ct(r,n),t.units.push(r.subarray(n+=4,n+d)),n+=d;a.samples.push(t)}):n.id==e&&h[e].map(function(e){e.offset+=v;var t=s.subarray(e.offset,e.offset+e.size);n.samples.push(new rt(e.dts+p,t,e.duration))})}))}return{videoTrack:a,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return Qt.probe(e)}}]),ar);function ar(e,t,r){_(this,ar),this.videoTrack=e||new $e,this.audioTrack=t||new et,this.metadataTrack=r||new at}var or=(g(dr,[{key:"write",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];r.forEach(function(e){e?t.buffer=function(e){for(var t=0,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];n.forEach(function(e){t+=e.length});var s=new e(t),a=0;return n.forEach(function(e){s.set(e,a),a+=e.length}),s}(Uint8Array,t.buffer,e):window.console.warn(e)})}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),dr),ur=Math.pow(2,32)-1,cr=(g(lr,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce(function(e,t){return e+t.byteLength},0),s=new Uint8Array(i);s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4);var a=8;return r.forEach(function(e){s.set(e,a),a+=e.byteLength}),s}},{key:"ftyp",value:function(e){return e.find(function(e){return e.type===Ve&&e.codecType===He})?lr.FTYPHEV1:lr.FTYPAVC1}},{key:"initSegment",value:function(e){return wt(lr.ftyp(e),lr.moov(e))}},{key:"pssh",value:function(e){e=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Rt(e.kid),[0,0,0,0]));return lr.box(lr.types.pssh,e)}},{key:"moov",value:function(e){if(e[0].useEME&&(e[0].encv||e[0].enca)){e[0].pssh||(e[0].pssh={kid:e[0].kid});var t=this.pssh(e[0].pssh);return lr.box.apply(lr,[lr.types.moov,lr.mvhd(e[0].mvhdDurtion||e[0].duration,e[0].mvhdTimecale||e[0].timescale),lr.mvex(e)].concat(w(e.map(function(e){return lr.trak(e)})),[t]))}return lr.box.apply(lr,[lr.types.moov,lr.mvhd(e[0].mvhdDurtion||e[0].duration,e[0].mvhdTimecale||e[0].timescale)].concat(w(e.map(function(e){return lr.trak(e)})),[lr.mvex(e)]))}},{key:"mvhd",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:9e4;return lr.box(lr.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(e){return lr.box(lr.types.trak,lr.tkhd(e.id,e.tkhdDuration||0,e.width,e.height),lr.mdia(e))}},{key:"tkhd",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return lr.box(lr.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,n>>8&255,255&n,0,0]))}},{key:"mdia",value:function(e){return lr.box(lr.types.mdia,lr.mdhd(e.duration,e.timescale),lr.hdlr(e.type),lr.minf(e))}},{key:"mdhd",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:9e4;return lr.box(lr.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,85,196,0,0]))}},{key:"hdlr",value:function(e){return lr.box(lr.types.hdlr,lr.HDLR_TYPES[e])}},{key:"minf",value:function(e){return lr.box(lr.types.minf,e.type===Ve?lr.VMHD:lr.SMHD,lr.DINF,lr.stbl(e))}},{key:"stbl",value:function(e){var t=[];return e&&e.ext&&e.ext.stss&&t.push(lr.stss(e.ext.stss.entries)),lr.box(lr.types.stbl,lr.stsd(e),lr.STTS,t[0],lr.STSC,lr.STSZ,lr.STCO)}},{key:"stsd",value:function(e){e="audio"===e.type?e.useEME&&e.enca?lr.enca(e):lr.mp4a(e):e.useEME&&e.encv?lr.encv(e):lr.avc1hev1(e);return lr.box(lr.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),e)}},{key:"enca",value:function(e){var t=e.enca.channelCount,r=e.enca.sampleRate,t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,r>>8&255,255&r,0,0]),r=lr.esds(e.config),e=lr.sinf(e.enca);return lr.box(lr.types.enca,t,r,e)}},{key:"encv",value:function(e){var t=0<e.sps.length?e.sps[0]:[],r=0<e.pps.length?e.pps[0]:[],n=e.width,i=e.height,s=e.sarRatio[0],a=e.sarRatio[1],n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,i>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t=new Uint8Array((t=(i=[1,t[1],t[2],t[3],255,225,t.length>>>8&255,255&t.length]).concat.apply(i,w(t)).concat([1,r.length>>>8&255,255&r.length])).concat.apply(t,w(r))),r=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),e=lr.sinf(e.encv),a=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a]);return lr.box(lr.types.encv,n,lr.box(lr.types.avcC,t),lr.box(lr.types.btrt,r),e,lr.box(lr.types.pasp,a))}},{key:"schi",value:function(e){var t=new Uint8Array([]),e=lr.tenc(e);return lr.box(lr.types.schi,t,e)}},{key:"tenc",value:function(e){e=new Uint8Array([0,0,0,0,0,0,255&e.default_IsEncrypted,255&e.default_IV_size].concat(Rt(e.default_KID)));return lr.box(lr.types.tenc,e)}},{key:"sinf",value:function(e){var t=new Uint8Array([]),r=new Uint8Array([e.data_format.charCodeAt(0),e.data_format.charCodeAt(1),e.data_format.charCodeAt(2),e.data_format.charCodeAt(3)]),n=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),e=lr.schi(e);return lr.box(lr.types.sinf,t,lr.box(lr.types.frma,r),lr.box(lr.types.schm,n),e)}},{key:"avc1hev1",value:function(e){var t=e.codecType===He,r=t?lr.types.hvc1:lr.types.avc1,n=t?lr.hvcC(e):lr.avcC(e),n=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e.width>>8&255,255&e.width,e.height>>8&255,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n];return t?n.push(lr.box(lr.types.fiel,new Uint8Array([1,0]))):e.sarRatio&&1<e.sarRatio.length&&n.push(lr.pasp(e.sarRatio)),lr.box.apply(lr,[r].concat(n))}},{key:"avcC",value:function(e){var t,r,n=[],i=[];return e.sps.forEach(function(e){r=e.byteLength,n.push(r>>>8&255),n.push(255&r),n.push.apply(n,w(e))}),e.pps.forEach(function(e){r=e.byteLength,i.push(r>>>8&255),i.push(255&r),i.push.apply(i,w(e))}),lr.box(lr.types.avcC,new Uint8Array((e=(t=[1,n[3],n[4],n[5],255,224|e.sps.length]).concat.apply(t,n).concat([e.pps.length])).concat.apply(e,i)))}},{key:"hvcC",value:function(e){var t=e.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var r,n,i,s=e.vps,a=e.sps,o=e.pps;return t?(r=t.generalProfileCompatibilityFlags,n=t.generalConstraintIndicatorFlags,e=(s.length&&1)+(a.length&&1)+(o.length&&1),i=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,r>>>24,r>>>16,r>>>8,r,n[0],n[1],n[2],n[3],n[4],n[5],t.generalLevelIdc,240,0,252,252|t.chromaFormatIdc,248|t.bitDepthLumaMinus8,248|t.bitDepthChromaMinus8,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,e],e=function(e){i.push(e.length>>8,e.length),i.push.apply(i,w(e))},s.length&&(i.push(160,0,s.length),s.forEach(e)),a.length&&(i.push(161,0,a.length),a.forEach(e)),o.length&&(i.push(162,0,o.length),o.forEach(e))):i=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64],lr.box(lr.types.hvcC,new Uint8Array(i))}},{key:"pasp",value:function(e){var t=T(e,2),e=t[0],t=t[1];return lr.box(lr.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"mp4a",value:function(e){return lr.box(lr.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.sampleRate>>8&255,255&e.sampleRate,0,0]),e.config.length?lr.esds(e.config):void 0)}},{key:"esds",value:function(e){var t=e.length;return lr.box(lr.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(e).concat([6,1,2])))}},{key:"mvex",value:function(e){return lr.box.apply(lr,[lr.types.mvex].concat(w(e.map(function(e){return lr.trex(e.id)}))))}},{key:"trex",value:function(e){return lr.box(lr.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(e){return lr.box(lr.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(e){return lr.box(lr.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(e){return lr.box.apply(lr,[lr.types.moof,lr.mfhd(e[0].samples?e[0].samples[0].gopId:0)].concat(w(e.map(function(e){return lr.traf(e)}))))}},{key:"mfhd",value:function(e){return lr.box(lr.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"traf",value:function(e){var t=lr.tfhd(e.id),r=lr.tfdt(e,e.baseMediaDecodeTime),n=0;if(e.isVideo&&e.videoSenc&&e.videoSenc.forEach(function(e){n+=8,e.subsamples&&e.subsamples.length&&(n+=2,n+=6*e.subsamples.length)}),e.videoSencLength=n,e.useEME&&(e.isVideoEncryption||e.isAudioEncryption)){if(e.isVideoEncryption){if(e.isVideo){var i=lr.saiz(e),s=lr.saio(e),a=lr.trun1(e),o=lr.senc(e);return lr.box(lr.types.traf,t,r,i,s,a,o)}if(e.isAudioEncryption){var o=lr.sbgp(),u=lr.saiz(e),c=lr.saio(e),l=lr.senc(e),d=lr.trun1(e);return lr.box(lr.types.traf,t,r,o,u,c,l,d)}u=lr.sbgp(),c=lr.trun1(e);return lr.box(lr.types.traf,t,r,u,c)}if(e.isVideo){var h=lr.trun1(e);return lr.box(lr.types.traf,t,r,h)}l=lr.sbgp(),d=lr.saiz(e),u=lr.saio(e),c=lr.senc(e),h=lr.trun1(e);return lr.box(lr.types.traf,t,r,l,d,u,c,h)}h=lr.sdtp(e);return lr.box(lr.types.traf,t,r,h,lr.trun(e.samples,h.byteLength+76))}},{key:"sdtp",value:function(t){var r=new or;return t.samples.forEach(function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))}),lr.box(lr.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var e,r=new or,n=or.writeUint32(t.samples.length),i=null;return t.isVideo?(e=t.videoSencLength,i=or.writeUint32(16*t.samples.length+e+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=or.writeUint32(16*t.samples.length+92))):(e=12*t.samples.length+124,t.isAudioEncryption&&(e=12*t.samples.length+8*t.audioSenc.length+177),i=or.writeUint32(e)),t.samples.forEach(function(e){r.write(or.writeUint32(e.duration)),r.write(or.writeUint32(e.size)),r.write(or.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&r.write(or.writeUint32(e.cts||0))}),lr.box(lr.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(e){var r=new or,t=e.samples.length,n=e.isVideo?16:8,i=e.isVideo?2:0,s=[],a=0;return e.isVideo?(s=e.videoSenc,a=e.videoSencLength):s=e.audioSenc,r.write(or.writeUint32(16+(a=a||n*t)),lr.types.senc,this.extension(0,i)),r.write(or.writeUint32(t)),s.forEach(function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(or.writeUint16(e.subsamples.length)),e.subsamples.forEach(function(e){r.write(or.writeUint16(e.BytesOfClearData)),r.write(or.writeUint32(e.BytesOfProtectedData))}))}),r.buffer}},{key:"saio",value:function(e){var t=12*e.samples.length+141;!e.isVideo&&e.isAudioEncryption&&(t=149);t=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t]);return lr.box(lr.types.saio,t)}},{key:"saiz",value:function(e){e=e.samples.length,e=new Uint8Array([0,0,0,0,16,e>>24&255,e>>16&255,e>>8&255,255&e]);return lr.box(lr.types.saiz,e)}},{key:"sbgp",value:function(){var e=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return lr.box(lr.types.sbgp,this.extension(0,0),e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(e){return lr.box(lr.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"tfdt",value:function(e,t){var r=Math.floor(t/(1+ur)),t=Math.floor(t%(1+ur));return e.useEME&&(e.isVideoEncryption||e.isAudioEncryption)?lr.box(lr.types.tfdt,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t])):lr.box(lr.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"trun",value:function(e,t){var r=e.length,n=12+16*r;t+=8+n;var i=new Uint8Array(n);i.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0);for(var s=0;s<r;s++){var a=e[s],o=a.duration,u=a.size,c=a.flag,c=void 0===c?{}:c,a=a.cts,a=void 0===a?0:a;i.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|(null===c.dependsOn||void 0===c.dependsOn?1:c.dependsOn),c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|(null===c.isNonSyncSample||void 0===c.isNonSyncSample?1:c.isNonSyncSample),61440&c.degradationPriority,15&c.degradationPriority,a>>>24&255,a>>>16&255,a>>>8&255,255&a],12+16*s)}return lr.box(lr.types.trun,i)}},{key:"moovMP4",value:function(e){return lr.box.apply(lr,[lr.types.moov,lr.mvhd(e[0].duration,e[0].timescale)].concat(w(e.map(function(e){return lr.trackMP4(e)}))))}},{key:"trackMP4",value:function(e){return lr.box(lr.types.trak,lr.tkhd(e.id,e.duration,e.width,e.height),lr.mdiaMP4(e))}},{key:"mdiaMP4",value:function(e){return lr.box(lr.types.mdia,lr.mdhd(e.duration,e.timescale),lr.hdlr(e.type),lr.minfMP4(e))}},{key:"minfMP4",value:function(e){return lr.box(lr.types.minf,e.type===Ve?lr.VMHD:lr.SMHD,lr.DINF,lr.stblMP4(e))}},{key:"stblMP4",value:function(e){var t=e.ext,e=[lr.stsd(e),lr.stts(t.stts),lr.stsc(t.stsc),lr.stsz(t.stsz),lr.stco(t.stco)];return t.stss.length&&e.push(lr.stss(t.stss)),t.ctts.length&&e.push(lr.ctts(t.ctts)),lr.box.apply(lr,[lr.types.stbl].concat(e))}},{key:"stts",value:function(e){var t=e.length,r=new Uint8Array(8*t),n=0;return e.forEach(function(e){var t=e.value,e=e.count;r.set([e>>24,e>>16&255,e>>8&255,255&e,t>>24,t>>16&255,t>>8&255,255&t],n),n+=8}),lr.box(lr.types.stts,wt(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]),r))}},{key:"stsc",value:function(e){var t=e.length,n=new Uint8Array(12*t),i=0;return e.forEach(function(e){var t=e.firstChunk,r=e.samplesPerChunk,e=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e],i),i+=12}),lr.box(lr.types.stsc,wt(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]),n))}},{key:"stsz",value:function(e){var t=e.length,r=new Uint8Array(4*t),n=0;return e.forEach(function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],n),n+=4}),lr.box(lr.types.stsz,wt(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]),r))}},{key:"stco",value:function(e){var t=e.length,r=new Uint8Array(4*t),n=0;return e.forEach(function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],n),n+=4}),lr.box(lr.types.stco,wt(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]),r))}},{key:"stss",value:function(e){var t=e.length,r=new Uint8Array(4*t),n=0;return e.forEach(function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],n),n+=4}),lr.box(lr.types.stss,wt(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]),r))}},{key:"ctts",value:function(e){var t=e.length,r=new Uint8Array(8*t),n=0;return e.forEach(function(e){var t=e.value,e=e.count;r.set([e>>24,e>>16&255,e>>8&255,255&e,t>>24,t>>16&255,t>>8&255,255&t],n),n+=8}),lr.box(lr.types.ctts,wt(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]),r))}},{key:"styp",value:function(){return lr.box(lr.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(e){var t=e.timescale,r=e.samples[0].duration,n=r*e.samples.length,i=e.samples[0].sampleOffset*r,s=8;e.samples.forEach(function(e){s+=e.size});var a,o,r=0;e.isVideo?(o=0,e.videoSenc&&(a=e.videoSenc),e.isVideo&&a.forEach(function(e){o+=8,e.subsamples&&e.subsamples.length&&(o+=2,o+=6*e.subsamples.length)}),e.videoSencLength=o,r=s+141+16*e.samples.length+o,e.useEME&&e.isAudioEncryption&&!e.isVideoEncryption&&(r=s+16*e.samples.length+84)):(r=s+116+12*e.samples.length,e.useEME&&e.isAudioEncryption&&(r=s+169+12*e.samples.length+8*e.audioSenc.length));n=new Uint8Array([0,0,0,0,0,0,0,255&e.id,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,1,0,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,144,0,0,0]);return lr.box(lr.types.sidx,n)}},{key:"mdat",value:function(e){return lr.box(lr.types.mdat,e)}}]),lr);function lr(){_(this,lr)}function dr(){_(this,dr),this.buffer=new Uint8Array(0)}k(cr,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e},Object.create(null))),k(cr,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),k(cr,"FTYPAVC1",cr.box(cr.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),k(cr,"FTYPHEV1",cr.box(cr.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),k(cr,"DINF",cr.box(cr.types.dinf,cr.box(cr.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),k(cr,"VMHD",cr.box(cr.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),k(cr,"SMHD",cr.box(cr.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),k(cr,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),k(cr,"STTS",cr.box(cr.types.stts,cr.StblTable)),k(cr,"STSC",cr.box(cr.types.stsc,cr.StblTable)),k(cr,"STSZ",cr.box(cr.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),k(cr,"STCO",cr.box(cr.types.stco,cr.StblTable));var hr=(g(fr,[{key:"debug",value:function(){var e;if(!fr.disabled){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).debug.apply(e,[this._prefix].concat(r))}}},{key:"log",value:function(){var e;if(!fr.disabled){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).log.apply(e,[this._prefix].concat(r))}}},{key:"warn",value:function(){var e;if(!fr.disabled){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).warn.apply(e,[this._prefix].concat(r))}}},{key:"error",value:function(){var e;if(!fr.disabled){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).error.apply(e,[this._prefix].concat(r))}}},{key:"table",value:function(){var e;fr.disabled||(console.group(this._prefix),(e=console).table.apply(e,arguments),console.groupEnd())}}],[{key:"enable",value:function(){fr.disabled=!1}},{key:"disable",value:function(){fr.disabled=!0}}]),fr);function fr(e,t){_(this,fr),this.name=e||"",this._prefix="[".concat(this.name,"]"),fr.disabled=t}k(hr,"disabled",!0);for(var pr=(g(wr,[{key:"remux",value:function(){var e,t,r,n,i,s=0<arguments.length&&void 0!==arguments[0]&&arguments[0],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=this.videoTrack,u=this.audioTrack,c=o.exist(),l=u.exist(),d=[];return s&&(a&&a.initMerge?(c&&d.push(this.videoTrack),l&&d.push(this.audioTrack),r=cr.initSegment(d)):(c&&(e=cr.initSegment([this.videoTrack])),l&&(t=cr.initSegment([this.audioTrack])))),c&&o.hasSample()&&(n=this._remuxVideo()),l&&u.hasSample()&&(i=this._remuxAudio()),o.samples=[],u.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var n=e.samples,t=0;n.forEach(function(e){t+=e.units.reduce(function(e,t){return e+t.byteLength},0),t+=4*e.units.length});for(var i,s=new Uint8Array(t),a=new DataView(s.buffer),o=0,r=n.length,u=0;o<r;o++)!function(t,e){e=n[o];var r=0;e.units.forEach(function(e){a.setUint32(t,e.byteLength),t+=4,s.set(e,t),t+=e.byteLength,r+=4+e.byteLength}),e.size=r,u=t,i=e}(u,i);var c=cr.mdat(s);return wt(cr.moof([e]),c)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,r=new Uint8Array(e.samples.reduce(function(e,t){return e+t.size},0));e.samples.reduce(function(e,t){return r.set(t.data,e),e+t.size},0);var t=cr.mdat(r);return wt(cr.moof([e]),t)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),wr),vr=(g(Tr,[{key:"mixIn",value:function(e){return Object.assign(this,e)}},{key:"clone",value:function(){var e=new this.constructor;return Object.assign(e,this),e}}],[{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return p(this,t)}}]),Tr),mr=function(){b(u,vr);var o=E(u);function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4*e.length;_(this,u);var r=o.call(this),n=e;if((n=(n=n instanceof ArrayBuffer?new Uint8Array(n):n)instanceof Int8Array||n instanceof Uint8ClampedArray||n instanceof Int16Array||n instanceof Uint16Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n)instanceof Uint8Array){for(var i=n.byteLength,s=[],a=0;a<i;a+=1)s[a>>>2]|=n[a]<<24-a%4*8;r.words=s,r.sigBytes=i}else r.words=e,r.sigBytes=t;return r}return g(u,[{key:"toString",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:yr).stringify(this)}},{key:"concat",value:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var s=0;s<i;s+=1){var a=r[s>>>2]>>>24-s%4*8&255;t[n+s>>>2]|=a<<24-(n+s)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this}},{key:"clamp",value:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}},{key:"clone",value:function(){var e=x(d(u.prototype),"clone",this).call(this);return e.words=this.words.slice(0),e}}],[{key:"random",value:function(e){for(var t=[],r=0;r<e;r+=4){var n=function(e){var t=e,r=987654321,n=4294967295;return function(){var e=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return e/=4294967296,(e+=.5)*(.5<Math.random()?1:-1)}}(4294967296*(i||Math.random())),i=987654071*n();t.push(4294967296*n()|0)}return new u(t,e)}}]),u}(),yr={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=1){var s=t[i>>>2]>>>24-i%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new mr(r,t/2)}},_r=function(e){return function(e){for(var t=e.length,r=[],n=0;n<t;n+=1)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new mr(r,t)}(unescape(encodeURIComponent(e)))},gr=function(){b(r,vr);var t=E(r);function r(){var e;return _(this,r),(e=t.call(this))._minBufferSize=0,e}return g(r,[{key:"reset",value:function(){this._data=new mr,this._nDataBytes=0}},{key:"_append",value:function(e){"string"==typeof e&&(e=_r(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}},{key:"_process",value:function(e){var t,r=this._data,n=this.blockSize,i=r.words,s=r.sigBytes,a=s/(4*n),o=(a=e?Math.ceil(a):Math.max((0|a)-this._minBufferSize,0))*n,s=Math.min(4*o,s);if(o){for(var u=0;u<o;u+=n)this._doProcessBlock(i,u);t=i.splice(0,o),r.sigBytes-=s}return new mr(t,s)}},{key:"clone",value:function(){var e=x(d(r.prototype),"clone",this).call(this);return e._data=this._data.clone(),e}}]),r}(),kr=function(){b(n,gr);var r=E(n);function n(e){var t;return _(this,n),(t=r.call(this)).blockSize=16,t.cfg=Object.assign(new vr,e),t.reset(),t}return g(n,[{key:"reset",value:function(){x(d(n.prototype),"reset",this).call(this),this._doReset()}},{key:"update",value:function(e){return this._append(e),this._process(),this}},{key:"finalize",value:function(e){return e&&this._append(e),this._doFinalize()}}],[{key:"_createHelper",value:function(r){return function(e,t){return new r(t).finalize(e)}}},{key:"_createHmacHelper",value:function(r){return function(e,t){return new br(r,t).finalize(e)}}}]),n}(),br=function(){b(l,vr);var c=E(l);function l(e,t){_(this,l);var r=c.call(this),n=new e;r._hasher=n;var i=t;"string"==typeof i&&(i=_r(i));var s=n.blockSize,e=4*s;(i=i.sigBytes>e?n.finalize(t):i).clamp();t=i.clone();r._oKey=t;i=i.clone();r._iKey=i;for(var a=t.words,o=i.words,u=0;u<s;u+=1)a[u]^=1549556828,o[u]^=909522486;return t.sigBytes=e,i.sigBytes=e,r.reset(),r}return g(l,[{key:"reset",value:function(){var e=this._hasher;e.reset(),e.update(this._iKey)}},{key:"update",value:function(e){return this._hasher.update(e),this}},{key:"finalize",value:function(e){var t=this._hasher,e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}}]),l}(),Sr={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],s=0;s<r;s+=3)for(var a=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,o=0;o<4&&s+.75*o<r;o+=1)i.push(n.charAt(a>>>6*(3-o)&63));var u=n.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,r=this._map;if(!(n=this._reverseMap)){this._reverseMap=[];for(var n=this._reverseMap,i=0;i<r.length;i+=1)n[r.charCodeAt(i)]=i}var s=r.charAt(64);return!s||-1!==(s=e.indexOf(s))&&(t=s),function(e,t,r){for(var n,i=[],s=0,a=0;a<t;a+=1)a%4&&(n=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2,i[s>>>2]|=n<<24-s%4*8,s+=1);return mr.create(i,s)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},Er=[],xr=0;xr<64;xr+=1)Er[xr]=4294967296*Math.abs(Math.sin(xr+1))|0;function Tr(){_(this,Tr)}function wr(e,t,r){_(this,wr),this.videoTrack=e,this.audioTrack=t;t=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=t&&Number(t[1])<50,this.log=new hr("FMP4Remuxer",!r||!r.openLog||!r.openLog)}function Dr(e,t,r,n,i,s,a){return((a=e+(t&r|~t&n)+i+a)<<s|a>>>32-s)+t}function Ar(e,t,r,n,i,s,a){return((a=e+(t&n|r&~n)+i+a)<<s|a>>>32-s)+t}function Cr(e,t,r,n,i,s,a){return((a=e+(t^r^n)+i+a)<<s|a>>>32-s)+t}function Lr(e,t,r,n,i,s,a){return((a=e+(r^(t|~n))+i+a)<<s|a>>>32-s)+t}var Or=function(){b(t,kr);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,[{key:"_doReset",value:function(){this._hash=new mr([1732584193,4023233417,2562383102,271733878])}},{key:"_doProcessBlock",value:function(e,t){for(var r=e,n=0;n<16;n+=1){var i=t+n,s=e[i];r[i]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var a=this._hash.words,o=r[t+0],u=r[t+1],c=r[t+2],l=r[t+3],d=r[t+4],h=r[t+5],f=r[t+6],p=r[t+7],v=r[t+8],m=r[t+9],y=r[t+10],_=r[t+11],g=r[t+12],k=r[t+13],b=r[t+14],S=r[t+15],E=a[0],x=a[1],T=a[2],w=a[3],E=Dr(E,x,T,w,o,7,Er[0]),w=Dr(w,E,x,T,u,12,Er[1]),T=Dr(T,w,E,x,c,17,Er[2]),x=Dr(x,T,w,E,l,22,Er[3]);E=Dr(E,x,T,w,d,7,Er[4]),w=Dr(w,E,x,T,h,12,Er[5]),T=Dr(T,w,E,x,f,17,Er[6]),x=Dr(x,T,w,E,p,22,Er[7]),E=Dr(E,x,T,w,v,7,Er[8]),w=Dr(w,E,x,T,m,12,Er[9]),T=Dr(T,w,E,x,y,17,Er[10]),x=Dr(x,T,w,E,_,22,Er[11]),E=Dr(E,x,T,w,g,7,Er[12]),w=Dr(w,E,x,T,k,12,Er[13]),T=Dr(T,w,E,x,b,17,Er[14]),x=Dr(x,T,w,E,S,22,Er[15]),E=Ar(E,x,T,w,u,5,Er[16]),w=Ar(w,E,x,T,f,9,Er[17]),T=Ar(T,w,E,x,_,14,Er[18]),x=Ar(x,T,w,E,o,20,Er[19]),E=Ar(E,x,T,w,h,5,Er[20]),w=Ar(w,E,x,T,y,9,Er[21]),T=Ar(T,w,E,x,S,14,Er[22]),x=Ar(x,T,w,E,d,20,Er[23]),E=Ar(E,x,T,w,m,5,Er[24]),w=Ar(w,E,x,T,b,9,Er[25]),T=Ar(T,w,E,x,l,14,Er[26]),x=Ar(x,T,w,E,v,20,Er[27]),E=Ar(E,x,T,w,k,5,Er[28]),w=Ar(w,E,x,T,c,9,Er[29]),T=Ar(T,w,E,x,p,14,Er[30]),x=Ar(x,T,w,E,g,20,Er[31]),E=Cr(E,x,T,w,h,4,Er[32]),w=Cr(w,E,x,T,v,11,Er[33]),T=Cr(T,w,E,x,_,16,Er[34]),x=Cr(x,T,w,E,b,23,Er[35]),E=Cr(E,x,T,w,u,4,Er[36]),w=Cr(w,E,x,T,d,11,Er[37]),T=Cr(T,w,E,x,p,16,Er[38]),x=Cr(x,T,w,E,y,23,Er[39]),E=Cr(E,x,T,w,k,4,Er[40]),w=Cr(w,E,x,T,o,11,Er[41]),T=Cr(T,w,E,x,l,16,Er[42]),x=Cr(x,T,w,E,f,23,Er[43]),E=Cr(E,x,T,w,m,4,Er[44]),w=Cr(w,E,x,T,g,11,Er[45]),T=Cr(T,w,E,x,S,16,Er[46]),x=Cr(x,T,w,E,c,23,Er[47]),E=Lr(E,x,T,w,o,6,Er[48]),w=Lr(w,E,x,T,p,10,Er[49]),T=Lr(T,w,E,x,b,15,Er[50]),x=Lr(x,T,w,E,h,21,Er[51]),E=Lr(E,x,T,w,g,6,Er[52]),w=Lr(w,E,x,T,l,10,Er[53]),T=Lr(T,w,E,x,y,15,Er[54]),x=Lr(x,T,w,E,u,21,Er[55]),E=Lr(E,x,T,w,v,6,Er[56]),w=Lr(w,E,x,T,S,10,Er[57]),T=Lr(T,w,E,x,f,15,Er[58]),x=Lr(x,T,w,E,k,21,Er[59]),E=Lr(E,x,T,w,d,6,Er[60]),w=Lr(w,E,x,T,_,10,Er[61]),T=Lr(T,w,E,x,c,15,Er[62]),x=Lr(x,T,w,E,m,21,Er[63]),a[0]=a[0]+E|0,a[1]=a[1]+x|0,a[2]=a[2]+T|0,a[3]=a[3]+w|0}},{key:"_doFinalize",value:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32;var i=Math.floor(r/4294967296),r=r;t[15+(64+n>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t[14+(64+n>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var t=this._hash,s=t.words,a=0;a<4;a+=1){var o=s[a];s[a]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return t}},{key:"clone",value:function(){var e=x(d(t.prototype),"clone",this).call(this);return e._hash=this._hash.clone(),e}}]),t}();kr._createHelper(Or),kr._createHmacHelper(Or);var Rr=function(){b(n,vr);var r=E(n);function n(e){var t;return _(this,n),(t=r.call(this)).cfg=Object.assign(new vr,{keySize:4,hasher:Or,iterations:1},e),t}return g(n,[{key:"compute",value:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),s=mr.create(),a=s.words,o=n.keySize,u=n.iterations;a.length<o;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var c=1;c<u;c+=1)r=i.finalize(r),i.reset();s.concat(r)}return s.sigBytes=4*o,s}}]),n}(),jr=function(){b(s,gr);var i=E(s);function s(e,t,r){var n;return _(this,s),(n=i.call(this)).cfg=Object.assign(new vr,r),n._xformMode=e,n._key=t,n.reset(),n}return g(s,[{key:"reset",value:function(){x(d(s.prototype),"reset",this).call(this),this._doReset()}},{key:"process",value:function(e){return this._append(e),this._process()}},{key:"finalize",value:function(e){return e&&this._append(e),this._doFinalize()}}],[{key:"createEncryptor",value:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}},{key:"createDecryptor",value:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}},{key:"_createHelper",value:function(n){function i(e){return"string"==typeof e?Vr:Fr}return{encrypt:function(e,t,r){return i(t).encrypt(n,e,t,r)},decrypt:function(e,t,r){return i(t).decrypt(n,e,t,r)}}}}]),s}();jr._ENC_XFORM_MODE=1,jr._DEC_XFORM_MODE=2,jr.keySize=4,jr.ivSize=4;var Ir=function(){b(i,vr);var n=E(i);function i(e,t){var r;return _(this,i),(r=n.call(this))._cipher=e,r._iv=t,r}return g(i,null,[{key:"createEncryptor",value:function(e,t){return this.Encryptor.create(e,t)}},{key:"createDecryptor",value:function(e,t){return this.Decryptor.create(e,t)}}]),i}();function Pr(e,t,r){var n,i=e,e=this._iv;e?(n=e,this._iv=void 0):n=this._prevBlock;for(var s=0;s<r;s+=1)i[t+s]^=n[s]}var Br=function(){b(t,Ir);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t)}();Br.Encryptor=function(){b(t,Br);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,[{key:"processBlock",value:function(e,t){var r=this._cipher,n=r.blockSize;Pr.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}]),t}(),Br.Decryptor=function(){b(t,Br);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,[{key:"processBlock",value:function(e,t){var r=this._cipher,n=r.blockSize,i=e.slice(t,t+n);r.decryptBlock(e,t),Pr.call(this,e,t,n),this._prevBlock=i}}]),t}();var Ur={pad:function(e,t){for(var t=4*t,r=t-e.sigBytes%t,n=r<<24|r<<16|r<<8|r,i=[],s=0;s<r;s+=4)i.push(n);t=mr.create(i,r);e.concat(t)},unpad:function(e){var t=e,e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},Mr=function(){b(i,jr);var n=E(i);function i(e,t,r){return _(this,i),(r=n.call(this,e,t,Object.assign({mode:Br,padding:Ur},r))).blockSize=4,r}return g(i,[{key:"reset",value:function(){var e;x(d(i.prototype),"reset",this).call(this);var t=this.cfg,r=t.iv,t=t.mode;this._xformMode===this.constructor._ENC_XFORM_MODE?e=t.createEncryptor:(e=t.createDecryptor,this._minBufferSize=1),this._mode=e.call(t,this,r&&r.words),this._mode.__creator=e}},{key:"_doProcessBlock",value:function(e,t){this._mode.processBlock(e,t)}},{key:"_doFinalize",value:function(){var e,t=this.cfg.padding;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}]),i}(),Nr=function(){b(n,vr);var r=E(n);function n(e){var t;return _(this,n),(t=r.call(this)).mixIn(e),t}return g(n,[{key:"toString",value:function(e){return(e||this.formatter).stringify(this)}}]),n}(),be={stringify:function(e){var t=e.ciphertext,e=e.salt;return(e?mr.create([1398893684,1701076831]).concat(e).concat(t):t).toString(Sr)},parse:function(e){var t,r=Sr.parse(e),e=r.words;return 1398893684===e[0]&&1701076831===e[1]&&(t=mr.create(e.slice(2,4)),e.splice(0,4),r.sigBytes-=16),Nr.create({ciphertext:r,salt:t})}},Fr=function(){b(t,vr);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,null,[{key:"encrypt",value:function(e,t,r,n){var i=Object.assign(new vr,this.cfg,n),s=e.createEncryptor(r,i),n=s.finalize(t),t=s.cfg;return Nr.create({ciphertext:n,key:r,iv:t.iv,algorithm:e,mode:t.mode,padding:t.padding,blockSize:s.blockSize,formatter:i.format})}},{key:"decrypt",value:function(e,t,r,n){n=Object.assign(new vr,this.cfg,n),t=this._parse(t,n.format);return e.createDecryptor(r,n).finalize(t.ciphertext)}},{key:"_parse",value:function(e,t){return"string"==typeof e?t.parse(e,this):e}}]),t}();Fr.cfg=Object.assign(new vr,{format:be});var be={execute:function(e,t,r,n){n=n||mr.random(8),e=Rr.create({keySize:t+r}).compute(e,n),r=mr.create(e.words.slice(t),4*r);return e.sigBytes=4*t,Nr.create({key:e,iv:r,salt:n})}},Vr=function(){b(t,Fr);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,null,[{key:"encrypt",value:function(e,t,r,n){n=Object.assign(new vr,this.cfg,n),r=n.kdf.execute(r,e.keySize,e.ivSize);n.iv=r.iv;n=Fr.encrypt.call(this,e,t,r.key,n);return n.mixIn(r),n}},{key:"decrypt",value:function(e,t,r,n){n=Object.assign(new vr,this.cfg,n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=r.iv,Fr.decrypt.call(this,e,t,r.key,n)}}]),t}();Vr.cfg=Object.assign(Fr.cfg,{kdf:be});for(var zr=[],qr=[],Gr=[],Hr=[],Kr=[],Yr=[],Wr=[],Xr=[],Qr=[],Jr=[],Zr=[],$r=0;$r<256;$r+=1)Zr[$r]=$r<128?$r<<1:$r<<1^283;for(var en=0,tn=0,rn=0;rn<256;rn+=1){var nn=tn^tn<<1^tn<<2^tn<<3^tn<<4;zr[en]=nn=nn>>>8^255&nn^99;var sn=Zr[qr[nn]=en],an=Zr[sn],on=Zr[an],un=257*Zr[nn]^16843008*nn;Gr[en]=un<<24|un>>>8,Hr[en]=un<<16|un>>>16,Kr[en]=un<<8|un>>>24,Yr[en]=un,Wr[nn]=(un=16843009*on^65537*an^257*sn^16843008*en)<<24|un>>>8,Xr[nn]=un<<16|un>>>16,Qr[nn]=un<<8|un>>>24,Jr[nn]=un,en?(en=sn^Zr[Zr[Zr[on^sn]]],tn^=Zr[Zr[tn]]):en=tn=1}var cn=[0,1,2,4,8,16,32,64,128,27,54],be=function(){b(t,Mr);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,[{key:"_doReset",value:function(){if(!this._nRounds||this._keyPriorReset!==this._key){this._keyPriorReset=this._key;var e=this._keyPriorReset,t=e.words,r=e.sigBytes/4;this._nRounds=6+r;var n=4*(this._nRounds+1);this._keySchedule=[];for(var i=this._keySchedule,s=0;s<n;s+=1)s<r?i[s]=t[s]:(c=i[s-1],s%r?6<r&&s%r==4&&(c=zr[c>>>24]<<24|zr[c>>>16&255]<<16|zr[c>>>8&255]<<8|zr[255&c]):(c=zr[(c=c<<8|c>>>24)>>>24]<<24|zr[c>>>16&255]<<16|zr[c>>>8&255]<<8|zr[255&c],c^=cn[s/r|0]<<24),i[s]=i[s-r]^c);this._invKeySchedule=[];for(var a=this._invKeySchedule,o=0;o<n;o+=1){var u=n-o,c=o%4?i[u]:i[u-4];a[o]=o<4||u<=4?c:Wr[zr[c>>>24]]^Xr[zr[c>>>16&255]]^Qr[zr[c>>>8&255]]^Jr[zr[255&c]]}}}},{key:"encryptBlock",value:function(e,t){this._doCryptBlock(e,t,this._keySchedule,Gr,Hr,Kr,Yr,zr)}},{key:"decryptBlock",value:function(e,t){var r=e,e=r[t+1];r[t+1]=r[t+3],r[t+3]=e,this._doCryptBlock(r,t,this._invKeySchedule,Wr,Xr,Qr,Jr,qr),e=r[t+1],r[t+1]=r[t+3],r[t+3]=e}},{key:"_doCryptBlock",value:function(e,t,r,n,i,s,a,o){for(var u=e,c=this._nRounds,l=u[t]^r[0],d=u[t+1]^r[1],h=u[t+2]^r[2],f=u[t+3]^r[3],p=4,v=1;v<c;v+=1){var m=n[l>>>24]^i[d>>>16&255]^s[h>>>8&255]^a[255&f]^r[p];p+=1;var y=n[d>>>24]^i[h>>>16&255]^s[f>>>8&255]^a[255&l]^r[p];p+=1;var _=n[h>>>24]^i[f>>>16&255]^s[l>>>8&255]^a[255&d]^r[p];p+=1;var g=n[f>>>24]^i[l>>>16&255]^s[d>>>8&255]^a[255&h]^r[p];p+=1,l=m,d=y,h=_,f=g}var k=(o[l>>>24]<<24|o[d>>>16&255]<<16|o[h>>>8&255]<<8|o[255&f])^r[p],b=(o[d>>>24]<<24|o[h>>>16&255]<<16|o[f>>>8&255]<<8|o[255&l])^r[p+=1],e=(o[h>>>24]<<24|o[f>>>16&255]<<16|o[l>>>8&255]<<8|o[255&d])^r[p+=1],o=(o[f>>>24]<<24|o[l>>>16&255]<<16|o[d>>>8&255]<<8|o[255&h])^r[p+=1];p+=1,u[t]=k,u[t+1]=b,u[t+2]=e,u[t+3]=o}}]),t}();be.keySize=8,Mr._createHelper(be);var ln=function(){b(t,Ir);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t)}();ln.Encryptor=function(){b(t,ln);var e=E(t);function t(){return _(this,t),e.apply(this,arguments)}return g(t,[{key:"processBlock",value:function(e,t){var r=e,n=this._cipher,i=n.blockSize,s=this._iv,e=this._counter;s&&(this._counter=s.slice(0),e=this._counter,this._iv=void 0);var a=e.slice(0);n.encryptBlock(a,0),e[i-1]=e[i-1]+1|0;for(var o=0;o<i;o+=1)r[t+o]^=a[o]}}]),t}(),ln.Decryptor=ln.Encryptor;var dn,hn,fn,pn,vn,mn,yn,_n,gn,kn,bn,Sn=(g(Ln,[{key:"destroy",value:function(){var e;null!==(e=this.externalDecryptor)&&void 0!==e&&e.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(e,t){if(e||t){var r=[];return e&&(r[0]=this._decryptSegment(e)),t&&(r[1]=this._decryptSegment(t)),Promise.all(r)}}},{key:"_decryptSegment",value:(bn=C(A().mark(function e(t){var r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,t.key)return e.next=4,this._decryptData(t.data,t.key,t.keyIv);e.next=5;break;case 4:r=e.sent;case 5:if(t.map){e.next=7;break}return e.abrupt("return",r);case 7:return e.abrupt("return",Ie(t.map,r));case 8:case"end":return e.stop()}},e,this)})),function(e){return bn.apply(this,arguments)})},{key:"_decryptData",value:(kn=C(A().mark(function e(t,r,n){var i;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.externalDecryptor)return e.next=3,this.externalDecryptor.decrypt(t,r,n);e.next=6;break;case 3:return e.abrupt("return",e.sent);case 6:if(this.subtle){e.next=8;break}throw new Error("crypto is not defined");case 8:return e.next=10,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return i=e.sent,e.t0=Uint8Array,e.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},i,t);case 14:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 16:case"end":return e.stop()}},e,this)})),function(e,t,r){return kn.apply(this,arguments)})}]),Ln),En=m(m({},ke),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),xn=new W("Transmuxer"),Tn=(g(Cn,[{key:"transmux",value:function(e,t,r,n,i,s){var a=this._demuxer;try{this._isMP4?a.demux(e,t):a.demuxAndFix(Ie(e,t),r,n,i)}catch(e){throw new G(M,z.HLS,e)}t=a.videoTrack,n=a.audioTrack,i=a.metadataTrack,a="".concat(t.codec,"/").concat(t.width,"/").concat(t.height,"/").concat(n.codec,"/").concat(n.config);if(a!==this._initSegmentId&&(this._initSegmentId=a,s=!0),this._fireEvents(t,n,i,r||s),this.hls.emit(En.DEMUXED_TRACK,{videoTrack:t,audioTrack:n}),!this._remuxer)return[t,n];try{var o=this._remuxer.remux(s),u=o.videoInitSegment,c=o.videoSegment,l=o.audioInitSegment,d=o.audioSegment,h=Ie(u,c),f=Ie(l,d);return[h?{codec:t.codec,data:h}:void 0,f?{codec:n.codec,data:f}:void 0]}catch(e){throw new G(N,z.FMP4,e)}}},{key:"_fireEvents",value:function(e,t,r,n){var i=this;xn.debug(e.samples,t.samples),n&&(e.exist()&&this.hls.emit(En.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.hls.emit(En.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),xn.debug("discontinuity",e,t)),e.warnings.forEach(function(e){var t;switch(e.type){case Ye:t=En.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case We:t=En.LARGE_VIDEO_DTS_GAP_DETECT;break;case Xe:t=En.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&i.hls.emit(En.STREAM_EXCEPTION,m(m({},e),{},{type:t})),xn.warn("video exception",e)}),t.warnings.forEach(function(e){var t;switch(e.type){case Qe:t=En.LARGE_AUDIO_DTS_GAP_DETECT;break;case Je:t=En.AUDIO_GAP_DETECT;break;case Ze:t=En.AUDIO_OVERLAP_DETECT}t&&i.hls.emit(En.STREAM_EXCEPTION,m(m({},e),{},{type:t})),xn.warn("audio exception",e)}),e.samples.forEach(function(e){e.keyframe&&i.hls.emit(En.KEYFRAME,{pts:e.pts})}),r.seiSamples.forEach(function(e){i.hls.emit(En.SEI,m(m({},e),{},{originPts:e.originPts/90,sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))})}}]),Cn),wn=new W("BufferService"),Dn=(g(An,[{key:"baseDts",get:function(){var e,t,r;return null===(e=this._transmuxer)||void 0===e||null===(t=e._demuxer)||void 0===t||null===(r=t._fixer)||void 0===r?void 0:r._baseDts}},{key:"nbSb",get:function(){var e;return null!==(e=this._mse)&&void 0!==e&&e._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpend",get:function(){var e;return null===(e=this._mse)||void 0===e?void 0:e.isOpened}},{key:"updateDuration",value:(gn=C(A().mark(function e(t){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(wn.debug("update duration",t),!this._mse){e.next=9;break}if(this._mse.isOpened){e.next=5;break}return e.next=5,this._mse.open();case 5:return e.next=7,this._mse.updateDuration(t);case 7:e.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=t);case 10:case"end":return e.stop()}},e,this)})),function(e){return gn.apply(this,arguments)})},{key:"createSource",value:function(e,t,r,n){if(!this._sourceCreated){var i,s=e||t;if(s){if(Xt.probe(s))this._transmuxer||(this._transmuxer=new Tn(this.hls,!1,!this._softVideo));else{if(!Qt.probe(s))throw new G(V,null,null,null,"unsupported stream");this._softVideo?this._transmuxer||(this._transmuxer=new Tn(this.hls,!0)):(i=!(this._directAppend=!0),e&&!r&&Qt.findBox(e,["moov","trak"]).forEach(function(e){e=Qt.findBox(e.data,["trak","mdia","minf","stbl","stsd"])[0];!e||(e=Qt.stsd(e).entries[0])&&(e.hvcC?r=e.hvcC.codec||"hev1.1.6.L93.B0":e.avcC?r=e.avcC.codec:(e.sampleRate||e.esds)&&(n=(null===(e=e.esds)||void 0===e?void 0:e.codec)||"mp4a.40.2",i=!0))}),t&&!n&&Qt.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(e){e=Qt.stsd(e).entries[0];e&&e.esds&&(n=e.esds.codec)}),e&&!r&&(r="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),i&&(r+=", ".concat(n),n=""),this._createMseSource(r,n))}this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:(_n=C(A().mark(function e(t,r,n,i,s,a,o){var u,c,l,d,h,f;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.length||null!=i&&i.length){e.next=2;break}return e.abrupt("return");case 2:if(this._directAppend)return d=[],n&&d.push(this._mse.append(ie.VIDEO,n)),i&&d.push(this._mse.append(ie.AUDIO,i)),e.abrupt("return",Promise.all(d));e.next=7;break;case 7:if(u=this._needInitSegment||s,h=this._transmuxer.transmux(n,i,s,a,o,this._needInitSegment||s),f=T(h,2),c=f[0],l=f[1],i&&r&&(null==r||r.setTrackExist(!1,!0)),i&&t&&(null==t||t.setTrackExist(!0,!1)),r||null==t||t.setTrackExist(!!c,!!l),c&&!l&&this.hls.emit(En.NO_AUDIO_TRACK),!this._softVideo){e.next=18;break}this._softVideo.appendBuffer(c,l),this._needInitSegment=!1,e.next=28;break;case 18:if(this._mse)return(d=!this._sourceCreated)&&this._createMseSource(null==c?void 0:c.codec,null==l?void 0:l.codec),this._needInitSegment=!1,h=this._mse,f=[],u&&!d&&this._handleCodecChange(c,l),c&&f.push(h.append(ie.VIDEO,c.data)),l&&f.push(h.append(ie.AUDIO,l.data)),e.abrupt("return",Promise.all(f));e.next=28;break;case 28:case"end":return e.stop()}},e,this)})),function(e,t,r,n,i,s,a){return _n.apply(this,arguments)})},{key:"removeBuffer",value:(yn=C(A().mark(function e(){var t,r,n,i=this,s=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<s.length&&void 0!==s[0]?s[0]:0,r=1<s.length&&void 0!==s[1]?s[1]:1/0,n=this.hls.media,!this._mse||!n||t<0||r<t||t>=this._mse.duration)return e.abrupt("return");e.next=5;break;case 5:return e.abrupt("return",this._mse.clearBuffer(t,r).then(function(){return i.hls.emit(ke.REMOVE_BUFFER,{start:t,end:r,removeEnd:r})}));case 6:case"end":return e.stop()}},e,this)})),function(){return yn.apply(this,arguments)})},{key:"evictBuffer",value:(mn=C(A().mark(function e(t){var r,n;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.hls.media,!(this._mse&&r&&t)||t<0)return e.abrupt("return");e.next=3;break;case 3:if(n=r.currentTime,(n=n-t)<=0)return e.abrupt("return");e.next=7;break;case 7:if(I.start(I.get(r))+1>=n)return e.abrupt("return");e.next=10;break;case 10:return e.abrupt("return",this.removeBuffer(0,n));case 11:case"end":return e.stop()}},e,this)})),function(e){return mn.apply(this,arguments)})},{key:"clearAllBuffer",value:(vn=C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._mse)return e.abrupt("return",this._mse.clearAllBuffer());e.next=2;break;case 2:case"end":return e.stop()}},e,this)})),function(){return vn.apply(this,arguments)})},{key:"decryptBuffer",value:function(e,t){return this._decryptor.decrypt(e,t)}},{key:"reset",value:(pn=C(A().mark(function e(){var t,r=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<r.length&&void 0!==r[0]&&r[0],this._mse&&!t)return this._transmuxer=null,this._sourceCreated=!1,e.next=6,this._mse.unbindMedia();e.next=8;break;case 6:return e.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return e.stop()}},e,this)})),function(){return pn.apply(this,arguments)})},{key:"endOfStream",value:(fn=C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}if(this._sourceCreated)return e.next=4,this._mse.endOfStream();e.next=5;break;case 4:this.hls.emit(ke.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return e.stop()}},e,this)})),function(){return fn.apply(this,arguments)})},{key:"setLiveSeekableRange",value:(hn=C(A().mark(function e(t,r){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._mse&&this._mse.setLiveSeekableRange(t,r);case 1:case"end":return e.stop()}},e,this)})),function(e,t){return hn.apply(this,arguments)})},{key:"destroy",value:(dn=C(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._decryptor)||void 0===t||t.destroy(),this._mse)return e.next=4,this._mse.unbindMedia();e.next=4;break;case 4:this._decryptor=null,this._mse=null,this._softVideo=null;case 7:case"end":return e.stop()}},e,this)})),function(){return dn.apply(this,arguments)})},{key:"_createMseSource",value:function(e,t){wn.debug("create mse source, videoCodec=".concat(e,", audioCodec=").concat(t));var r=this._mse;r&&(e&&(r.createSource(ie.VIDEO,"video/mp4;codecs=".concat(e)),this._sourceCreated=!0),t&&(r.createSource(ie.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(ke.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(e,t){var i=this._mse;[{type:ie.VIDEO,codecs:null==e?void 0:e.codec},{type:ie.AUDIO,codecs:null==t?void 0:t.codec}].filter(function(e){return!!e.codecs}).forEach(function(e){var t=e.type,r=e.codecs,n=i.getSourceBuffer(t);n&&(e=r.split(",")[0],new RegExp(e,"ig").test(n.mimeType)||i.changeType(t,"".concat(t,"/mp4;codecs=").concat(r)))})}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ie.VIDEO;return this._mse.isFull(e)}}]),An);function An(e){_(this,An),k(this,"_decryptor",new Sn),k(this,"_transmuxer",null),k(this,"_mse",null),k(this,"_softVideo",null),k(this,"_sourceCreated",!1),k(this,"_needInitSegment",!0),k(this,"_directAppend",!1),(this.hls=e).config.softDecode?this._softVideo=e.media:(this._mse=new ie,e.config.url&&this._mse.bindMedia(e.media)),e.config.decryptor&&(this._decryptor.externalDecryptor=e.config.decryptor)}function Cn(e,t,r){_(this,Cn),k(this,"_initSegmentId",""),this.hls=e,this._demuxer=new(t?sr:Xt),this._isMP4=t,r&&(this._remuxer=new pr(this._demuxer.videoTrack,this._demuxer.audioTrack))}function Ln(){_(this,Ln);var e=window.crypto||window.msCrypto;this.subtle=e&&(e.subtle||e.webkitSubtle),this.externalDecryptor=null}var On=g(function e(){_(this,e),k(this,"version",0),k(this,"streams",[]),k(this,"isMaster",!0)}),Rn="AUDIO",jn="SUBTITLE",In=g(function e(){_(this,e),k(this,"id",0),k(this,"url",""),k(this,"default",!1),k(this,"autoSelect",!1),k(this,"forced",!1),k(this,"group",""),k(this,"name",""),k(this,"lang",""),k(this,"segments",[]),k(this,"endSN",0)}),Pn=function(){b(s,In);var i=E(s);function s(){var e;_(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return k(S(e=i.call.apply(i,[this].concat(r))),"mediaType",Rn),k(S(e),"channels",0),e}return g(s)}(),Bn=function(){b(s,In);var i=E(s);function s(){var e;_(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return k(S(e=i.call.apply(i,[this].concat(r))),"mediaType",jn),e}return g(s)}(),Un=g(function e(){_(this,e),k(this,"id",0),k(this,"bitrate",0),k(this,"width",0),k(this,"height",0),k(this,"name",""),k(this,"url",""),k(this,"audioCodec",""),k(this,"videoCodec",""),k(this,"textCodec",""),k(this,"audioGroup",""),k(this,"audioStreams",[]),k(this,"subtitleStreams",[]),k(this,"closedCaptionsStream",[])}),Mn=g(function e(){_(this,e),k(this,"version",0),k(this,"url",""),k(this,"type",""),k(this,"startCC",0),k(this,"endCC",0),k(this,"startSN",0),k(this,"endSN",0),k(this,"totalDuration",0),k(this,"targetDuration",0),k(this,"partTargetDuration",0),k(this,"canSkipUntil",0),k(this,"canSkipDateRanges",!1),k(this,"skippedSegments",0),k(this,"canBlockReload",!1),k(this,"partHoldBack",0),k(this,"live",!0),k(this,"lowLatency",!1),k(this,"endPartIndex",0),k(this,"segments",[])}),Nn=(g(Kn,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(e,t){this.hasVideo=e,this.hasAudio=t}},{key:"setByteRange",value:function(e,t){this.byteRange=[0];e=e.split("@");1===e.length&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),Kn),Fn=(g(Hn,[{key:"clone",value:function(e){var t=new Hn(this);return null!=e&&t.setIVFromSN(e),t}},{key:"setIVFromSN",value:function(e){if(!this.iv&&"AES-128"===this.method&&"number"==typeof e&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=e>>8*(15-t)&255}}}]),Hn),Vn=/^#(EXT[^:]*)(?::(.*))?$/,zn=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,qn=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,Gn=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function Hn(e){_(this,Hn),k(this,"method",""),k(this,"url",""),k(this,"iv",null),k(this,"keyFormat",""),k(this,"keyFormatVersions",""),e instanceof Hn&&(this.method=e.method,this.url=e.url,this.keyFormat=e.keyFormat,this.keyFormatVersions=e.keyFormatVersions,e.iv&&(this.iv=new Uint8Array(e.iv)))}function Kn(){_(this,Kn),k(this,"sn",0),k(this,"cc",0),k(this,"url",""),k(this,"title",""),k(this,"start",0),k(this,"duration",0),k(this,"dataTime",""),k(this,"key",null),k(this,"byteRange",null),k(this,"isInitSegment",!1),k(this,"initSegment",null),k(this,"isLast",!1),k(this,"hasAudio",!1),k(this,"hasVideo",!1),k(this,"independent",!1),k(this,"partIndex",0)}function Yn(e){e=e.match(Vn);if(e&&e[1])return[e[1].replace("EXT-X-",""),e[2]]}function Wn(e){for(var t={},r=zn.exec(e);r;)t[r[1]]=r[2]||r[3],r=zn.exec(e);return t}function Xn(e,t){if(!t||!e||qn.test(e))return e;t=Gn.exec(t);return t?"/"===e[0]?t[1]+e:t[1]+t[2]+e:e}var Qn={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Jn(e,t){var r=Qn[e];if(r&&t&&t.length)for(var n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i]))return t[i]}var Zn,$n=(g(ri,null,[{key:"parse",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length?arguments[1]:void 0,r=2<arguments.length?arguments[2]:void 0;if(!e.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=e.split(/[\r\n]/).map(function(e){return e.trim()}).filter(Boolean);return ri.isMediaPlaylist(e)?function(e,t,r){var n=new Mn;n.url=t;for(var i,s=new Nn,a=null,o=null,u=0,c=0,l=0,d=0,h=!1,f=0;(i=e[d++])&&!h;)if("#"===i[0]){var p=Yn(i);if(p){var v=T(p,2),p=v[0],m=v[1];switch(p){case"VERSION":n.version=parseInt(m);break;case"PLAYLIST-TYPE":n.type=null==m?void 0:m.toUpperCase();break;case"TARGETDURATION":n.targetDuration=parseFloat(m);break;case"PART-INF":r&&(n.lowLatency=!0);var y=Wn(m);y["PART-TARGET"]&&(n.partTargetDuration=parseFloat(y["PART-TARGET"]));break;case"SERVER-CONTROL":y=Wn(m);n.canBlockReload="YES"===y["CAN-BLOCK-RELOAD"],n.partHoldBack=parseFloat(y["PART-HOLD-BACK"]||0),n.canSkipUntil=parseFloat(y["CAN-SKIP-UNTIL"]||0),n.canSkipDateRanges="YES"===y["CAN-SKIP-DATERANGES"];break;case"ENDLIST":var _=n.segments[n.segments.length-1];_&&(_.isLast=!0),h=!(n.live=!1);break;case"MEDIA-SEQUENCE":c=n.startSN=parseInt(m);break;case"DISCONTINUITY-SEQUENCE":l=n.startCC=parseInt(m);break;case"DISCONTINUITY":l++;break;case"BYTERANGE":s.setByteRange(m,n.segments[n.segments.length-1]);break;case"PART":if(!n.lowLatency)break;var g=Wn(m);s.duration=parseFloat(g.DURATION),s.independent="YES"===g.INDEPENDENT,s.sn=c,s.cc=l,s.partIndex=f,s.start=u,s.duration=parseFloat(g.DURATION),u+=s.duration,s.url=Xn(g.URI,t),o&&(s.key=o.clone(c)),a&&(s.initSegment=a),n.segments.push(s),s=new Nn,f++;break;case"PRELOAD-HINT":break;case"PROGRAM-DATE-TIME":s.dataTime=m;break;case"EXTINF":if(n.lowLatency){f=0;break}_=T(m.split(","),2),g=_[0],_=_[1];s.start=u,s.duration=parseFloat(g),u+=s.duration,s.title=_;break;case"KEY":var k=Wn(m);if("NONE"===k.METHOD){o=null;break}if("AES-128"!==k.METHOD)throw new Error("encrypt ".concat(k.METHOD,"/").concat(k.KEYFORMAT," is not supported"));if((o=new Fn).method=k.METHOD,o.url=/^blob:/.test(k.URI)?k.URI:Xn(k.URI,t),o.keyFormat=k.KEYFORMAT||"identity",o.keyFormatVersions=k.KEYFORMATVERSIONS,k.IV){var b=(1&(b=k.IV.slice(2)).length?"0":"")+b;o.iv=new Uint8Array(b.length/2);for(var S=0,E=b.length/2;S<E;S++)o.iv[S]=parseInt(b.slice(2*S,2*S+2),16)}break;case"MAP":k=Wn(m);s.url=Xn(k.URI,t),k.BYTERANGE&&s.setByteRange(k.BYTERANGE),s.isInitSegment=!0,s.sn=0,o&&(s.key=o.clone(0)),a=s,s=new Nn}}}else{if(n.lowLatency){c++;continue}s.sn=c,s.cc=l,s.url=Xn(i,t),o&&(s.key=o.clone(c)),a&&(s.initSegment=a),n.segments.push(s),s=new Nn,c++}n.segments=n.segments.filter(function(e){return 0!==e.duration});var x=n.segments[n.segments.length-1];return x&&(n.endSN=x.sn,n.endPartIndex=x.partIndex),n.totalDuration=u,n.endCC=l,n}(n,t,r):function(e,t){for(var r=new On,n=0,i=[],s=[];u=e[n++];){var a=Yn(u);if(a){var o,u=T(a,2),a=u[0],u=u[1];if("VERSION"===a)r.version=parseInt(u);else if("MEDIA"===a&&u){var c=Wn(u),l=void 0;switch(c.TYPE){case"AUDIO":l=new Pn;break;case"SUBTITLES":l=new Bn;break;default:l=new In}l.url=Xn(c.URI,t),l.default="YES"===c.DEFAULT,l.autoSelect="YES"===c.AUTOSELECT,l.group=c["GROUP-ID"],l.name=c.NAME,l.lang=c.LANGUAGE,c.CHANNELS&&(l.channels=Number(c.CHANNELS.split("/")[0]),Number.isNaN(l.channels)&&(l.channels=0)),"AUDIO"===c.TYPE&&c.URI&&i.push(l),"SUBTITLES"===c.TYPE&&s.push(l)}else"STREAM-INF"===a&&u&&(c=new Un,a=Wn(u),c.bitrate=parseInt(a["AVERAGE-BANDWIDTH"]||a.BANDWIDTH),c.name=a.NAME,c.url=Xn(e[n++],t),a.RESOLUTION&&(u=(o=T(a.RESOLUTION.split("x"),2))[0],o=o[1],c.width=parseInt(u),c.height=parseInt(o)),a.CODECS&&(o=a.CODECS.split(/[ ,]+/).filter(Boolean),c.videoCodec=Jn("video",o),c.audioCodec=Jn("audio",o),c.textCodec=Jn("text",o)),c.audioGroup=a.AUDIO,c.subtitleGroup=a.SUBTITLES,r.streams.push(c))}}return r.streams.forEach(function(e,t){e.id=t}),i.length&&(i.forEach(function(e,t){e.id=t}),r.streams.forEach(function(t){t.audioGroup&&(t.audioStreams=i.filter(function(e){return e.group===t.audioGroup}))})),s.length&&(s.forEach(function(e,t){e.id=t}),r.streams.forEach(function(t){t.subtitleGroup&&(t.subtitleStreams=s.filter(function(e){return e.group===t.subtitleGroup}))})),r}(n,t)}},{key:"isMediaPlaylist",value:function(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")}}]),ri),ei=(g(ti,[{key:"load",value:(Zn=C(A().mark(function e(t,r,n){var i,s,a,o,u,c,l,d,h,f,p;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=[this._loader.load(t)],r&&i.push(this._audioLoader.load(r)),n&&i.push(this._subtitleLoader.load(n)),e.prev=3,e.next=6,Promise.all(i);case 6:if(l=e.sent,p=T(l,3),u=p[0],c=p[1],l=p[2],u){e.next=13;break}return e.abrupt("return",[]);case 13:this._emitOnLoaded(u,t),s=u.data,r?(a=null==c?void 0:c.data,o=null==l?void 0:l.data,a&&this._emitOnLoaded(c,r),o&&this._emitOnLoaded(l,n)):(o=null==c?void 0:c.data)&&this._emitOnLoaded(c,n),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(3),G.network(e.t0);case 21:if(p=this.hls.config.onPreM3U8Parse,e.prev=22,p&&(s=p(s)||s,a=a&&(p(a,!0)||a),o=o&&(p(o,!0)||o)),d=$n.parse(s,t,this._useLowLatency),!1===(null===(p=d)||void 0===p?void 0:p.live)&&d.segments&&!d.segments.length)throw new Error("empty segments list");e.next=27;break;case 27:a&&(h=$n.parse(a,r,this._useLowLatency)),o&&(f=$n.parse(o,n,this._useLowLatency)),e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(22),new G(P,z.HLS,e.t1);case 34:return d&&(d.isMaster?this.hls.emit(En.HLS_MANIFEST_LOADED,{playlist:d}):this.hls.emit(En.HLS_LEVEL_LOADED,{playlist:d})),e.abrupt("return",[d,h,f]);case 36:case"end":return e.stop()}},e,this,[[3,18],[22,31]])})),function(e,t,r){return Zn.apply(this,arguments)})},{key:"parseText",value:function(e,t){var r,n=this.hls.config.onPreM3U8Parse;try{if(n&&(e=n(e)||e),!1===(null===(r=$n.parse(e,t,this._useLowLatency))||void 0===r?void 0:r.live)&&r.segments&&!r.segments.length)throw new Error("empty segments list")}catch(e){throw new G(P,z.HLS,e)}return r&&(r.isMaster?this.hls.emit(En.HLS_MANIFEST_LOADED,{playlist:r}):this.hls.emit(En.HLS_LEVEL_LOADED,{playlist:r})),[r]}},{key:"poll",value:function(r,n,i,s,a,o){var u=this;clearTimeout(this._timer),o=o||3e3;var e,c=this.hls.config.pollRetryCount,l=(e=C(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(u._timer),e.prev=1,e.next=4,u.load(r,n,i);case 4:if((t=e.sent)[0]){e.next=7;break}return e.abrupt("return");case 7:c=u.hls.config.pollRetryCount,s(t[0],t[1],t[2]),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),--c<=0&&a(e.t0);case 15:u._timer=setTimeout(l,o);case 16:case"end":return e.stop()}},e,null,[[1,11]])})),function(){return e.apply(this,arguments)});this._timer=setTimeout(l,o)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),ti);function ti(e){var a=this;_(this,ti),k(this,"_emitOnLoaded",function(e,t){var r=e.response,n=e.options||{},i=n.firstByteTime,s=n.startTime,e=n.endTime,n=n.contentLength,e=e-s;a.hls.emit(ke.SPEED,{time:e,byteLength:n,url:t}),a.hls.emit(ke.LOAD_COMPLETE,{url:t,elapsed:e||0}),a.hls.emit(ke.TTFB,{url:t,responseUrl:r.url,elapsed:i-s}),a.hls.emit(ke.LOAD_RESPONSE_HEADERS,{headers:r.headers,url:t})}),k(this,"_onLoaderRetry",function(e,t){a.hls.emit(En.LOAD_RETRY,{error:G.network(e),retryTime:t})}),this.hls=e,this._timer=null,this._useLowLatency=e.config.useLowLatency;var t=this.hls.config,r=t.retryCount,n=t.retryDelay,e=t.loadTimeout,t=t.fetchOptions;this._loader=new Pe(m(m({},t),{},{responseType:"text",retry:r,retryDelay:n,timeout:e,onRetryError:this._onLoaderRetry})),this._audioLoader=new Pe(m(m({},t),{},{responseType:"text",retry:r,retryDelay:n,timeout:e,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new Pe(m(m({},t),{},{responseType:"text",retry:r,retryDelay:n,timeout:e,onRetryError:this._onLoaderRetry}))}function ri(){_(this,ri)}function ni(e,t,r){return r<t&&(r=t),Math.min(Math.max(e,t),r)}var ii,si,ai=new W("playlist"),oi=(g(pi,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var e;return this.targetDuration||(null===(e=this.segments[0])||void 0===e?void 0:e.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var e;return(null===(e=this.lastSegment)||void 0===e?void 0:e.end)||0}},{key:"currentSubtitleEndSn",get:function(){var e;return(null===(e=this.currentSubtitleStream)||void 0===e?void 0:e.endSN)||0}},{key:"clearOldSegment",value:function(e,t){return this.currentAudioStream&&this._clearSegments(e,t),this._clearSegments(e,t)}},{key:"getAudioSegment",value:function(e){if(e&&this.currentAudioStream){var t=e.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===t})}}},{key:"update",value:function(e,t){this.url=e.url,Array.isArray(e.segments)?(null!==this.live&&void 0!==this.live||(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,this.lowLatency=e.lowLatency,this.canBlockReload=e.canBlockReload,this.canSkipDateRanges=e.canSkipDateRanges,this.canSkipUntil=e.canSkipUntil,this.partHoldBack=e.partHoldBack,this.partTargetDuration=e.partTargetDuration,this.skippedSegments=e.skippedSegments,this.endPartIndex=e.endPartIndex,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(null===this.snDiff||void 0===this.snDiff)&&e.segments.length&&t.segments.length&&(this.snDiff=e.segments[0].sn-t.segments[0].sn))):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,this.subtitleStreams=e.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(e){var t=this;if(e&&this.currentSubtitleStream&&Array.isArray(e.segments)){var r=this._updateSegments(e,this.currentSubtitleStream),e=this.currentSubtitleStream.segments;if(100<e.length&&(this.currentSubtitleStream.segments=e.slice(100)),r)return r.map(function(e){return{sn:e.sn,url:e.url,duration:e.duration,start:e.start,end:e.end,lang:t.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(t){var e=this.subtitleStreams.find(function(e){return e.lang===t}),r=this.currentSubtitleStream;e&&(this.currentSubtitleStream=e,r.segments=[])}},{key:"_setLLPlaybackPoint",value:function(e){if(!e.lowLatency||!e.segments.length)return e;for(var t=e.totalDuration-e.partHoldBack,r=e.segments,n=0,i=0,s=r.length;i<s;i++)r[i].start<=t&&r[i].independent&&(n=i);var a=r.slice(n),o=0;return a.forEach(function(e){e.start=o,o=e.end}),e.segments=a,e.totalDuration=o,e.startSN=a[0].sn,e.startCC=a[0].cc,ai.log("set ll-hls playback point: SN=".concat(e.startSN," partIndex=").concat(a[0].partIndex,", duration=").concat(o)),e}},{key:"_clearSegments",value:function(e,t){for(var r=0,n=this.segments,i=0,s=n.length;i<s;i++)if(n[i].end>=e){r=i;break}return(r=t<r?t:r)&&(this.segments=this.segments.slice(r),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(r))),t-r}},{key:"_updateSegments",value:function(e,t){var r=t.segments;if(this.live){var n=e.lowLatency,i=r[r.length-1],s=(null==i?void 0:i.sn)||-1,a=(null==i?void 0:i.partIndex)||0,o=s<e.endSN&&e.segments.length;if(o=n?o||a<e.endPartIndex:o){ai.log("update segments: endSN:".concat(s,", partIndex:").concat(a," --\x3e endSN:").concat(e.endSN,", partIndex:").concat(e.endPartIndex));var u,c,n=e.segments.findIndex(function(e){return e.sn===s&&e.partIndex===a}),o=n<0?e.segments:e.segments.slice(n+1);return r.length&&o.length&&(n=u=i.end,o.forEach(function(e){e.start=u,u=e.end}),ai.log("liveEdge: ".concat(n," -> ").concat(u)),(c=(null==i?void 0:i.cc)||-1)>o[0].cc&&o.forEach(function(e){return e.cc+=c})),t.endSN=e.endSN,t.segments=r.concat(o),o}}else t.segments=e.segments}}]),pi),ui=(g(fi,[{key:"lowLatency",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lowLatency}},{key:"lastSegment",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lastSegment}},{key:"currentSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer]}},{key:"nextSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.segments}},{key:"currentSubtitleEndSn",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.liveEdge}},{key:"totalDuration",get:function(){var e;return(null===(e=this.currentStream)||void 0===e?void 0:e.totalDuration)||0}},{key:"seekRange",get:function(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}},{key:"nbSegments",get:function(){var e;return(null===(e=this.currentSegments)||void 0===e?void 0:e.length)||0}},{key:"isEmpty",get:function(){var e;return!(null!==(e=this.currentSegments)&&void 0!==e&&e.length)}},{key:"isLive",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.live}},{key:"hadSegmentLoaded",get:function(){return-1!==this._segmentPointer}},{key:"hasSubtitle",get:function(){var e;return!(null===(e=this.currentStream)||void 0===e||!e.currentSubtitleStream)}},{key:"getAudioSegment",value:function(e){var t;return null===(t=this.currentStream)||void 0===t?void 0:t.getAudioSegment(e)}},{key:"moveSegmentPointer",value:function(e){null==e&&(e=this._segmentPointer+1),this._segmentPointer=ni(e,-1,null===(e=this.currentSegments)||void 0===e?void 0:e.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(e){var t;return null===(t=this.currentSegments)||void 0===t?void 0:t[e]}},{key:"setNextSegmentByIndex",value:function(){this._segmentPointer=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:0)-1}},{key:"findSegmentIndexByTime",value:function(e){var t=this.currentSegments;if(t){for(var r,n=0,i=t.length;n<i;n++)if(e>=(r=t[n]).start&&e<r.end)return n;var s=t[t.length-1];if(Math.abs(e-(null==s?void 0:s.end))<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(e,t,r){var n,i=this;e&&(e.isMaster?(this.streams.length=e.streams.length,e.streams.filter(function(e){return e.url}).forEach(function(e,t){i.streams[t]?i.streams[t].update(e):i.streams[t]=new oi(e)}),this.currentStream=this.streams[0]):Array.isArray(e.segments)&&((n=this.currentStream)?(n.update(e,t,r),(n=n.updateSubtitle(r))&&this.hls.emit(En.SUBTITLE_SEGMENTS,{list:n})):(this.reset(),this.currentStream=this.streams[0]=new oi(e,t,r))),this.currentStream&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(e,t){return e+t.duration},0)))}},{key:"switchSubtitle",value:function(e){var t;null===(t=this.currentStream)||void 0===t||t.switchSubtitle(e)}},{key:"clearOldSegment",value:function(){var e,t=this.currentStream;this.dvrWindow&&t&&((e=t.endTime-this.dvrWindow)<=0||t.segments.length<=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:50)||(this._segmentPointer=t.clearOldSegment(e,this._segmentPointer)))}},{key:"checkSegmentTrackChange",value:function(e,t){var r=this.findSegmentIndexByTime(e),n=this.getSegmentByIndex(r);if(n&&(n.hasAudio||n.hasVideo)){if(2!==t&&n.hasAudio&&n.hasVideo)return n;if(!(.3<n.end-e)){r=this.getSegmentByIndex(r+1);if(r&&(r.hasAudio||r.hasVideo))return r.hasAudio!==n.hasAudio||r.hasVideo!==n.hasVideo?r:void 0}}}}]),fi),ci=(g(hi,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:r,i=[];return e&&(i[0]=this.loadVideoSegment(e,r)),t&&(i[1]=this.loadAudioSegment(t,n)),Promise.all(i)}},{key:"loadVideoSegment",value:function(e,t){return this._loadSegment(this._segmentLoader,e,t)}},{key:"loadAudioSegment",value:function(e,t){return this._loadSegment(this._audioSegmentLoader,e,t)}},{key:"_loadSegment",value:(si=C(A().mark(function e(t,r,n){var i,s,a,o,u,c,l,d,h,f,p,v,m=this;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=[],this.hls.emit(ke.LOAD_START,{url:r.url}),c[0]=t.load(r.url),n&&r.initSegment&&(d=r.initSegment.url,(i=this._mapCache[d])||(this.hls.emit(ke.LOAD_START,{url:d}),c[1]=t.load(d).then(function(e){e&&(30<Object.keys(m._mapCache)&&(m._mapCache={}),i=m._mapCache[d]=e.data,m._emitOnLoaded(e,d))})),(h=null===(l=r.initSegment.key)||void 0===l?void 0:l.url)&&(u=r.initSegment.key.iv,(o=this._keyCache[h])||(this.hls.emit(ke.LOAD_START,{url:h}),c[2]=this._keyLoader.load(h).then(function(e){e&&(o=m._keyCache[h]=e.data,m._emitOnLoaded(e,h))})))),(f=null===(l=r.key)||void 0===l?void 0:l.url)&&(a=r.key.iv,(s=this._keyCache[f])||(this.hls.emit(ke.LOAD_START,{url:f}),c[3]=this._keyLoader.load(f).then(function(e){e&&(s=m._keyCache[f]=e.data,m._emitOnLoaded(e,f))}))),e.next=8,Promise.all(c);case 8:if(p=e.sent,v=T(p,1),p=v[0]){e.next=13;break}return e.abrupt("return");case 13:return v=p.data,this._emitOnLoaded(p,r.url),e.abrupt("return",{data:v,map:i,key:s,mapKey:o,keyIv:a,mapKeyIv:u});case 16:case"end":return e.stop()}},e,this)})),function(e,t,r){return si.apply(this,arguments)})},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:(ii=C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return e.stop()}},e,this)})),function(){return ii.apply(this,arguments)})}]),hi),li=new W("hls"),di=function(){b(v,Ae);var e,t,r,n,i,s,a,o,u,c,l,d,h,f,p=E(v);function v(e){var o,t,r;return _(this,v),k(S(o=p.call(this)),"version",v.version),k(S(o),"media",null),k(S(o),"config",null),k(S(o),"_manifestLoader",null),k(S(o),"_segmentLoader",null),k(S(o),"_playlist",null),k(S(o),"_bufferService",null),k(S(o),"_gapService",null),k(S(o),"_seiService",null),k(S(o),"_stats",null),k(S(o),"_prevSegSn",null),k(S(o),"_prevSegCc",null),k(S(o),"_tickTimer",null),k(S(o),"_tickInterval",500),k(S(o),"_segmentProcessing",!1),k(S(o),"_reloadOnPlay",!1),k(S(o),"_switchUrlOpts",null),k(S(o),"_isProcessQuotaExceeded",!1),k(S(o),"_loadSegment",C(A().mark(function e(){var t,r,n;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o._segmentProcessing||!o.media)return e.abrupt("return");e.next=2;break;case 2:if(t=o._playlist.nextSegment){e.next=5;break}return e.abrupt("return");case 5:if(o.isLive){e.next=13;break}if(r=o.bufferInfo(),o.media.paused&&!o.media.currentTime&&(r=o.bufferInfo(r.nextStart||.5)),n=Math.abs(r.end-o.media.duration)<.1,r.remaining>=o.config.preloadTime||n)return n&&o._bufferService.msIsOpend&&o._bufferService.endOfStream(),e.abrupt("return");e.next=12;break;case 12:!o._urlSwitching&&o._prevSegSn!==t.sn-1&&r.end&&1<Math.abs(t.start-r.end)&&o._playlist.setNextSegmentByIndex(o._playlist.findSegmentIndexByTime(r.end+.1));case 13:return e.abrupt("return",o._loadSegmentDirect());case 14:case"end":return e.stop()}},e)}))),k(S(o),"_onPlay",C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.media.seeking&&0===o.media.currentTime)return li.debug("replay currentTime 0, return"),e.abrupt("return");e.next=3;break;case 3:if(clearTimeout(o._disconnectTimer),!o._reloadOnPlay){e.next=9;break}o._reloadOnPlay=!1,o.replay(!0),e.next=12;break;case 9:return e.next=11,o._loadSegment();case 11:o._startTick();case 12:case"end":return e.stop()}},e)}))),k(S(o),"_onPause",function(){var e;o.isLive?o._reloadOnPlay||(null==(e=o.config.disconnectTime)&&(e=o._playlist.dvrWindow),Number.isFinite(e)&&(clearTimeout(o._disconnectTimer),o._disconnectTimer=setTimeout(function(){o._reloadOnPlay=!0,o._clear()},e||0))):o._stopTick()}),k(S(o),"_onSeeking",C(A().mark(function e(){var t,r,n,i,s,a;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.media){e.next=2;break}return e.abrupt("return");case 2:if(t=o.media.currentTime,!(r=o._playlist.seekRange)){e.next=9;break}if(0<=(n=ni(t,r[0],o.isLive?r[1]:o.media.duration))&&.1<=Math.abs(t-n))return o.media.currentTime=n,e.abrupt("return");e.next=9;break;case 9:if(n=o._playlist.currentSegment,i=I.info(I.get(o.media),t,.1),!n){e.next=14;break}if(i.end&&Math.abs(i.end-n.end)<.2)return e.abrupt("return");e.next=14;break;case 14:if(s=o._playlist.findSegmentIndexByTime(t),a=o._playlist.getSegmentByIndex(s),null==s||!a||o._segmentProcessing&&a===o._playlist.nextSegment)return e.abrupt("return");e.next=18;break;case 18:return li.debug("seek to",t,a),o._playlist.setNextSegmentByIndex(s),o._stopTick(),e.next=23,o._segmentLoader.cancel();case 23:if(o._segmentProcessing=!1,!i.end||o.isLive)return e.next=27,o._loadSegmentDirect(!0);e.next=27;break;case 27:o._startTick();case 28:case"end":return e.stop()}},e)}))),k(S(o),"_onTimeupdate",function(){if(o.media){var e=o.config;if(e.isLive&&e.maxLatency&&e.targetLatency&&o.media){var t=o._playlist.liveEdge;if(!t)return;var r=t-o.media.currentTime;r>=e.maxLatency&&(li.debug("latency jump, currentTime:".concat(o.media.currentTime,", liveEdge:").concat(t,",  latency=").concat(r)),o.media.currentTime=t-e.targetLatency)}e.seiInTime&&(null===(e=o._seiService)||void 0===e||e.throw(o.media.currentTime)),o.config.allowedStreamTrackChange&&!o.config.softDecode&&o._checkStreamTrackChange(o.media.currentTime)}}),k(S(o),"_tick",function(){var e,t,r;o.media&&(o._startTick(),e=o.media,t=I.get(e),r=o._segmentLoader.error,o._onCheckQuotaExceeded(),o._isProcessQuotaExceeded&&(o._bufferService.isFull()||(o._isProcessQuotaExceeded=!1,o._segmentProcessing=!1)),r?(!e.readyState||o.bufferInfo(.5).remaining<1)&&(r.fatal=!0,o._emitError(G.network(r))):I.end(t)<.1||!e.readyState||(!e||e.paused||e.ended||0===e.playbackRate||0===e.readyState?e.readyState<2&&o._gapService&&o._gapService.do(e,o.config.maxJumpDistance,!e.currentTime||o.isLive):(o._loadSegment(),o._gapService&&o._gapService.do(e,o.config.maxJumpDistance,o.isLive))))}),o.config=(r=(null==(t=e)?void 0:t.media)||document.createElement("video"),e=m(m({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3},t),{},{media:r})),o.media=o.config.media,o._manifestLoader=new ei(S(o)),o._segmentLoader=new ci(S(o)),o._playlist=new ui(S(o)),o._bufferService=new Dn(S(o)),e.seiInTime&&(o._seiService=new Ue(S(o))),e.softDecode||(o._gapService=new Be),o._stats=new Fe(S(o),9e4),o.media.addEventListener("play",o._onPlay),o.media.addEventListener("pause",o._onPause),o.media.addEventListener("seeking",o._onSeeking),o.media.addEventListener("timeupdate",o._onTimeupdate),o}return g(v,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.1;return I.info(I.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return function(e){if(!e)return{};if("function"!=typeof e.getVideoPlaybackQuality)return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()};e=e.getVideoPlaybackQuality();return{droppedVideoFrames:e.droppedVideoFrames||e.corruptedVideoFrames,totalVideoFrames:e.totalVideoFrames,creationTime:e.creationTime}}(this.media)}},{key:"load",value:(f=C(A().mark(function e(t){var r,n=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1<n.length&&void 0!==n[1]&&n[1],t&&(this.config.url=t),t=this.config.url,e.next=5,this._reset(r);case 5:return e.next=7,this._loadData(t);case 7:this._startTick();case 8:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"_loadData",value:(h=C(A().mark(function e(t){var r,n,i,s,a;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{t=t&&t.trim()}catch(e){}if(t){e.next=3;break}throw this._emitError(new G(V,z.OPTION,null,null,"m3u8 url is missing"));case 3:return e.next=5,this._loadM3U8(t);case 5:if(r=e.sent,n=this._playlist.currentStream,!this._urlSwitching){e.next=17;break}if(0===n.bitrate&&null!==(i=this._switchUrlOpts)&&void 0!==i&&i.bitrate&&(n.bitrate=null===(s=this._switchUrlOpts)||void 0===s?void 0:s.bitrate),s=this._getSeamlessSwitchPoint(),this.config.startTime=s,s=this._playlist.findSegmentIndexByTime(s),s=this._playlist.getSegmentByIndex(s+1))return a=s.start,e.next=17,this._bufferService.removeBuffer(a);e.next=17;break;case 17:if(r){e.next=19;break}return e.abrupt("return");case 19:if(!this.isLive){e.next=30;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),li.log("totalDuration first time got:",this._playlist.totalDuration),li.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),r.isMaster||this._pollM3U8(t),this._playlist.nbSegments<this.config.minSegmentsStartPlay)return e.abrupt("return");e.next=27;break;case 27:return e.next=29,this._loadSegment();case 29:return e.abrupt("return");case 30:return e.next=32,this._bufferService.updateDuration(n.totalDuration);case 32:return(s=this.config.startTime)&&(null!==(a=this._switchUrlOpts)&&void 0!==a&&a.seamless||(this.media.currentTime=s),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(s)||0)),e.next=36,this._loadSegment();case 36:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"replay",value:(d=C(A().mark(function e(t){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.config.startTime=0,e.next=3,this.load();case 3:return this._reloadOnPlay=!1,e.abrupt("return",this.media.play(!t));case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"switchURL",value:(l=C(A().mark(function e(t){var r,n,i,s,a,o,u=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=1<u.length&&void 0!==u[1]?u[1]:{},n={seamless:!1,startTime:0,bitrate:0},e.t0=y(r),e.next="number"===e.t0?5:"boolean"===e.t0?7:"object"===e.t0?9:11;break;case 5:return r={startTime:r},e.abrupt("break",12);case 7:return r={seamless:r},e.abrupt("break",12);case 9:for(i in r)void 0!==r[i]&&null!==r[i]||delete r[i];return e.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(r);case 12:if(r=Object.assign({},n,r),s=r.seamless,a=r.startTime,this.config.url=t,this.config.startTime=a,this._switchUrlOpts=r,s){e.next=38;break}if(e.prev=18,!this.config.softDecode){e.next=23;break}e.t1=this.load(t),e.next=26;break;case 23:return e.next=25,this.load(t);case 25:e.t1=e.sent;case 26:o=e.t1,e.next=33;break;case 29:throw e.prev=29,e.t2=e.catch(18),this.emit(En.SWITCH_URL_FAILED,e.t2),e.t2;case 33:return this._reloadOnPlay=!1,o&&this.emit(En.SWITCH_URL_SUCCESS,{url:t}),e.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._bufferService.seamlessSwitch(),e.next=45,this._clear();case 45:return e.next=47,this._loadData(t);case 47:this._startTick();case 48:this._switchUrlOpts=null;case 49:case"end":return e.stop()}},e,this,[[18,29]])})),function(e){return l.apply(this,arguments)})},{key:"switchStream",value:(c=C(A().mark(function e(t){var r,n,i,s,a,o=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(1<o.length&&void 0!==o[1])||o[1],n=this.currentStream,i=this.streams,!n||n.id===t||!i||i.length<2)return e.abrupt("return");e.next=5;break;case 5:if(s=i.find(function(e){return e.id===t})){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,this._clear();case 11:if(r)return e.next=14,this._bufferService.clearAllBuffer();e.next=14;break;case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(8),this._emitError(G.create(e.t0));case 19:if(n.currentAudioStream&&2<s.audioStreams.length&&(a=n.currentAudioStream.id,s.currentAudioStream=s.audioStreams.find(function(e){return e.id===a})||s.currentAudioStream),this._playlist.currentStream=s,e.prev=21,this.isLive||!s.segments.length)return e.next=25,this._refreshM3U8();e.next=25;break;case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=29,this._loadSegmentDirect();case 29:e.next=35;break;case 31:throw e.prev=31,e.t1=e.catch(21),this._playlist.currentStream=n,e.t1;case 35:return this._startTick(),e.abrupt("return",s);case 37:case"end":return e.stop()}},e,this,[[8,16],[21,31]])})),function(e){return c.apply(this,arguments)})},{key:"switchAudioStream",value:(u=C(A().mark(function e(t){var r,n,i,s,a=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(1<a.length&&void 0!==a[1])||a[1],n=this.currentStream){e.next=4;break}return e.abrupt("return");case 4:if(!(i=n.currentAudioStream)||i.id===t||n.audioStreams.length<2)return e.abrupt("return");e.next=7;break;case 7:if(s=n.audioStreams.find(function(e){return e.id===t})){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,this._clear();case 13:if(r)return e.next=16,this._bufferService.clearAllBuffer();e.next=16;break;case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(10),this._emitError(G.create(e.t0));case 21:if(n.currentAudioStream=s,e.prev=22,this.isLive||!s.segments.length)return e.next=26,this._refreshM3U8();e.next=26;break;case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=30,this._loadSegmentDirect();case 30:e.next=36;break;case 32:throw e.prev=32,e.t1=e.catch(22),n.currentAudioStream=i,e.t1;case 36:return this._startTick(),e.abrupt("return",s);case 38:case"end":return e.stop()}},e,this,[[10,18],[22,32]])})),function(e){return u.apply(this,arguments)})},{key:"switchSubtitleStream",value:(o=C(A().mark(function e(t){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._playlist.switchSubtitle(t),e.next=3,this._manifestLoader.stopPoll();case 3:return e.next=5,this._refreshM3U8();case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"destroy",value:(a=C(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),null===(t=this._seiService)||void 0===t||t.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"_loadM3U8",value:(s=C(A().mark(function e(t){var r,n,i,s;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(n=null===(n=this.config.manifestList)||void 0===n||null===(r=n.filter(function(e){return e.url===t})[0])||void 0===r?void 0:r.manifest)){e.next=6;break}e.t0=this._manifestLoader.parseText(n,t),e.next=9;break;case 6:return e.next=8,this._manifestLoader.load(t);case 8:e.t0=e.sent;case 9:i=e.t0,s=T(i,1),i=s[0],e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(0),this._emitError(G.create(e.t1));case 17:if(i){e.next=19;break}return e.abrupt("return");case 19:if(this._playlist.upsertPlaylist(i),i.isMaster)return null!==(s=this._playlist.currentStream.subtitleStreams)&&void 0!==s&&s.length&&this.emit(En.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),e.next=24,this._refreshM3U8();e.next=24;break;case 24:return this.emit(En.STREAM_PARSED),e.abrupt("return",i);case 26:case"end":return e.stop()}},e,this,[[0,14]])})),function(e){return s.apply(this,arguments)})},{key:"_refreshM3U8",value:function(){var e,n=this,t=this._playlist.currentStream;if(!t||!t.url)throw this._emitError(G.create(null,null,new Error("m3u8 url is not defined")));var i=t.url,s=null===(e=t.currentAudioStream)||void 0===e?void 0:e.url,a=null===(t=t.currentSubtitleStream)||void 0===t?void 0:t.url;return this._manifestLoader.load(i,s,a).then(function(e){var t=T(e,3),r=t[0],e=t[1],t=t[2];r&&(n._playlist.upsertPlaylist(r,e,t),n.isLive&&n._pollM3U8(i,s,a))}).catch(function(e){throw n._emitError(G.create(e))})}},{key:"_pollM3U8",value:function(e,t,r){var n=this,i=this._playlist.isEmpty,s=this._playlist.lowLatency?1e3*(2*this._playlist.currentStream.partTargetDuration||0):1e3*((null===(s=this._playlist.lastSegment)||void 0===s?void 0:s.duration)||0);this._manifestLoader.poll(e,t,r,function(e,t,r){n._playlist.upsertPlaylist(e,t,r),n._playlist.clearOldSegment(),(e&&i&&!n._playlist.isEmpty||!n._playlist.hadSegmentLoaded&&n._playlist.nbSegments>=n.config.minSegmentsStartPlay)&&n._loadSegment(),i=i&&n._playlist.isEmpty},function(e){n._emitError(G.create(e))},s)}},{key:"_loadSegmentDirect",value:(i=C(A().mark(function e(t){var r,n,i;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._playlist.nextSegment){e.next=3;break}return e.abrupt("return");case 3:return n=!1,i=null,e.prev=5,this._segmentProcessing=!0,li.log("load segment, sn:".concat(r.sn,", partIndex:").concat(r.partIndex)),e.next=10,this._reqAndBufferSegment(r,this._playlist.getAudioSegment(r));case 10:n=e.sent,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),i=e.t0;case 16:return e.prev=16,this._segmentProcessing=!1,e.finish(16);case 19:if(!i){e.next=26;break}if(this._bufferService.isFull())return li.log("load segment, sn:".concat(r.sn,", partIndex:").concat(r.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,e.abrupt("return",!1);e.next=25;break;case 25:return e.abrupt("return",this._emitError(G.create(i)));case 26:return n&&(this._urlSwitching&&(this._urlSwitching=!1,this.emit(En.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),r.isLast?this._end():t||this._loadSegment()),e.abrupt("return",n);case 28:case"end":return e.stop()}},e,this,[[5,13,16,19]])})),function(e){return i.apply(this,arguments)})},{key:"_reqAndBufferSegment",value:(n=C(A().mark(function e(t,r){var n,i,s,a,o,u,c;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t||r).cc,i=this._prevSegCc!==n,s=[],e.prev=3,e.next=6,this._segmentLoader.load(t,r,i);case 6:s=e.sent,e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(3),e.t0.fatal=!1,this._segmentLoader.error=e.t0,e.t0;case 14:if(s[0]){e.next=16;break}return e.abrupt("return");case 16:return e.next=18,(u=this._bufferService).decryptBuffer.apply(u,w(s));case 18:if(a=e.sent){e.next=21;break}return e.abrupt("return");case 21:return o=(t||r).sn,u=(t||r).start,c=this._playlist.currentStream,this._bufferService.createSource(a[0],a[1],null==c?void 0:c.videoCodec,null==c?void 0:c.audioCodec),c=Date.now(),e.next=28,this._bufferService.appendBuffer(t,r,a[0],a[1],i,this._prevSegSn===o-1,u);case 28:return this.emit(En.APPEND_COST,{elapsed:Date.now()-c,url:t.url}),e.next=31,this._bufferService.evictBuffer(this.config.bufferBehind);case 31:return this._prevSegCc=n,this._prevSegSn=o,e.abrupt("return",!0);case 34:case"end":return e.stop()}},e,this,[[3,9]])})),function(e,t){return n.apply(this,arguments)})},{key:"_onCheckQuotaExceeded",value:(r=C(A().mark(function e(){var t,r,n,i,s;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.media.currentTime,r=this.media.buffered,n=!1,i=0;case 4:if(!(i<r.length)){e.next=11;break}if(r.start(0)>=t&&t<r.end(i))return n=!0,e.abrupt("break",11);e.next=8;break;case 8:i++,e.next=4;break;case 11:if(this._bufferService.isFull())return s=n?this.config.bufferBehind:5,e.next=15,this._bufferService.evictBuffer(s);e.next=15;break;case 15:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_checkStreamTrackChange",value:function(e){e=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);e&&this.switchURL(this.config.url,e.start+.2)}},{key:"_clear",value:(t=C(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),e.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_reset",value:(e=C(A().mark(function e(){var t,r,n=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0<n.length&&void 0!==n[0]&&n[0],this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),null===(t=this._seiService)||void 0===t||t.reset(),this._stats.reset(),e.next=11,this._clear();case 11:return e.abrupt("return",this._bufferService.reset(r));case 12:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||1<this.media.buffered.length)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!1===(null===(t=e.originError)||void 0===t?void 0:t.fatal)?li.warn(e):(li.table(e),li.error(e),li.error(null===(t=this.media)||void 0===t?void 0:t.error),null!==(t=this.media)&&void 0!==t&&t.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(En.SWITCH_URL_FAILED,e)),this.emit(En.ERROR,e),r&&this._end(),null===(r=this._seiService)||void 0===r||r.reset()),e}},{key:"_getSeamlessSwitchPoint",value:function(){var e,t=this.media,r=t.currentTime;return t.paused||(e=this._playlist.findSegmentIndexByTime(t.currentTime),t=this._playlist.getSegmentByIndex(e),r+=(e=null===(e=this._stats)||void 0===e?void 0:e.getStats().downloadSpeed)&&t?t.duration*this._playlist.currentStream.bitrate/e+1:5),r}}],[{key:"isSupported",value:function(e){return e&&"video"!==e&&"audio"!==e?"undefined"!=typeof WebAssembly:ie.isSupported()}},{key:"enableLogger",value:function(){W.enable(),ut.enable()}},{key:"disableLogger",value:function(){W.disable(),ut.disable()}}]),v}();function hi(e){var o=this;_(this,hi),k(this,"error",null),k(this,"_emitOnLoaded",function(e,t){var r=e.data,n=e.response,i=e.options||{},s=i.firstByteTime,a=i.startTime,e=i.endTime,i=i.contentLength,e=e-a;o._bandwidthService.addRecord(i||r.byteLength,e),o.hls.emit(ke.SPEED,{time:e,byteLength:i,url:t}),o.hls.emit(ke.LOAD_COMPLETE,{url:t,elapsed:e||0}),o.hls.emit(ke.TTFB,{url:t,responseUrl:n.url,elapsed:s-a}),o.hls.emit(ke.LOAD_RESPONSE_HEADERS,{headers:n.headers,url:t})}),k(this,"_onLoaderRetry",function(e,t){o.hls.emit(ke.LOAD_RETRY,{error:G.network(e),retryTime:t})}),this.hls=e,this._bandwidthService=new Me,this._mapCache={},this._keyCache={};var t=this.hls.config,r=t.retryCount,n=t.retryDelay,e=t.loadTimeout,t=t.fetchOptions;this._segmentLoader=new Pe(m(m({},t),{},{responseType:"arraybuffer",retry:r,retryDelay:n,timeout:e,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new Pe(m(m({},t),{},{responseType:"arraybuffer",retry:r,retryDelay:n,timeout:e,onRetryError:this._onLoaderRetry})),this._keyLoader=new Pe(m(m({},t),{},{responseType:"arraybuffer",retry:r,retryDelay:n,timeout:e,onRetryError:this._onLoaderRetry}))}function fi(e){_(this,fi),k(this,"streams",[]),k(this,"currentStream",null),k(this,"dvrWindow",0),k(this,"_segmentPointer",-1),this.hls=e}function pi(e,t,r){_(this,pi),k(this,"live",void 0),k(this,"id",0),k(this,"bitrate",0),k(this,"width",0),k(this,"height",0),k(this,"name",""),k(this,"url",""),k(this,"audioCodec",""),k(this,"videoCodec",""),k(this,"textCodec",""),k(this,"startCC",0),k(this,"endCC",0),k(this,"startSN",0),k(this,"endSN",-1),k(this,"totalDuration",0),k(this,"targetDuration",0),k(this,"partTargetDuration",0),k(this,"canSkipUntil",0),k(this,"canSkipDateRanges",!1),k(this,"skippedSegments",0),k(this,"canBlockReload",!1),k(this,"partHoldBack",0),k(this,"lowLatency",!1),k(this,"endPartIndex",0),k(this,"snDiff",null),k(this,"segments",[]),k(this,"audioStreams",[]),k(this,"subtitleStreams",[]),k(this,"closedCaptions",[]),k(this,"currentAudioStream",null),k(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(e),t,r)}k(di,"version","3.0.10");try{localStorage.getItem("xgd")?di.enableLogger():di.disableLogger()}catch(e){}var vi=(g(mi,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,e=e.isLive;t&&(e||!t.setPlayMode?(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),this._bindEvents()):t.setPlayMode("VOD"))}},{key:"_bindEvents",value:function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),mi);function mi(e,t){var s=this;_(this,mi),k(this,"_opts",null),k(this,"_plugin",null),k(this,"_onLowDecode",function(){var e,t,r=s._opts,n=r.media,i=r.innerDegrade;null===(r=s._plugin)||void 0===r||null===(e=r.player)||void 0===e||e.emit("lowdecode",n.degradeInfo),null===(e=s._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("core_event",m(m({},n.degradeInfo),{},{eventName:En.LOWDECODE})),1===i&&s._degrade(n.src)}),k(this,"_degrade",function(e){var t,r=s._plugin.player,n=r.video;n&&"MVideo"!==n.TAG||(t=r.video.degradeVideo,r.video=t,n.degrade(e),e&&(r.config.url=e),"MVideo"===(e=r.root.firstChild).TAG&&r.root.replaceChild(t,e),e=s._plugin.constructor.pluginName.toLowerCase(),r.unRegisterPlugin(e),r.once("canplay",function(){r.play()}))}),k(this,"forceDegradeToVideo",function(e){1===s._opts.innerDegrade&&s._degrade(e)}),this._opts=e,this._plugin=t,this._init()}be=function(){b(i,o.BasePlugin);var n=E(i);function i(){var a;_(this,i);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return k(S(a=n.call.apply(n,[this].concat(t))),"hls",null),k(S(a),"pluginExtension",null),k(S(a),"getStats",function(){var e;return null===(e=a.hls)||void 0===e?void 0:e.getStats()}),k(S(a),"_onSwitchSubtitle",function(e){var t=e.lang;null===(e=a.hls)||void 0===e||e.switchSubtitleStream(t)}),k(S(a),"_onSwitchURL",function(e,t){var r,n,i=S(a),s=i.player,i=i.hls;i&&(t=function(e,t){var r={startTime:t.player.currentTime};switch(y(e)){case"boolean":r.seamless=e;break;case"object":Object.assign(r,e)}return r}(t,S(a)),s.config.url=e,i.switchURL(e,t).catch(function(e){}),!t.seamless&&null!==(r=a.player.config)&&void 0!==r&&null!==(n=r.hls)&&void 0!==n&&n.keepStatusAfterSwitch&&a._keepPauseStatus())}),k(S(a),"_keepPauseStatus",function(){a.player.paused&&a.player.once("canplay",function(){a.player.pause()})}),a}return g(i,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return null===(e=this.hls)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!t&&"video"!==t&&"audio"!==t}},{key:"beforePlayerInit",value:function(){var e,i=this,t=this.player.config;(t.url||t.__allowHlsEmptyUrl__)&&(this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL,(e=t.hls||{}).innerDegrade=e.innerDegrade||t.innerDegrade,null!==e.disconnectTime&&void 0!==e.disconnectTime||(e.disconnectTime=0),this.hls=new di(m({softDecode:this.softDecode,isLive:t.isLive,media:this.player.media||this.player.video,startTime:t.startTime,url:t.url},e)),this.softDecode||o.BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var e,t;return null===(e=i.hls)||void 0===e||null===(t=e.media)||void 0===t?void 0:t.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new vi(m({isLive:t.isLive,media:this.player.video},e),this),this.player.forceDegradeToVideo=function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return null===(e=i.pluginExtension)||void 0===e?void 0:e.forceDegradeToVideo.apply(e,r)}),t.isLive&&(null===(e=this.player)||void 0===e||e.useHooks("replay",function(){var e;return null===(e=i.hls)||void 0===e?void 0:e.replay()})),this.on(o.Events.SWITCH_SUBTITLE||"switch_subtitle",this._onSwitchSubtitle),this.on(o.Events.URL_CHANGE,this._onSwitchURL),this.on(o.Events.DESTROY,this.destroy.bind(this)),this._transError(),this._transCoreEvent(ke.TTFB),this._transCoreEvent(ke.LOAD_START),this._transCoreEvent(ke.LOAD_RESPONSE_HEADERS),this._transCoreEvent(ke.LOAD_COMPLETE),this._transCoreEvent(ke.LOAD_RETRY),this._transCoreEvent(ke.SOURCEBUFFER_CREATED),this._transCoreEvent(ke.REMOVE_BUFFER),this._transCoreEvent(ke.BUFFEREOS),this._transCoreEvent(ke.KEYFRAME),this._transCoreEvent(ke.METADATA_PARSED),this._transCoreEvent(ke.DEMUXED_TRACK),this._transCoreEvent(ke.SEI),this._transCoreEvent(ke.SEI_IN_TIME),this._transCoreEvent(ke.SPEED),this._transCoreEvent(ke.HLS_MANIFEST_LOADED),this._transCoreEvent(ke.HLS_LEVEL_LOADED),this._transCoreEvent(ke.STREAM_EXCEPTION),this._transCoreEvent(ke.SWITCH_URL_SUCCESS),this._transCoreEvent(ke.SWITCH_URL_FAILED),this._transCoreEvent(En.NO_AUDIO_TRACK),this._transCoreEvent(En.STREAM_PARSED),this._transCoreEvent(En.SUBTITLE_SEGMENTS),this._transCoreEvent(En.SUBTITLE_PLAYLIST),this._transCoreEvent(En.APPEND_COST),t.url&&this.hls.load(t.url,!0).catch(function(e){}))}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),null===(e=this.pluginExtension)||void 0===e||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var t=this;this.hls.on(En.ERROR,function(e){t.player&&t.player.emit(o.Events.ERROR,new o.Errors(t.player,e))})}},{key:"_transCoreEvent",value:function(t){var r=this;this.hls.on(t,function(e){r.player&&(r.player.emit("core_event",m(m({},e),{},{eventName:t})),t===ke.SEI_IN_TIME&&r.hls.hasSubtitle&&r._emitSeiPaylodTime(e))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var t=JSON.parse(Array.from(e.data.payload).map(function(e){return String.fromCharCode(e)}).join("").slice(0,-1));if(!t.rtmp_dts)return;this.player.emit("core_event",{eventName:En.SEI_PAYLOAD_TIME,time:t.rtmp_dts})}catch(e){}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,t){return di.isSupported(e,t)}}]),i}();return k(be,"Hls",di),k(be,"EVENT",En),be});