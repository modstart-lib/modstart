layui.define("form",function(e){"use strict";function i(e){var i=this;i.index=++t.index,i.config=u.extend({},i.config,t.config,e),i.render()}var u=layui.$,n=layui.form,p=layui.layer,a="tree",t={config:{},index:layui[a]?layui[a].index+1e4:0,set:function(e){var i=this;return i.config=u.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,a,e,i)}},l=function(){var i=this,e=i.config,n=e.id||i.index;return l.that[n]=i,{config:l.config[n]=e,reload:function(e){i.reload.call(i,e)},getChecked:function(){return i.getChecked.call(i)},setChecked:function(e){return i.setChecked.call(i,e)}}},y="layui-hide",d="layui-disabled",f="layui-tree-set",v="layui-tree-iconClick",C="layui-icon-addition",k="layui-icon-subtraction",m="layui-tree-entry",x="layui-tree-main",b="layui-tree-txt",g="layui-tree-pack",w="layui-tree-spread",N="layui-tree-setLineShort",T="layui-tree-showLine",L="layui-tree-lineExtend";i.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},i.prototype.reload=function(e){var n=this;layui.each(e,function(e,i){i.constructor===Array&&delete n.config[e]}),n.config=u.extend(!0,{},n.config,e),n.render()},i.prototype.render=function(){var e=this,i=e.config;e.checkids=[];var n=u('<div class="layui-tree'+(i.showCheckbox?" layui-form":"")+(i.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+e.index+'"></div>');e.tree(n);var a=i.elem=u(i.elem);if(a[0]){if(e.key=i.id||e.index,e.elem=n,e.elemNone=u('<div class="layui-tree-emptyText">'+i.text.none+"</div>"),a.html(e.elem),0==e.elem.find(".layui-tree-set").length)return e.elem.append(e.elemNone);i.showCheckbox&&e.renderForm("checkbox"),e.elem.find(".layui-tree-set").each(function(){var e=u(this);e.parent(".layui-tree-pack")[0]||e.addClass("layui-tree-setHide"),!e.next()[0]&&e.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&e.addClass(N),e.next()[0]||e.parents(".layui-tree-set").eq(0).next()[0]||e.addClass(N)}),e.events()}},i.prototype.renderForm=function(e){n.render(e,"LAY-tree-"+this.index)},i.prototype.tree=function(l,e){var r=this,c=r.config,e=e||c.data;layui.each(e,function(e,i){var n=i.children&&0<i.children.length,a=u('<div class="layui-tree-pack" '+(i.spread?'style="display: block;"':"")+"></div>"),t=u(['<div data-id="'+i.id+'" class="layui-tree-set'+(i.spread?" layui-tree-spread":"")+(i.checked?" layui-tree-checkedFirst":"")+'">','<div class="layui-tree-entry">','<div class="layui-tree-main">',c.showLine?n?'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(i.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(n?"":y)+'"></i></span>',c.showCheckbox?'<input type="checkbox" name="'+(i.field||"layuiTreeCheck_"+i.id)+'" same="layuiTreeCheck" lay-skin="primary" '+(i.disabled?"disabled":"")+' value="'+i.id+'">':"",c.isJump&&i.href?'<a href="'+i.href+'" target="_blank" class="'+b+'">'+(i.title||i.label||c.text.defaultNodeName)+"</a>":'<span class="'+b+(i.disabled?" "+d:"")+'">'+(i.title||i.label||c.text.defaultNodeName)+"</span>","</div>",function(){if(!c.edit)return"";var n={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},a=['<div class="layui-btn-group layui-tree-btnGroup">'];return!0===c.edit&&(c.edit=["update","del"]),"object"==typeof c.edit?(layui.each(c.edit,function(e,i){a.push(n[i]||"")}),a.join("")+"</div>"):void 0}(),"</div></div>"].join(""));n&&(t.append(a),r.tree(a,i.children)),l.append(t),t.prev("."+f)[0]&&t.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),n||t.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),r.spread(t,i),c.showCheckbox&&(i.checked&&r.checkids.push(i.id),r.checkClick(t,i)),c.edit&&r.operate(t,i)})},i.prototype.spread=function(a,e){var t=this.config,i=a.children("."+m),n=i.children("."+x),l=i.find("."+v),i=i.find("."+b),r=t.onlyIconControl?l:n,c="";r.on("click",function(e){var i=a.children("."+g),n=(r.children(".layui-icon")[0]?r:r.find(".layui-tree-icon")).children(".layui-icon");i[0]?a.hasClass(w)?(a.removeClass(w),i.slideUp(200),n.removeClass(k).addClass(C)):(a.addClass(w),i.slideDown(200),n.addClass(k).removeClass(C),t.accordion&&((n=a.siblings("."+f)).removeClass(w),n.children("."+g).slideUp(200),n.find(".layui-tree-icon").children(".layui-icon").removeClass(k).addClass(C))):c="normal"}),i.on("click",function(){u(this).hasClass(d)||(c=a.hasClass(w)?t.onlyIconControl?"open":"close":t.onlyIconControl?"close":"open",t.click&&t.click({elem:a,state:c,data:e}))})},i.prototype.setCheckbox=function(e,i,n){var t,l=(this.config,n.prop("checked"));n.prop("disabled")||("object"!=typeof i.children&&!e.find("."+g)[0]||e.find("."+g).find('input[same="layuiTreeCheck"]').each(function(){this.disabled||(this.checked=l)}),(t=function(e){var i,n,a;e.parents("."+f)[0]&&(a=(n=e.parent("."+g)).parent(),e=n.prev().find('input[same="layuiTreeCheck"]'),l?e.prop("checked",l):(n.find('input[same="layuiTreeCheck"]').each(function(){this.checked&&(i=!0)}),i||e.prop("checked",!1)),t(a))})(e),this.renderForm("checkbox"))},i.prototype.checkClick=function(n,a){var t=this,l=t.config;n.children("."+m).children("."+x).on("click",'input[same="layuiTreeCheck"]+',function(e){layui.stope(e);var i=u(this).prev(),e=i.prop("checked");i.prop("disabled")||(t.setCheckbox(n,a,i),l.oncheck&&l.oncheck({elem:n,checked:e,data:a}))})},i.prototype.operate=function(d,l){var s=this,o=s.config,e=d.children("."+m),h=e.children("."+x);e.children(".layui-tree-btnGroup").on("click",".layui-icon",function(e){layui.stope(e);var i,n,a,t=u(this).data("type"),r=d.children("."+g),c={data:l,type:t,elem:d};"add"==t?(r[0]||(o.showLine?(h.find("."+v).addClass("layui-tree-icon"),h.find("."+v).children(".layui-icon").addClass(C).removeClass("layui-icon-file")):h.find(".layui-tree-iconArrow").removeClass(y),d.append('<div class="layui-tree-pack"></div>')),i=o.operate&&o.operate(c),(e={}).title=o.text.defaultNodeName,e.id=i,s.tree(d.children("."+g),[e]),o.showLine&&(r[0]?(r.hasClass(L)||r.addClass(L),d.find("."+g).each(function(){u(this).children("."+f).last().addClass(N)}),(r.children("."+f).last().prev().hasClass(N)?r.children("."+f).last().prev():r.children("."+f).last()).removeClass(N),!d.parent("."+g)[0]&&d.next()[0]&&r.children("."+f).last().removeClass(N)):(i=d.siblings("."+f),n=1,e=d.parent("."+g),layui.each(i,function(e,i){u(i).children("."+g)[0]||(n=0)}),1==n?(i.children("."+g).addClass(T),i.children("."+g).children("."+f).removeClass(N),d.children("."+g).addClass(T),e.removeClass(L),e.children("."+f).last().children("."+g).children("."+f).last().addClass(N)):d.children("."+g).children("."+f).addClass(N))),o.showCheckbox&&(h.find('input[same="layuiTreeCheck"]')[0].checked&&(d.children("."+g).children("."+f).last().find('input[same="layuiTreeCheck"]')[0].checked=!0),s.renderForm("checkbox"))):"update"==t?(t=h.children("."+b).html(),h.children("."+b).html(""),h.append('<input type="text" class="layui-tree-editInput">'),h.children(".layui-tree-editInput").val(t).focus(),a=function(e){var i=(i=e.val().trim())||o.text.defaultNodeName;e.remove(),h.children("."+b).html(i),c.data.title=i,o.operate&&o.operate(c)},h.children(".layui-tree-editInput").blur(function(){a(u(this))}),h.children(".layui-tree-editInput").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),a(u(this)))})):p.confirm('确认删除该节点 "<span style="color: #999;">'+(l.title||"")+'</span>" 吗？',function(e){return o.operate&&o.operate(c),c.status="remove",p.close(e),d.prev("."+f)[0]||d.next("."+f)[0]||d.parent("."+g)[0]?(d.siblings("."+f).children("."+m)[0]?(o.showCheckbox&&(l=function(e){var i,n,a,t;e.parents("."+f)[0]&&(i=e.siblings("."+f).children("."+m),e=(n=e.parent("."+g).prev()).find('input[same="layuiTreeCheck"]')[0],a=1,(t=0)==e.checked&&(i.each(function(e,i){i=u(i).find('input[same="layuiTreeCheck"]')[0];0!=i.checked||i.disabled||(a=0),i.disabled||(t=1)}),1==a&&1==t&&(e.checked=!0,s.renderForm("checkbox"),l(n.parent("."+f)))))})(d),o.showLine&&(i=d.siblings("."+f),n=1,a=d.parent("."+g),layui.each(i,function(e,i){u(i).children("."+g)[0]||(n=0)}),1==n?(r[0]||(a.removeClass(L),i.children("."+g).addClass(T),i.children("."+g).children("."+f).removeClass(N)),(d.next()[0]?a.children("."+f).last():d.prev()).children("."+g).children("."+f).last().addClass(N),d.next()[0]||d.parents("."+f)[1]||d.parents("."+f).eq(0).next()[0]||d.prev("."+f).addClass(N)):!d.next()[0]&&d.hasClass(N)&&d.prev().addClass(N))):(i=d.parent("."+g).prev(),o.showLine?(i.find("."+v).removeClass("layui-tree-icon"),i.find("."+v).children(".layui-icon").removeClass(k).addClass("layui-icon-file"),(a=i.parents("."+g).eq(0)).addClass(L),a.children("."+f).each(function(){u(this).children("."+g).children("."+f).last().addClass(N)})):i.find(".layui-tree-iconArrow").addClass(y),d.parents("."+f).eq(0).removeClass(w),d.parent("."+g).remove()),void d.remove()):(d.remove(),void s.elem.append(s.elemNone));var l,n,i,a})})},i.prototype.events=function(){var i=this,t=i.config;i.elem.find(".layui-tree-checkedFirst"),i.setChecked(i.checkids),i.elem.find(".layui-tree-search").on("keyup",function(){var e=u(this),n=e.val(),e=e.nextAll(),a=[];e.find("."+b).each(function(){var i,e=u(this).parents("."+m);-1!=u(this).html().indexOf(n)&&(a.push(u(this).parent()),(i=function(e){e.addClass("layui-tree-searchShow"),e.parent("."+g)[0]&&i(e.parent("."+g).parent("."+f))})(e.parent("."+f)))}),e.find("."+m).each(function(){var e=u(this).parent("."+f);e.hasClass("layui-tree-searchShow")||e.addClass(y)}),0==e.find(".layui-tree-searchShow").length&&i.elem.append(i.elemNone),t.onsearch&&t.onsearch({elem:a})}),i.elem.find(".layui-tree-search").on("keydown",function(){u(this).nextAll().find("."+m).each(function(){u(this).parent("."+f).removeClass("layui-tree-searchShow "+y)}),u(".layui-tree-emptyText")[0]&&u(".layui-tree-emptyText").remove()})},i.prototype.getChecked=function(){var e=this.config,i=[],n=[];this.elem.find(".layui-form-checked").each(function(){i.push(u(this).prev()[0].value)});var t=function(e,a){layui.each(e,function(e,n){layui.each(i,function(e,i){if(n.id==i){i=u.extend({},n);return delete i.children,a.push(i),n.children&&(i.children=[],t(n.children,i.children)),!0}})})};return t(u.extend({},e.data),n),n},i.prototype.setChecked=function(l){this.config,this.elem.find("."+f).each(function(e,i){var n=u(this).data("id"),a=u(i).children("."+m).find('input[same="layuiTreeCheck"]'),t=a.next();if("number"==typeof l){if(n==l)return a[0].checked||t.click(),!1}else"object"==typeof l&&layui.each(l,function(e,i){if(i==n&&!a[0].checked)return t.click(),!0})})},l.that={},l.config={},t.reload=function(e,i){e=l.that[e];return e.reload(i),l.call(e)},t.getChecked=function(e){return l.that[e].getChecked()},t.setChecked=function(e,i){return l.that[e].setChecked(i)},t.render=function(e){e=new i(e);return l.call(e)},e(a,t)});