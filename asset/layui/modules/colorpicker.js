layui.define(["jquery","lay"],function(e){"use strict";function y(e){var i={h:0,s:0,b:0},o=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),n=r-o;return i.b=r,i.s=0!=r?255*n/r:0,0!=i.s?e.r==r?i.h=(e.g-e.b)/n:e.g==r?i.h=2+(e.b-e.r)/n:i.h=4+(e.r-e.g)/n:i.h=-1,r==o&&(i.h=0),i.h*=60,i.h<0&&(i.h+=360),i.s*=100/255,i.b*=100/255,i}function m(e){var i={},o=e.h,r=255*e.s/100,n=255*e.b/100;return 0==r?i.r=i.g=i.b=n:(n=o%60*((e=n)-(r=(255-r)*n/255))/60,(o=360==o?0:o)<60?(i.r=e,i.b=r,i.g=r+n):o<120?(i.g=e,i.b=r,i.r=e-n):o<180?(i.g=e,i.r=r,i.b=r+n):o<240?(i.b=e,i.r=r,i.g=e-n):o<300?(i.b=e,i.g=r,i.r=r+n):o<360?(i.r=e,i.g=r,i.b=e-n):(i.r=0,i.g=0,i.b=0)),{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}}function f(e){var o=[(e=m(e)).r.toString(16),e.g.toString(16),e.b.toString(16)];return P.each(o,function(e,i){1==i.length&&(o[e]="0"+i)}),o.join("")}function x(e){return{r:(e=e.match(/[0-9]{1,3}/g)||[])[0],g:e[1],b:e[2]}}function n(e){this.index=++i.index,this.config=P.extend({},this.config,i.config,e),this.render()}var P=layui.jquery,o=layui.lay,r=layui.device().mobile?"click":"mousedown",i={config:{},index:layui.colorpicker?layui.colorpicker.index+1e4:0,set:function(e){var i=this;return i.config=P.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,"colorpicker",e,i)}},l="layui-colorpicker",t=".layui-colorpicker-main",C="layui-icon-down",B="layui-icon-close",w="layui-colorpicker-trigger-span",D="layui-colorpicker-trigger-i",j="layui-colorpicker-side-slider",E="layui-colorpicker-basis",F="layui-colorpicker-alpha-bgcolor",H="layui-colorpicker-alpha-slider",M="layui-colorpicker-basis-cursor",Y="layui-colorpicker-main-input",I=P(window),c=P(document);n.prototype.config={color:"",size:null,alpha:!1,format:"hex",predefine:!1,colors:["#009688","#5FB878","#1E9FFF","#FF5722","#FFB800","#01AAED","#999","#c00","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgb(0, 186, 189)","rgb(255, 120, 0)","rgb(250, 212, 0)","#393D49","rgba(0,0,0,.5)","rgba(255, 69, 0, 0.68)","rgba(144, 240, 144, 0.5)","rgba(31, 147, 255, 0.73)"]},n.prototype.render=function(){var e=this,i=e.config,o=P(['<div class="layui-unselect layui-colorpicker">',"<span "+("rgb"==i.format&&i.alpha?'class="layui-colorpicker-trigger-bgcolor"':"")+">",'<span class="layui-colorpicker-trigger-span" ','lay-type="'+("rgb"==i.format?i.alpha?"rgba":"torgb":"")+'" ','style="'+(r="",i.color?(r=i.color,3<(i.color.match(/[0-9]{1,3}/g)||[]).length&&(i.alpha&&"rgb"==i.format||(r="#"+f(y(x(i.color))))),"background: "+r):r)+'">','<i class="layui-icon layui-colorpicker-trigger-i '+(i.color?C:B)+'"></i>',"</span>","</span>","</div>"].join("")),r=P(i.elem);i.size&&o.addClass("layui-colorpicker-"+i.size),r.addClass("layui-inline").html(e.elemColorBox=o),e.color=e.elemColorBox.find("."+w)[0].style.background,e.events()},n.prototype.renderPicker=function(){var e=this,i=e.config,o=e.elemColorBox[0],r=e.elemPicker=P(['<div id="layui-colorpicker'+e.index+'" data-index="'+e.index+'" class="layui-anim layui-anim-downbit layui-colorpicker-main">','<div class="layui-colorpicker-main-wrapper">','<div class="layui-colorpicker-basis">','<div class="layui-colorpicker-basis-white"></div>','<div class="layui-colorpicker-basis-black"></div>','<div class="layui-colorpicker-basis-cursor"></div>',"</div>",'<div class="layui-colorpicker-side">','<div class="layui-colorpicker-side-slider"></div>',"</div>","</div>",'<div class="layui-colorpicker-main-alpha '+(i.alpha?"layui-show":"")+'">','<div class="layui-colorpicker-alpha-bgcolor">','<div class="layui-colorpicker-alpha-slider"></div>',"</div>","</div>",function(){if(i.predefine){var o=['<div class="layui-colorpicker-main-pre">'];return layui.each(i.colors,function(e,i){o.push(['<div class="layui-colorpicker-pre'+(3<(i.match(/[0-9]{1,3}/g)||[]).length?" layui-colorpicker-pre-isalpha":"")+'">','<div style="background:'+i+'"></div>',"</div>"].join(""))}),o.push("</div>"),o.join("")}return""}(),'<div class="layui-colorpicker-main-input">','<div class="layui-inline">','<input type="text" class="layui-input">',"</div>",'<div class="layui-btn-container">','<button class="layui-btn layui-btn-primary layui-btn-sm" colorpicker-events="clear">清空</button>','<button class="layui-btn layui-btn-sm" colorpicker-events="confirm">确定</button>',"</div","</div>","</div>"].join(""));e.elemColorBox.find("."+w)[0];P(t)[0]&&P(t).data("index")==e.index?e.removePicker(n.thisElemInd):(e.removePicker(n.thisElemInd),P("body").append(r)),n.thisElemInd=e.index,n.thisColor=o.style.background,e.position(),e.pickerEvents()},n.prototype.removePicker=function(e){this.config;return P("#layui-colorpicker"+(e||this.index)).remove(),this},n.prototype.position=function(){var e=this,i=e.config;return o.position(e.bindElem||e.elemColorBox[0],e.elemPicker[0],{position:i.position,align:"center"}),e},n.prototype.val=function(){var e,i=this,o=(i.config,i.elemColorBox.find("."+w)),r=i.elemPicker.find("."+Y),n=o[0].style.backgroundColor;n?(e=y(x(n)),o=o.attr("lay-type"),i.select(e.h,e.s,e.b),"torgb"===o&&r.find("input").val(n),"rgba"===o&&(o=x(n),3==(n.match(/[0-9]{1,3}/g)||[]).length?(r.find("input").val("rgba("+o.r+", "+o.g+", "+o.b+", 1)"),i.elemPicker.find("."+H).css("left",280)):(r.find("input").val(n),n=280*n.slice(n.lastIndexOf(",")+1,n.length-1),i.elemPicker.find("."+H).css("left",n)),i.elemPicker.find("."+F)[0].style.background="linear-gradient(to right, rgba("+o.r+", "+o.g+", "+o.b+", 0), rgb("+o.r+", "+o.g+", "+o.b+"))")):(i.select(0,100,100),r.find("input").val(""),i.elemPicker.find("."+F)[0].style.background="",i.elemPicker.find("."+H).css("left",280))},n.prototype.side=function(){function s(e,i,o,r){n.select(e,i,o),o=m({h:e,s:i,b:o}),b.addClass(C).removeClass(B),t[0].style.background="rgb("+o.r+", "+o.g+", "+o.b+")","torgb"===c&&n.elemPicker.find("."+Y).find("input").val("rgb("+o.r+", "+o.g+", "+o.b+")"),"rgba"===c&&(u.css("left",280*r),n.elemPicker.find("."+Y).find("input").val("rgba("+o.r+", "+o.g+", "+o.b+", "+r+")"),t[0].style.background="rgba("+o.r+", "+o.g+", "+o.b+", "+r+")",f[0].style.background="linear-gradient(to right, rgba("+o.r+", "+o.g+", "+o.b+", 0), rgb("+o.r+", "+o.g+", "+o.b+"))"),l.change&&l.change(n.elemPicker.find("."+Y).find("input").val())}function i(e){P("#LAY-colorpicker-moving")[0]||P("body").append(k),k.on("mousemove",e),k.on("mouseup",function(){k.remove()}).on("mouseleave",function(){k.remove()})}var n=this,l=n.config,t=n.elemColorBox.find("."+w),c=t.attr("lay-type"),a=n.elemPicker.find(".layui-colorpicker-side"),e=n.elemPicker.find("."+j),d=n.elemPicker.find("."+E),r=n.elemPicker.find("."+M),f=n.elemPicker.find("."+F),u=n.elemPicker.find("."+H),p=e[0].offsetTop/180*360,g=100-(r[0].offsetTop+3)/180*100,h=(r[0].offsetLeft+3)/260*100,v=Math.round(u[0].offsetLeft/280*100)/100,b=n.elemColorBox.find("."+D),o=n.elemPicker.find(".layui-colorpicker-pre").children("div"),k=P(['<div class="layui-auxiliar-moving" id="LAY-colorpicker-moving"></div>'].join(""));e.on("mousedown",function(e){var r=this.offsetTop,n=e.clientY;i(function(e){var i=r+(e.clientY-n),o=a[0].offsetHeight,i=(i=o<(i=i<0?0:i)?o:i)/180*360;s(p=i,h,g,v),e.preventDefault()}),e.preventDefault()}),a.on("click",function(e){var i=e.clientY-P(this).offset().top,i=(i=(i=i<0?0:i)>this.offsetHeight?this.offsetHeight:i)/180*360;s(p=i,h,g,v),e.preventDefault()}),r.on("mousedown",function(e){var l=this.offsetTop,t=this.offsetLeft,c=e.clientY,a=e.clientX;layui.stope(e),i(function(e){var i=l+(e.clientY-c),o=t+(e.clientX-a),r=d[0].offsetHeight-3,n=d[0].offsetWidth-3,o=((o=n<(o=o<-3?-3:o)?n:o)+3)/260*100,i=100-((i=r<(i=i<-3?-3:i)?r:i)+3)/180*100;s(p,h=o,g=i,v),e.preventDefault()}),e.preventDefault()}),d.on("mousedown",function(e){var i=e.clientY-P(this).offset().top-3+I.scrollTop(),o=e.clientX-P(this).offset().left-3+I.scrollLeft();(i=i<-3?-3:i)>this.offsetHeight-3&&(i=this.offsetHeight-3);o=((o=(o=o<-3?-3:o)>this.offsetWidth-3?this.offsetWidth-3:o)+3)/260*100,i=100-(i+3)/180*100;s(p,h=o,g=i,v),layui.stope(e),e.preventDefault(),r.trigger(e,"mousedown")}),u.on("mousedown",function(e){var r=this.offsetLeft,n=e.clientX;i(function(e){var i=r+(e.clientX-n),o=f[0].offsetWidth;o<(i=i<0?0:i)&&(i=o);i=Math.round(i/280*100)/100;s(p,h,g,v=i),e.preventDefault()}),e.preventDefault()}),f.on("click",function(e){var i=e.clientX-P(this).offset().left;(i=i<0?0:i)>this.offsetWidth&&(i=this.offsetWidth);i=Math.round(i/280*100)/100;s(p,h,g,v=i),e.preventDefault()}),o.each(function(){P(this).on("click",function(){P(this).parent(".layui-colorpicker-pre").addClass("selected").siblings().removeClass("selected");var e=this.style.backgroundColor,i=y(x(e)),o=e.slice(e.lastIndexOf(",")+1,e.length-1);p=i.h,h=i.s,g=i.b,3==(e.match(/[0-9]{1,3}/g)||[]).length&&(o=1),v=o,s(i.h,i.s,i.b,o)})})},n.prototype.select=function(e,i,o,r){var n=this,l=(n.config,f({h:e,s:100,b:100})),t=f({h:e,s:i,b:o}),e=e/360*180,o=180-o/100*180-3,i=i/100*260-3;n.elemPicker.find("."+j).css("top",e),n.elemPicker.find("."+E)[0].style.background="#"+l,n.elemPicker.find("."+M).css({top:o,left:i}),"change"!==r&&n.elemPicker.find("."+Y).find("input").val("#"+t)},n.prototype.pickerEvents=function(){var c=this,a=c.config,s=c.elemColorBox.find("."+w),d=c.elemPicker.find("."+Y+" input"),o={clear:function(e){s[0].style.background="",c.elemColorBox.find("."+D).removeClass(C).addClass(B),c.color="",a.done&&a.done(""),c.removePicker()},confirm:function(e,i){var o,r,n=d.val(),l=n,t={};if(-1<n.indexOf(",")?(t=y(x(n)),c.select(t.h,t.s,t.b),s[0].style.background=l="#"+f(t),3<(n.match(/[0-9]{1,3}/g)||[]).length&&"rgba"===s.attr("lay-type")&&(r=280*n.slice(n.lastIndexOf(",")+1,n.length-1),c.elemPicker.find("."+H).css("left",r),l=s[0].style.background=n)):(3==(o=-1<(o=n).indexOf("#")?o.substring(1):o).length&&(o=(r=o.split(""))[0]+r[0]+r[1]+r[1]+r[2]+r[2]),o=parseInt(o,16),t=y({r:o>>16,g:(65280&o)>>8,b:255&o}),s[0].style.background=l="#"+f(t),c.elemColorBox.find("."+D).removeClass(B).addClass(C)),"change"===i)return c.select(t.h,t.s,t.b,i),void(a.change&&a.change(l));c.color=n,a.done&&a.done(n),c.removePicker()}};c.elemPicker.on("click","*[colorpicker-events]",function(){var e=P(this),i=e.attr("colorpicker-events");o[i]&&o[i].call(this,e)}),d.on("keyup",function(e){var i=P(this);o.confirm.call(this,i,13===e.keyCode?null:"change")})},n.prototype.events=function(){var i=this,e=i.config,o=i.elemColorBox.find("."+w);i.elemColorBox.on("click",function(){i.renderPicker(),P(t)[0]&&(i.val(),i.side())}),e.elem[0]&&!i.elemColorBox[0].eventHandler&&(c.on(r,function(e){P(e.target).hasClass(l)||P(e.target).parents("."+l)[0]||P(e.target).hasClass(t.replace(/\./g,""))||P(e.target).parents(t)[0]||i.elemPicker&&(i.color?(e=y(x(i.color)),i.select(e.h,e.s,e.b)):i.elemColorBox.find("."+D).removeClass(C).addClass(B),o[0].style.background=i.color||"",i.removePicker())}),I.on("resize",function(){return!(!i.elemPicker||!P(t)[0])&&void i.position()}),i.elemColorBox[0].eventHandler=!0)},i.render=function(e){e=new n(e);return function(){return{config:this.config}}.call(e)},e("colorpicker",i)});